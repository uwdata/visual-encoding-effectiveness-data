!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).vl=e()}}(function(){return function e(t,n,i){function r(o,s){if(!n[o]){if(!t[o]){var l="function"==typeof require&&require;if(!s&&l)return l(o,!0);if(a)return a(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[o]={exports:{}};t[o][0].call(c.exports,function(e){var n=t[o][1][e];return r(n||e)},c,c.exports,e,t,n,i)}return n[o].exports}for(var a="function"==typeof require&&require,o=0;o<i.length;o++)r(i[o]);return r}({1:[function(e,t,n){var i="undefined"!=typeof JSON?JSON:e("jsonify");t.exports=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var n=t.space||"";"number"==typeof n&&(n=Array(n+1).join(" "));var o="boolean"==typeof t.cycles&&t.cycles,s=t.replacer||function(e,t){return t},l=t.cmp&&function(e){return function(t){return function(n,i){var r={key:n,value:t[n]},a={key:i,value:t[i]};return e(r,a)}}}(t.cmp),u=[];return function e(t,c,f,d){var p=n?"\n"+new Array(d+1).join(n):"",m=n?": ":":";if(f&&f.toJSON&&"function"==typeof f.toJSON&&(f=f.toJSON()),void 0!==(f=s.call(t,c,f))){if("object"!=typeof f||null===f)return i.stringify(f);if(r(f)){for(var g=[],h=0;h<f.length;h++){var v=e(f,h,f[h],d+1)||i.stringify(null);g.push(p+n+v)}return"["+g.join(",")+p+"]"}if(-1!==u.indexOf(f)){if(o)return i.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}u.push(f);for(var y=a(f).sort(l&&l(f)),g=[],h=0;h<y.length;h++){var b=e(f,c=y[h],f[c],d+1);if(b){var _=i.stringify(c)+m+b;g.push(p+n+_)}}return u.splice(u.indexOf(f),1),"{"+g.join(",")+p+"}"}}({"":e},"",e,0)};var r=Array.isArray||function(e){return"[object Array]"==={}.toString.call(e)},a=Object.keys||function(e){var t=Object.prototype.hasOwnProperty||function(){return!0},n=[];for(var i in e)t.call(e,i)&&n.push(i);return n}},{jsonify:2}],2:[function(e,t,n){n.parse=e("./lib/parse"),n.stringify=e("./lib/stringify")},{"./lib/parse":3,"./lib/stringify":4}],3:[function(e,t,n){var i,r,a,o,s={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},l=function(e){throw{name:"SyntaxError",message:e,at:i,text:a}},u=function(e){return e&&e!==r&&l("Expected '"+e+"' instead of '"+r+"'"),r=a.charAt(i),i+=1,r},c=function(){var e,t="";for("-"===r&&(t="-",u("-"));r>="0"&&r<="9";)t+=r,u();if("."===r)for(t+=".";u()&&r>="0"&&r<="9";)t+=r;if("e"===r||"E"===r)for(t+=r,u(),"-"!==r&&"+"!==r||(t+=r,u());r>="0"&&r<="9";)t+=r,u();if(e=+t,isFinite(e))return e;l("Bad number")},f=function(){var e,t,n,i="";if('"'===r)for(;u();){if('"'===r)return u(),i;if("\\"===r)if(u(),"u"===r){for(n=0,t=0;t<4&&(e=parseInt(u(),16),isFinite(e));t+=1)n=16*n+e;i+=String.fromCharCode(n)}else{if("string"!=typeof s[r])break;i+=s[r]}else i+=r}l("Bad string")},d=function(){for(;r&&r<=" ";)u()},p=function(){switch(r){case"t":return u("t"),u("r"),u("u"),u("e"),!0;case"f":return u("f"),u("a"),u("l"),u("s"),u("e"),!1;case"n":return u("n"),u("u"),u("l"),u("l"),null}l("Unexpected '"+r+"'")},m=function(){var e=[];if("["===r){if(u("["),d(),"]"===r)return u("]"),e;for(;r;){if(e.push(o()),d(),"]"===r)return u("]"),e;u(","),d()}}l("Bad array")},g=function(){var e,t={};if("{"===r){if(u("{"),d(),"}"===r)return u("}"),t;for(;r;){if(e=f(),d(),u(":"),Object.hasOwnProperty.call(t,e)&&l('Duplicate key "'+e+'"'),t[e]=o(),d(),"}"===r)return u("}"),t;u(","),d()}}l("Bad object")};o=function(){switch(d(),r){case"{":return g();case"[":return m();case'"':return f();case"-":return c();default:return r>="0"&&r<="9"?c():p()}},t.exports=function(e,t){var n;return a=e,i=0,r=" ",n=o(),d(),r&&l("Syntax error"),"function"==typeof t?function e(n,i){var r,a,o=n[i];if(o&&"object"==typeof o)for(r in o)Object.prototype.hasOwnProperty.call(o,r)&&(void 0!==(a=e(o,r))?o[r]=a:delete o[r]);return t.call(n,i,o)}({"":n},""):n}},{}],4:[function(e,t,n){function i(e){return l.lastIndex=0,l.test(e)?'"'+e.replace(l,function(e){var t=u[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function r(e,t){var n,l,u,c,f,d=a,p=t[e];switch(p&&"object"==typeof p&&"function"==typeof p.toJSON&&(p=p.toJSON(e)),"function"==typeof s&&(p=s.call(t,e,p)),typeof p){case"string":return i(p);case"number":return isFinite(p)?String(p):"null";case"boolean":case"null":return String(p);case"object":if(!p)return"null";if(a+=o,f=[],"[object Array]"===Object.prototype.toString.apply(p)){for(c=p.length,n=0;n<c;n+=1)f[n]=r(n,p)||"null";return u=0===f.length?"[]":a?"[\n"+a+f.join(",\n"+a)+"\n"+d+"]":"["+f.join(",")+"]",a=d,u}if(s&&"object"==typeof s)for(c=s.length,n=0;n<c;n+=1)"string"==typeof(l=s[n])&&(u=r(l,p))&&f.push(i(l)+(a?": ":":")+u);else for(l in p)Object.prototype.hasOwnProperty.call(p,l)&&(u=r(l,p))&&f.push(i(l)+(a?": ":":")+u);return u=0===f.length?"{}":a?"{\n"+a+f.join(",\n"+a)+"\n"+d+"}":"{"+f.join(",")+"}",a=d,u}}var a,o,s,l=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,u={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};t.exports=function(e,t,n){var i;if(a="",o="","number"==typeof n)for(i=0;i<n;i+=1)o+=" ";else"string"==typeof n&&(o=n);if(s=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return r("",{"":e})}},{}],5:[function(e,t,n){(function(e){var n,i,r,a,o,s,l,u,c,f,d,p,m,g,h,v;!function(n){function i(e,t){return function(n,i){return e[n]=t?t(n,i):i}}var r="object"==typeof e?e:"object"==typeof self?self:"object"==typeof this?this:{};n("object"==typeof t&&"object"==typeof t.exports?i(r,i(t.exports)):i(r))}(function(e){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};n=function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)},i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++){t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},r=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&(n[i[r]]=e[i[r]]);return n},a=function(e,t,n,i){var r,a=arguments.length,o=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(o=(a<3?r(o):a>3?r(t,n,o):r(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},o=function(e,t){return function(n,i){t(n,i,e)}},s=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=function(e,t,n,i){return new(n||(n=Promise))(function(r,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(o,s)}l((i=i.apply(e,t||[])).next())})},u=function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,a&&(o=a[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(a,n[1])).done)return o;switch(a=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,a=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(o=l.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){l.label=n[1];break}if(6===n[0]&&l.label<o[1]){l.label=o[1],o=n;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(n);break}o[2]&&l.ops.pop(),l.trys.pop();continue}n=t.call(e,l)}catch(e){n=[6,e],a=0}finally{r=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,a,o,s,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},c=function(e,t){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])},f=function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},d=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,a=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return o},p=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(d(arguments[t]));return e},m=function(e){return this instanceof m?(this.v=e,this):new m(e)},g=function(e,t,n){function i(e){c[e]&&(u[e]=function(t){return new Promise(function(n,i){f.push([e,t,n,i])>1||r(e,t)})})}function r(e,t){try{a(c[e](t))}catch(e){l(f[0][3],e)}}function a(e){e.value instanceof m?Promise.resolve(e.value.v).then(o,s):l(f[0][2],e)}function o(e){r("next",e)}function s(e){r("throw",e)}function l(e,t){e(t),f.shift(),f.length&&r(f[0][0],f[0][1])}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var u,c=n.apply(e,t||[]),f=[];return u={},i("next"),i("throw"),i("return"),u[Symbol.asyncIterator]=function(){return this},u},h=function(e){function t(t,r){e[t]&&(n[t]=function(n){return(i=!i)?{value:m(e[t](n)),done:"return"===t}:r?r(n):n})}var n,i;return n={},t("next"),t("throw",function(e){throw e}),t("return"),n[Symbol.iterator]=function(){return this},n},v=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator];return t?t.call(e):"function"==typeof f?f(e):e[Symbol.iterator]()},e("__extends",n),e("__assign",i),e("__rest",r),e("__decorate",a),e("__param",o),e("__metadata",s),e("__awaiter",l),e("__generator",u),e("__exportStar",c),e("__values",f),e("__read",d),e("__spread",p),e("__await",m),e("__asyncGenerator",g),e("__asyncDelegator",h),e("__asyncValues",v)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],6:[function(e,t,n){!function(e,i){i("object"==typeof n&&void 0!==t?n:e.vega=e.vega||{})}(this,function(e){"use strict";function t(e){return u.hasOwnProperty(e)}function n(e,t,n,i,r){for(var a,o=0,s=e.length;t<s;++t){if(a=e[t],!o&&a===n)return t;r&&r.indexOf(a)>=0?--o:i&&i.indexOf(a)>=0&&++o}return t}function i(e){for(var t=[],i=0,r=e.length,a=0;a<r;)a=n(e,a,h,f+p,d+m),t.push(e.substring(i,a).trim()),i=++a;if(0===t.length)throw"Empty event selector: "+e;return t}function r(e){return"["===e[0]?a(e):o(e)}function a(e){var t,a,o=e.length,s=1;if((s=n(e,s,d,f,d))===o)throw"Empty between selector: "+e;if(2!==(t=i(e.substring(1,s))).length)throw"Between selector must have two elements: "+e;if((e=e.slice(s+1).trim())[0]!==y)throw"Expected '>' after between selector: "+e;return t=t.map(r),(a=r(e.slice(1).trim())).between?{between:t,stream:a}:(a.between=t,a)}function o(e){var i,r,a={source:l},o=[],u=[0,0],c=0,h=0,y=e.length,_=0;if(e[y-1]===m){if(!((_=e.lastIndexOf(p))>=0))throw"Unmatched right brace: "+e;try{u=s(e.substring(_+1,y-1))}catch(t){throw"Invalid throttle specification: "+e}y=(e=e.slice(0,_).trim()).length,_=0}if(!y)throw e;if(e[0]===v&&(c=++_),(i=n(e,_,g))<y&&(o.push(e.substring(h,i).trim()),h=_=++i),(_=n(e,_,f))===y)o.push(e.substring(h,y).trim());else if(o.push(e.substring(h,_).trim()),r=[],(h=++_)===y)throw"Unmatched left bracket: "+e;for(;_<y;){if((_=n(e,_,d))===y)throw"Unmatched left bracket: "+e;if(r.push(e.substring(h,_).trim()),_<y-1&&e[++_]!==f)throw"Expected left bracket: "+e;h=++_}if(!(y=o.length)||b.test(o[y-1]))throw"Invalid event selector: "+e;return y>1?(a.type=o[1],c?a.markname=o[0].slice(1):t(o[0])?a.marktype=o[0]:a.source=o[0]):a.type=o[0],"!"===a.type.slice(-1)&&(a.consume=!0,a.type=a.type.slice(0,-1)),null!=r&&(a.filter=r),u[0]&&(a.throttle=u[0]),u[1]&&(a.debounce=u[1]),a}function s(e){var t=e.split(h);if(!e.length||t.length>2)throw e;return t.map(function(t){var n=+t;if(n!==n)throw e;return n})}var l,u,c="view",f="[",d="]",p="{",m="}",g=":",h=",",v="@",y=">",b=/[[\]{}]/,_={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};e.selector=function(e,t,n){return l=t||c,u=n||_,i(e.trim()).map(r)},Object.defineProperty(e,"__esModule",{value:!0})})},{}],7:[function(e,t,n){!function(e,i){i("object"==typeof n&&void 0!==t?n:e.vega=e.vega||{})}(this,function(e){"use strict";function t(e){return null==e?null:e.fields}function n(e){return l(e)?"["+e.map(n)+"]":u(e)||c(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function i(e,t,n){var i=[t].concat([].slice.call(n));console[e].apply(console,i)}function r(e){return x(e)?e:E(e)?e:Date.parse(e)}var a=function(e,t,n){return e.fields=t||[],e.fname=n,e},o=function(e){throw Error(e)},s=function(e){function t(){a.push(c+e.substring(n,i)),c="",n=i+1}var n,i,r,a=[],s=null,l=0,u=e.length,c="";for(e+="",n=i=0;i<u;++i)if("\\"===(r=e[i]))c+=e.substring(n,i),n=++i;else if(r===s)t(),s=null,l=-1;else{if(s)continue;n===l&&'"'===r?(n=i+1,s=r):n===l&&"'"===r?(n=i+1,s=r):"."!==r||l?"["===r?(i>n&&t(),l=n=i+1):"]"===r&&(l||o("Access path missing open bracket: "+e),l>0&&t(),l=0,n=i+1):i>n?t():n=i+1}return l&&o("Access path missing closing bracket: "+e),s&&o("Access path missing closing quote: "+e),i>n&&(i++,t()),a},l=Array.isArray,u=function(e){return e===Object(e)},c=function(e){return"string"==typeof e},f=function(e,t){var i=s(e),r="return _["+i.map(n).join("][")+"];";return a(Function("_",r),[e=1===i.length?i[0]:e],t||e)},d=[],p=f("id"),m=a(function(e){return e},d,"identity"),g=a(function(){return 0},d,"zero"),h=a(function(){return 1},d,"one"),v=a(function(){return!0},d,"true"),y=a(function(){return!1},d,"false"),b=function(e){return null!=e?l(e)?e:[e]:[]},_=function(e){return"function"==typeof e},S={},E=function(e){return"[object Date]"===Object.prototype.toString.call(e)},x=function(e){return"number"==typeof e},O=function(e,t){for(var n="";--t>=0;)n+=e;return n};e.accessor=a,e.accessorName=function(e){return null==e?null:e.fname},e.accessorFields=t,e.id=p,e.identity=m,e.zero=g,e.one=h,e.truthy=v,e.falsy=y,e.logger=function(e){var t=e||0;return{level:function(e){return arguments.length?(t=+e,this):t},error:function(){return t>=1&&i("error","ERROR",arguments),this},warn:function(){return t>=2&&i("warn","WARN",arguments),this},info:function(){return t>=3&&i("log","INFO",arguments),this},debug:function(){return t>=4&&i("log","DEBUG",arguments),this}}},e.None=0,e.Error=1,e.Warn=2,e.Info=3,e.Debug=4,e.array=b,e.compare=function(e,i){var r,o,l,u,c,f,d,p,m,g=[],h=(e=b(e)).map(function(e,t){return null==e?null:(g.push(t),_(e)?e:s(e).map(n).join("]["))}),v=g.length-1,y=b(i),S="var u,v;return ";if(v<0)return null;for(o=0;o<=v;++o)l=h[r=g[o]],_(l)?(u="(u=this."+(f="f"+r)+"(a))",c="(v=this."+f+"(b))",(d=d||{})[f]=l):(u="(u=a["+l+"])",c="(v=b["+l+"])"),f="((v=v instanceof Date?+v:v),(u=u instanceof Date?+u:u))","descending"!==y[r]?(m=1,p=-1):(m=-1,p=1),S+="("+u+"<"+c+"||u==null)&&v!=null?"+p+":(u>v||v==null)&&u!=null?"+m+":"+f+"!==u&&v===v?"+p+":v!==v&&u===u?"+m+(r<v?":":":0");return l=Function("a","b",S+";"),d&&(l=l.bind(d)),e=e.reduce(function(e,n){return _(n)?(t(n)||[]).forEach(function(t){e[t]=1}):null!=n&&(e[n+""]=1),e},{}),a(l,Object.keys(e))},e.constant=function(e){return _(e)?e:function(){return e}},e.debounce=function(e,t){function n(){t(r),i=r=null}var i,r;return function(t){r=t,i&&clearTimeout(i),i=setTimeout(n,e)}},e.error=o,e.extend=function(e){for(var t,n,i=1,r=arguments.length;i<r;++i){t=arguments[i];for(n in t)e[n]=t[n]}return e},e.extentIndex=function(e,t){var n,i,r,a,o,s=-1,l=e.length;if(null==t){for(;++s<l;)if(null!=(i=e[s])&&i>=i){n=r=i;break}for(a=o=s;++s<l;)null!=(i=e[s])&&(n>i&&(n=i,a=s),r<i&&(r=i,o=s))}else{for(;++s<l;)if(null!=(i=t(e[s],s,e))&&i>=i){n=r=i;break}for(a=o=s;++s<l;)null!=(i=t(e[s],s,e))&&(n>i&&(n=i,a=s),r<i&&(r=i,o=s))}return[a,o]},e.fastmap=function(e){function t(e){return r.hasOwnProperty(e)&&r[e]!==S}var n,i,r={};return n={size:0,empty:0,object:r,has:t,get:function(e){return t(e)?r[e]:void 0},set:function(e,i){return t(e)||(++n.size,r[e]===S&&--n.empty),r[e]=i,this},delete:function(e){return t(e)&&(--n.size,++n.empty,r[e]=S),this},clear:function(){n.size=n.empty=0,n.object=r={}},test:function(e){return arguments.length?(i=e,n):i},clean:function(){var e,t,a={},o=0;for(e in r)(t=r[e])===S||i&&i(t)||(a[e]=t,++o);n.size=o,n.empty=0,n.object=r=a}},e&&Object.keys(e).forEach(function(t){n.set(t,e[t])}),n},e.field=f,e.inherits=function(e,t){var n=e.prototype=Object.create(t.prototype);return n.constructor=e,n},e.isArray=l,e.isBoolean=function(e){return"boolean"==typeof e},e.isDate=E,e.isFunction=_,e.isNumber=x,e.isObject=u,e.isRegExp=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},e.isString=c,e.key=function(e){var t=(e=e?b(e):e)&&e.length?Function("_","return ''+"+e.map(function(e){return"_["+s(e).map(n).join("][")+"]"}).join("+'|'+")+";"):function(){return""};return a(t,e,"key")},e.merge=function(e,t,n,i){var r=t.length,a=n.length;if(!a)return t;if(!r)return n;for(var o=i||new t.constructor(r+a),s=0,l=0,u=0;s<r&&l<a;++u)o[u]=e(t[s],n[l])>0?n[l++]:t[s++];for(;s<r;++s,++u)o[u]=t[s];for(;l<a;++l,++u)o[u]=n[l];return o},e.pad=function(e,t,n,i){var r=n||" ",a=e+"",o=t-a.length;return o<=0?a:"left"===i?O(r,o)+a:"center"===i?O(r,~~(o/2))+a+O(r,Math.ceil(o/2)):a+O(r,o)},e.peek=function(e){return e[e.length-1]},e.repeat=O,e.splitAccessPath=s,e.stringValue=n,e.toBoolean=function(e){return null==e||""===e?null:!(!e||"false"===e||"0"===e||!e)},e.toDate=function(e,t){return t=t||r,null==e||""===e?null:t(e)},e.toNumber=function(e){return null==e||""===e?null:+e},e.toString=function(e){return null==e||""===e?null:e+""},e.toSet=function(e){for(var t={},n=0,i=e.length;n<i;++n)t[e[n]]=1;return t},e.truncate=function(e,t,n,i){var r=null!=i?i:"…",a=e+"",o=a.length,s=Math.max(0,t-r.length);return o<=t?a:"left"===n?r+a.slice(o-s):"center"===n?a.slice(0,Math.ceil(s/2))+r+a.slice(o-~~(s/2)):a.slice(0,s)+r},e.visitArray=function(e,t,n){if(e){var i,r=0,a=e.length;if(t)for(;r<a;++r)(i=t(e[r]))&&n(i,r,e);else e.forEach(n)}},Object.defineProperty(e,"__esModule",{value:!0})})},{}],8:[function(e,t,n){t.exports={name:"vega-lite",author:'Jeffrey Heer, Dominik Moritz, Kanit "Ham" Wongsuphasawat',version:"2.0.0-rc1",collaborators:["Kanit Wongsuphasawat <kanitw@gmail.com> (http://kanitw.yellowpigz.com)","Dominik Moritz <domoritz@cs.washington.edu> (https://www.domoritz.de)","Jeffrey Heer <jheer@uw.edu> (http://jheer.org)"],homepage:"https://vega.github.io/vega-lite/",description:"Vega-lite provides a higher-level grammar for visual analysis, comparable to ggplot or Tableau, that generates complete Vega specifications.",main:"build/src/index.js",types:"typings/vega-lite.d.ts",bin:{vl2png:"./bin/vl2png",vl2svg:"./bin/vl2svg",vl2vg:"./bin/vl2vg"},directories:{test:"test"},scripts:{pretsc:"mkdir -p build && rm -rf build/*/** && cp package.json build/",tsc:"tsc",prebuild:"mkdir -p build/site build/test-gallery",build:"npm run build:only","build:only":"npm run tsc && cp package.json build && browserify src/index.ts -p tsify -d -s vl | exorcist build/vega-lite.js.map > build/vega-lite.js",postbuild:"node node_modules/uglify-js/bin/uglifyjs build/vega-lite.js -cm --source-map content=build/vega-lite.js.map,filename=build/vega-lite.min.js.map -o build/vega-lite.min.js && npm run schema","build:examples":"npm run data && npm run build:only && npm run build:examples-only","build:examples-only":"TZ=America/Los_Angeles ./scripts/build-examples.sh && rm -f examples/specs/normalized/*.vl.json && scripts/build-normalized-examples","build:example":"./scripts/build-example.sh","build:toc":"bundle exec jekyll build -q && scripts/generate-toc","build:site":"browserify site/static/main.ts -p [tsify -p site] -d | exorcist build/site/main.js.map > build/site/main.js","build:versions":"scripts/update-version.sh","build:test-gallery":"browserify test-gallery/main.ts -p [tsify -p test-gallery] -d > build/test-gallery/main.js","check:examples":"scripts/check-examples.sh","check:schema":"scripts/check-schema.sh",clean:"rm -rf build && rm -f vega-lite.* & find -E src test site examples -regex '.*\\.(js|js.map|d.ts)' -delete",data:"rsync -r node_modules/vega-datasets/data/* data",link:"npm link && npm link vega-lite",deploy:"scripts/deploy.sh","deploy:gh":"scripts/deploy-gh.sh","deploy:schema":"scripts/deploy-schema.sh",prestart:"npm run data && npm run build && scripts/index-examples",start:"nodemon -x 'npm run build:test-gallery' & browser-sync start --server --files 'build/test-gallery/main.js' --index 'test-gallery/index.html'",poststart:"rm examples/all-examples.json",preschema:"npm run prebuild",schema:"ts-json-schema-generator --path tsconfig.json --type TopLevelExtendedSpec > build/vega-lite-schema.json && npm run renameschema && cp build/vega-lite-schema.json _data/",renameschema:"scripts/rename-schema.sh",presite:"npm run build && npm run data && npm run build:site && npm run build:toc && npm run build:versions",site:"bundle exec jekyll serve",lint:"tslint --project tsconfig.json -c tslint.json --type-check",test:"npm run build:only && npm run test:only && npm run test:runtime && npm run lint",posttest:"npm run schema && npm run data && npm run mocha:examples","test:nocompile":"npm run test:only && npm run test:runtime && npm run lint && npm run mocha:examples","test:only":"nyc --reporter=html --reporter=text-summary npm run mocha:test","test:runtime":"TZ=America/Los_Angeles wdio wdio.conf.js","test:runtime:generate":"rm -Rf test-runtime/resources && VL_GENERATE_TESTS=true npm run test:runtime","test:debug":"npm run tsc && mocha --recursive --debug-brk --inspect build/test","test:debug-examples":"npm run tsc && npm run schema && mocha --recursive --debug-brk --inspect build/examples","mocha:test":"mocha --require source-map-support/register --reporter dot --recursive build/test","mocha:examples":"mocha --require source-map-support/register --reporter dot --recursive build/examples",codecov:"nyc report --reporter=json && codecov -f coverage/*.json","watch:build":"watchify src/index.ts -p tsify -v -d -s vl -o 'exorcist build/vega-lite.js.map > build/vega-lite.js'","watch:tsc":"npm run tsc -- -w","watch:test":"nodemon -x 'npm test'",watch:"nodemon -x 'npm run build && npm run test:nocompile' # already ran schema in build"},repository:{type:"git",url:"https://github.com/vega/vega-lite.git"},license:"BSD-3-Clause",bugs:{url:"https://github.com/vega/vega-lite/issues"},devDependencies:{"@types/chai":"^4.0.2","@types/d3":"^4.10.0","@types/highlight.js":"^9.1.9","@types/json-stable-stringify":"^1.0.31","@types/mkdirp":"^0.5.0","@types/mocha":"^2.2.41","@types/node":"^8.0.19","@types/webdriverio":"^4.8.4",ajv:"5.2.2","browser-sync":"^2.18.13",browserify:"^14.4.0","browserify-shim":"^3.8.14",chai:"^4.1.0",cheerio:"^1.0.0-rc.2",chromedriver:"^2.30.1",codecov:"^2.3.0",d3:"^4.10.0",exorcist:"^0.4.0","highlight.js":"^9.12.0",mkdirp:"^0.5.1",mocha:"^3.5.0",nodemon:"^1.11.0",nyc:"^11.1.0","source-map-support":"^0.4.15","ts-json-schema-generator":"^0.12.0","ts-node":"^3.2.1",tsify:"^3.0.1",tslint:"5.4.3","tslint-eslint-rules":"^4.1.1",typescript:"^2.4.2","uglify-js":"^3.0.27",vega:"^3.0.0","vega-datasets":"vega/vega-datasets#gh-pages","vega-embed":"^3.0.0-beta.20","vega-tooltip":"^0.4.2",watchify:"^3.9.0","wdio-chromedriver-service":"^0.1.0","wdio-dot-reporter":"0.0.9","wdio-mocha-framework":"^0.5.10","wdio-static-server-service":"^1.0.1",webdriverio:"^4.8.0","yaml-front-matter":"^3.4.0"},dependencies:{"json-stable-stringify":"^1.0.1",tslib:"^1.7.1","vega-event-selector":"^2.0.0","vega-util":"^1.5.0",yargs:"^8.0.2"}}},{}],9:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("./util"),r={values:1,count:1,valid:1,missing:1,distinct:1,sum:1,mean:1,average:1,variance:1,variancep:1,stdev:1,stdevp:1,median:1,q1:1,q3:1,ci0:1,ci1:1,min:1,max:1,argmin:1,argmax:1};n.AGGREGATE_OPS=i.flagKeys(r),n.isAggregateOp=function(e){return!!r[e]},n.COUNTING_OPS=["count","valid","missing","distinct"],n.isCountingAggregateOp=function(e){return e&&i.contains(n.COUNTING_OPS,e)},n.SUM_OPS=["count","sum","distinct","valid","missing"],n.SHARED_DOMAIN_OPS=["mean","average","median","q1","q3","min","max"],n.SHARED_DOMAIN_OP_INDEX=i.toSet(n.SHARED_DOMAIN_OPS)},{"./util":114}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AXIS_PROPERTY_TYPE={grid:"grid",labelOverlap:"main",offset:"main",title:"main"},n.AXIS_PROPERTIES=["domain","format","grid","labelPadding","labels","labelOverlap","maxExtent","minExtent","offset","orient","position","tickCount","ticks","tickSize","title","titlePadding","values","zindex"],n.VG_AXIS_PROPERTIES=[].concat(n.AXIS_PROPERTIES,["gridScale"])},{}],11:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("./channel"),r=e("./util");n.binToString=function(e){return r.isBoolean(e)?"bin":"bin"+r.keys(e).map(function(t){return"_"+t+"_"+e[t]}).join("")},n.autoMaxBins=function(e){switch(e){case i.ROW:case i.COLUMN:case i.SIZE:case i.COLOR:case i.OPACITY:case i.SHAPE:return 6;default:return 10}}},{"./channel":12,"./util":114}],12:[function(e,t,n){"use strict";function i(e){switch(e){case n.X:case n.Y:case n.COLOR:case n.DETAIL:case n.TOOLTIP:case n.ORDER:case n.OPACITY:case n.ROW:case n.COLUMN:return{point:!0,tick:!0,rule:!0,circle:!0,square:!0,bar:!0,rect:!0,line:!0,area:!0,text:!0};case n.X2:case n.Y2:return{rule:!0,bar:!0,rect:!0,area:!0};case n.SIZE:return{point:!0,tick:!0,rule:!0,circle:!0,square:!0,bar:!0,text:!0,line:!0};case n.SHAPE:return{point:!0};case n.TEXT:return{text:!0}}}Object.defineProperty(n,"__esModule",{value:!0});var r,a=e("tslib"),o=e("./util");!function(e){e.ROW="row",e.COLUMN="column",e.X="x",e.Y="y",e.X2="x2",e.Y2="y2",e.COLOR="color",e.SHAPE="shape",e.SIZE="size",e.OPACITY="opacity",e.TEXT="text",e.ORDER="order",e.DETAIL="detail",e.TOOLTIP="tooltip"}(r=n.Channel||(n.Channel={})),n.X=r.X,n.Y=r.Y,n.X2=r.X2,n.Y2=r.Y2,n.ROW=r.ROW,n.COLUMN=r.COLUMN,n.SHAPE=r.SHAPE,n.SIZE=r.SIZE,n.COLOR=r.COLOR,n.TEXT=r.TEXT,n.DETAIL=r.DETAIL,n.ORDER=r.ORDER,n.OPACITY=r.OPACITY,n.TOOLTIP=r.TOOLTIP;var s={x:1,y:1,x2:1,y2:1,size:1,shape:1,color:1,order:1,opacity:1,text:1,detail:1,tooltip:1},l={row:1,column:1},u=a.__assign({},s,l);n.CHANNELS=o.flagKeys(u);u.order,u.detail;var c=a.__rest(u,["order","detail"]);n.SINGLE_DEF_CHANNELS=o.flagKeys(c),n.isChannel=function(e){return!!u[e]},n.UNIT_CHANNELS=o.flagKeys(s);var f=a.__rest(s,["x","y","x2","y2"]);n.NONSPATIAL_CHANNELS=o.flagKeys(f);var d={x:1,y:1};n.SPATIAL_SCALE_CHANNELS=o.flagKeys(d);f.text,f.tooltip,f.detail,f.order;var p=a.__rest(f,["text","tooltip","detail","order"]);n.NONSPATIAL_SCALE_CHANNELS=o.flagKeys(p);var m=a.__assign({},d,p);n.SCALE_CHANNELS=o.flagKeys(m),n.isScaleChannel=function(e){return!!m[e]},n.supportMark=function(e,t){return t in i(e)},n.getSupportedMark=i,n.rangeType=function(e){switch(e){case n.X:case n.Y:case n.SIZE:case n.OPACITY:case n.X2:case n.Y2:return"continuous";case n.ROW:case n.COLUMN:case n.SHAPE:case n.TEXT:case n.TOOLTIP:return"discrete";case n.COLOR:return"flexible";case n.DETAIL:case n.ORDER:return}throw new Error("getSupportedRole not implemented for "+e)}},{"./util":114,tslib:5}],13:[function(e,t,n){"use strict";function i(e){return function(t,n){return n[e]&&t.push(n[e].combine()),t}}Object.defineProperty(n,"__esModule",{value:!0});var r=i("main"),a=i("grid");n.assembleAxes=function(e){return[].concat(e.x?[].concat(e.x.reduce(r,[]),e.x.reduce(a,[])):[],e.y?[].concat(e.y.reduce(r,[]),e.y.reduce(a,[])):[])}},{}],14:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib"),r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i.__extends(t,e),t}(e("../split").Split);n.AxisComponentPart=r},{"../split":86,tslib:5}],15:[function(e,t,n){"use strict";function i(e,t,n){return void 0!==e.labelAngle?(e.labelAngle%360+360)%360:t===o.X&&(c.contains([u.NOMINAL,u.ORDINAL],n.type)||n.bin||s.isTimeFieldDef(n))?270:void 0}function r(e,t){if(e&&e>0){if(e>180)return"top"===t?"left":"right";if(e<180)return"top"===t?"right":"left"}}Object.defineProperty(n,"__esModule",{value:!0});var a=e("tslib"),o=e("../../channel"),s=e("../../fielddef"),l=e("../../scale"),u=e("../../type"),c=e("../../util"),f=e("../common");n.labels=function(e,t,n,o){var u=e.fieldDef(t)||("x"===t?e.fieldDef("x2"):"y"===t?e.fieldDef("y2"):void 0),d=e.axis(t),p=e.config,m={};if(s.isTimeFieldDef(u)){var g=e.getScaleComponent(t).get("type")===l.ScaleType.UTC;m.text={signal:f.timeFormatExpression("datum.value",u.timeUnit,d.format,p.axis.shortTimeLabels,p.timeFormat,g)}}var h=i(d,t,u);if(h&&(m.angle={value:h}),m.angle&&"x"===t){var v=r(h,o.get("orient"));v&&(m.align={value:v}),c.contains([90,270],h)&&(m.baseline={value:"middle"})}return m=a.__assign({},m,n),0===c.keys(m).length?void 0:m},n.labelAngle=i,n.labelAlign=r},{"../../channel":12,"../../fielddef":96,"../../scale":104,"../../type":113,"../../util":114,"../common":20,tslib:5}],16:[function(e,t,n){"use strict";function i(e,t){if(!e)return t.map(function(e){return d.__assign({},e.main?{main:e.main.clone()}:{},e.grid?{grid:e.grid.clone()}:{})});if(e.length===t.length){for(var n=e.length,i=0;i<n;i++){var a=e[i].main,o=t[i].main;if(!!a!=!!o)return;if(a&&o){var s=a.getWithExplicit("orient"),l=o.getWithExplicit("orient");if(s.explicit&&l.explicit&&s.value!==l.value)return;e[i].main=r(a,o)}var u=e[i].grid,c=t[i].grid;if(!!u!=!!c)return;u&&c&&(e[i].grid=r(u,c))}return e}}function r(e,t){for(var n=0,i=p.VG_AXIS_PROPERTIES;n<i.length;n++)!function(n){var i=y.mergeValuesWithExplicit(e.getWithExplicit(n),t.getWithExplicit(n),n,"axis",function(e,t){switch(n){case"title":return h.titleMerger(e,t);case"gridScale":return{explicit:e.explicit,value:e.value||t.value}}return y.defaultTieBreaker(e,t,n,"axis")});e.setWithExplicit(n,i)}(i[n]);return e}function a(e){return!1===e||null===e}function o(e){return g.some(E,function(t){return s(e,t)})}function s(e,t){return"axis"===t||("grid"===t||"title"===t?!!e.get(t):!a(e.get(t)))}function l(e,t){return c(e,t,!0)}function u(e,t){return c(e,t,!1)}function c(e,t,n){var i=t.axis(e),r=new b.AxisComponentPart({},{scale:t.scaleName(e)});p.AXIS_PROPERTIES.forEach(function(a){var o=f(a,i,e,t,n);if(void 0!==o){var s="values"===a?!!i.values:o===i[a];r.set(a,o,s)}});var a=S.gridScale(t,e,n);void 0!==a&&r.set("gridScale",a,!1);var o=i.encoding||{},l=E.reduce(function(n,i){if(!s(r,i))return n;var a="labels"===i?_.labels(t,e,o.labels||{},r):o[i]||{};return void 0!==a&&g.keys(a).length>0&&(n[i]={update:a}),n},{});return g.keys(l).length>0&&r.set("encode",l,!!i.encoding||!!i.labelAngle),r}function f(e,t,n,i,r){var a=i.fieldDef(n);if(!(r&&"main"===p.AXIS_PROPERTY_TYPE[e]||!r&&"grid"===p.AXIS_PROPERTY_TYPE[e])){switch(e){case"domain":return S.domain(e,t,r,n);case"format":return h.numberFormat(a,t.format,i.config);case"grid":o=i.getScaleComponent(n).get("type");return h.getSpecifiedOrDefaultValue(t.grid,S.grid(o,a));case"labels":return!r&&t.labels;case"labelOverlap":o=i.getScaleComponent(n).get("type");return S.labelOverlap(a,t,n,o);case"minExtent":return S.minMaxExtent(t.minExtent,r);case"maxExtent":return S.minMaxExtent(t.maxExtent,r);case"orient":return h.getSpecifiedOrDefaultValue(t.orient,S.orient(n));case"tickCount":var o=i.getScaleComponent(n).get("type"),s="x"===n?"width":"y"===n?"height":void 0,l=s?i.getSizeSignalRef(s):void 0;return h.getSpecifiedOrDefaultValue(t.tickCount,S.tickCount(n,a,o,l));case"ticks":return S.ticks(e,t,r,n);case"title":return h.getSpecifiedOrDefaultValue(t.title,S.title(t.titleMaxLength,a,i.config));case"values":return S.values(t,i,a);case"zindex":return h.getSpecifiedOrDefaultValue(t.zindex,S.zindex(r))}return t[e]}}Object.defineProperty(n,"__esModule",{value:!0});var d=e("tslib"),p=e("../../axis"),m=e("../../channel"),g=e("../../util"),h=e("../common"),v=e("../resolve"),y=e("../split"),b=e("./component"),_=e("./encode"),S=e("./properties"),E=["domain","grid","labels","ticks","title"];n.parseUnitAxis=function(e){return m.SPATIAL_SCALE_CHANNELS.reduce(function(t,n){if(e.axis(n)){var i={},r=u(n,e);r&&o(r)&&(i.main=r);var a=l(n,e);a&&o(a)&&(i.grid=a),t[n]=[i]}return t},{})};var x={bottom:"top",top:"bottom",left:"right",right:"left"};n.parseLayerAxis=function(e){for(var t=e.component,n=t.axes,r=t.resolve,a={top:0,bottom:0,right:0,left:0},o=0,s=e.children;o<s.length;o++)!function(t){t.parseAxisAndHeader(),g.keys(t.component.axes).forEach(function(a){r.axis[a]=v.parseGuideResolve(e.component.resolve,a),"shared"===r.axis[a]&&(n[a]=i(n[a],t.component.axes[a]),n[a]||(r.axis[a]="independent",delete n[a]))})}(s[o]);["x","y"].forEach(function(t){for(var i=0,o=e.children;i<o.length;i++){var s=o[i];s.component.axes[t]&&("independent"===r.axis[t]&&(n[t]=(n[t]||[]).concat(s.component.axes[t]),s.component.axes[t].forEach(function(e){var t=e.main.getWithExplicit("orient"),n=t.value,i=t.explicit;if(a[n]>0&&!i){var r=x[n];a[n]>a[r]&&e.main.set("orient",r,!1)}a[n]++})),delete s.component.axes[t])}})},n.parseGridAxis=l,n.parseMainAxis=u},{"../../axis":10,"../../channel":12,"../../util":114,"../common":20,"../resolve":66,"../split":86,"./component":14,"./encode":15,"./properties":17,tslib:5}],17:[function(e,t,n){"use strict";function i(e,t,n,i){return!n&&t[e]}Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../channel"),a=e("../../datetime"),o=e("../../fielddef"),s=e("../../log"),l=e("../../scale"),u=e("../../util");n.domainAndTicks=i,n.domain=i,n.ticks=i,n.grid=function(e,t){return!l.hasDiscreteDomain(e)&&!t.bin},n.gridScale=function(e,t,n){if(n){var i="x"===t?"y":"x";if(e.getScaleComponent(i))return e.scaleName(i)}},n.labelOverlap=function(e,t,n,i){if("nominal"!==e.type)return"log"!==i||"greedy"},n.minMaxExtent=function(e,t){return t?0:e},n.orient=function(e){switch(e){case r.X:return"bottom";case r.Y:return"left"}throw new Error(s.message.INVALID_CHANNEL_FOR_AXIS)},n.tickCount=function(e,t,n,i){if(!l.hasDiscreteDomain(n)&&"log"!==n&&!u.contains(["month","hours","day","quarter"],t.timeUnit))return t.bin?{signal:"min(ceil("+i.signal+"/40), "+t.bin.maxbins+")"}:{signal:"ceil("+i.signal+"/40)"}},n.title=function(e,t,n){var i=o.title(t,n);return e?u.truncate(i,e):i},n.values=function(e,t,n){var i=e.values;return e.values&&a.isDateTime(i[0])?i.map(function(e){return{signal:a.dateTimeExpr(e,!0)}}):i},n.zindex=function(e){return e?0:1}},{"../../channel":12,"../../datetime":93,"../../fielddef":96,"../../log":101,"../../scale":104,"../../util":114}],18:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib"),r=e("../util"),a=e("./data/parse"),o=e("./layoutsize/assemble"),s=function(e){function t(t,n,i,r,a){return e.call(this,t,n,i,r,a)||this}return i.__extends(t,e),t.prototype.parseData=function(){this.component.data=a.parseData(this),this.children.forEach(function(e){e.parseData()})},t.prototype.parseSelection=function(){var e=this;this.component.selection={};for(var t=0,n=this.children;t<n.length;t++)!function(t){t.parseSelection(),r.keys(t.component.selection).forEach(function(n){e.component.selection[n]=t.component.selection[n]})}(n[t])},t.prototype.parseMarkGroup=function(){for(var e=0,t=this.children;e<t.length;e++)t[e].parseMarkGroup()},t.prototype.parseAxisAndHeader=function(){for(var e=0,t=this.children;e<t.length;e++)t[e].parseAxisAndHeader()},t.prototype.assembleSelectionTopLevelSignals=function(e){return this.children.reduce(function(e,t){return t.assembleSelectionTopLevelSignals(e)},e)},t.prototype.assembleSelectionSignals=function(){return this.children.forEach(function(e){return e.assembleSelectionSignals()}),[]},t.prototype.assembleLayoutSignals=function(){return this.children.reduce(function(e,t){return e.concat(t.assembleLayoutSignals())},o.assembleLayoutSignals(this))},t.prototype.assembleSelectionData=function(e){return this.children.reduce(function(e,t){return t.assembleSelectionData(e)},[])},t.prototype.assembleMarks=function(){return this.children.map(function(e){var t=e.assembleTitle(),n=e.assembleGroupStyle(),r=e.assembleLayoutSize();return i.__assign({type:"group",name:e.getName("group")},t?{title:t}:{},n?{style:n}:{},r?{encode:{update:r}}:{},e.assembleGroup())})},t}(e("./model").Model);n.BaseConcatModel=s},{"../util":114,"./data/parse":37,"./layoutsize/assemble":44,"./model":63,tslib:5}],19:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("../log"),r=e("../spec"),a=e("./concat"),o=e("./facet"),s=e("./layer"),l=e("./repeat"),u=e("./unit");n.buildModel=function(e,t,n,c,f,d){if(r.isFacetSpec(e))return new o.FacetModel(e,t,n,f,d);if(r.isLayerSpec(e))return new s.LayerModel(e,t,n,c,f,d);if(r.isUnitSpec(e))return new u.UnitModel(e,t,n,c,f,d);if(r.isRepeatSpec(e))return new l.RepeatModel(e,t,n,f,d);if(r.isConcatSpec(e))return new a.ConcatModel(e,t,n,f,d);throw new Error(i.message.INVALID_SPEC)}},{"../log":101,"../spec":107,"./concat":22,"./facet":41,"./layer":42,"./repeat":64,"./unit":87}],20:[function(e,t,n){"use strict";function i(e){return e.style?g.isArray(e.style)?e.style:[e.style]:[e.type]}function r(e,t,n){var r=n.mark[e],a=n[t.type];void 0!==a[e]&&(r=a[e]);for(var o=0,s=i(t);o<s.length;o++){var l=s[o],u=n.style[l],c=e;u&&void 0!==u[c]&&(r=u[c])}return r}function a(e,t,n){if(e.type===m.QUANTITATIVE)return t||n.numberFormat}function o(e,t){return"format("+e+', "'+(t||"")+'")'}function s(e,t,n){return o(e,t||n.numberFormat)}function l(e,t,n,i){return e+" === null || isNaN("+e+') ? "null" : '+s(e,n,i)+' + " - " + '+s(t,n,i)}function u(e,t,n,i,r,a){if(!t||n){var o=n||r;return a?"utcFormat("+e+", '"+o+"')":"timeFormat("+e+", '"+o+"')"}return p.formatExpression(t,e,i,a)}Object.defineProperty(n,"__esModule",{value:!0});var c=e("../channel"),f=e("../fielddef"),d=e("../scale"),p=e("../timeunit"),m=e("../type"),g=e("../util");n.applyConfig=function(e,t,n){for(var i=0,r=n;i<r.length;i++){var a=r[i],o=t[a];void 0!==o&&(e[a]={value:o})}return e},n.applyMarkConfig=function(e,t,n){for(var i=0,a=n;i<a.length;i++){var o=a[i],s=r(o,t.markDef,t.config);void 0!==s&&(e[o]={value:s})}return e},n.getStyles=i,n.getMarkConfig=r,n.formatSignalRef=function(e,t,n,i){var r=a(e,t,i);if(e.bin)return{signal:l(f.field(e,{expr:n}),f.field(e,{expr:n,binSuffix:"end"}),r,i)};if("quantitative"===e.type)return{signal:""+o(f.field(e,{expr:n}),r)};if(f.isTimeFieldDef(e)){var s=f.isScaleFieldDef(e)&&e.scale&&e.scale.type===d.ScaleType.UTC;return{signal:u(f.field(e,{expr:n}),e.timeUnit,t,i.text.shortTimeLabels,i.timeFormat,s)}}return{signal:"''+"+f.field(e,{expr:n})}},n.getSpecifiedOrDefaultValue=function(e,t){return void 0!==e?e:t},n.numberFormat=a,n.numberFormatExpr=s,n.binFormatExpression=l,n.timeFormatExpression=u,n.sortParams=function(e,t){return(g.isArray(e)?e:[e]).reduce(function(e,n){return e.field.push(f.field(n,t)),e.order.push(n.sort||"ascending"),e},{field:[],order:[]})},n.titleMerger=function(e,t){return{explicit:e.explicit,value:e.value===t.value?e.value:e.value+", "+t.value}},n.binRequiresRange=function(e,t){return e.bin?c.isScaleChannel(t)&&g.contains(["ordinal","nominal"],e.type):(console.warn("Only use this method with binned field defs"),!1)}},{"../channel":12,"../fielddef":96,"../scale":104,"../timeunit":109,"../type":113,"../util":114}],21:[function(e,t,n){"use strict";function i(e,t){return a.__assign({},u.extractTopLevelProperties(t),u.extractTopLevelProperties(e))}function r(e,t){var n=e.config?o.stripAndRedirectConfig(e.config):void 0,i=(t.autoResize,a.__rest(t,["autoResize"])),r=e.assembleTitle(),s=e.assembleGroupStyle();return{spec:a.__assign({$schema:"https://vega.github.io/schema/vega/v3.0.json"},e.description?{description:e.description}:{},{autosize:t.autoResize?{type:"pad",resize:!0}:"pad"},i,r?{title:r}:{},s?{style:s}:{},{data:[].concat(e.assembleSelectionData([]),f.assembleRootData(e.component.data))},e.assembleGroup(e.assembleLayoutSignals().concat(e.assembleSelectionTopLevelSignals([]))),n?{config:n}:{})}}Object.defineProperty(n,"__esModule",{value:!0});var a=e("tslib"),o=e("../config"),s=e("../log"),l=e("../spec"),u=e("../toplevelprops"),c=e("./buildmodel"),f=e("./data/assemble"),d=e("./data/optimize");n.compile=function(e,t){t&&s.set(t);try{var n=o.initConfig(e.config),a=l.normalize(e,n),u=c.buildModel(a,null,"",void 0,void 0,n);return u.parse(),d.optimizeDataflow(u.component.data),r(u,i(e,n))}finally{t&&s.reset()}}},{"../config":91,"../log":101,"../spec":107,"../toplevelprops":111,"./buildmodel":19,"./data/assemble":24,"./data/optimize":35,tslib:5}],22:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib"),r=e("../spec"),a=e("./baseconcat"),o=e("./buildmodel"),s=e("./layoutsize/parse"),l=function(e){function t(t,n,i,a,s){var l=e.call(this,t,n,i,s,t.resolve)||this;return l.type="concat",l.isVConcat=r.isVConcatSpec(t),l.children=(r.isVConcatSpec(t)?t.vconcat:t.hconcat).map(function(e,t){return o.buildModel(e,l,l.getName("concat_"+t),void 0,a,s)}),l}return i.__extends(t,e),t.prototype.parseLayoutSize=function(){s.parseConcatLayoutSize(this)},t.prototype.parseAxisGroup=function(){return null},t.prototype.assembleLayout=function(){return i.__assign({padding:{row:10,column:10},offset:10},this.isVConcat?{columns:1}:{},{bounds:"full",align:"each"})},t}(a.BaseConcatModel);n.ConcatModel=l},{"../spec":107,"./baseconcat":18,"./buildmodel":19,"./layoutsize/parse":45,tslib:5}],23:[function(e,t,n){"use strict";function i(e,t,n){return n.bin?(e[s.field(n,{})]=!0,e[s.field(n,{binSuffix:"end"})]=!0,c.binRequiresRange(n,t)&&(e[s.field(n,{binSuffix:"range"})]=!0)):e[s.field(n)]=!0,e}function r(e,t){for(var n in t)if(t.hasOwnProperty(n)){var i=t[n];for(var r in i)i.hasOwnProperty(r)&&(n in e?e[n][r]=i[r]:e[n]={op:i[r]})}}Object.defineProperty(n,"__esModule",{value:!0});var a=e("tslib"),o=e("../../channel"),s=e("../../fielddef"),l=e("../../log"),u=e("../../util"),c=e("../common"),f=function(e){function t(t,n){var i=e.call(this)||this;return i.dimensions=t,i.measures=n,i}return a.__extends(t,e),t.prototype.clone=function(){return new t(a.__assign({},this.dimensions),u.duplicate(this.measures))},t.makeFromEncoding=function(e){var n=!1;e.forEachFieldDef(function(e){e.aggregate&&(n=!0)});var r={},a={};return n?(e.forEachFieldDef(function(t,n){t.aggregate?"count"===t.aggregate?(r["*"]=r["*"]||{},r["*"].count=s.field(t,{aggregate:"count"})):(r[t.field]=r[t.field]||{},r[t.field][t.aggregate]=s.field(t),o.isScaleChannel(n)&&"unaggregated"===e.scaleDomain(n)&&(r[t.field].min=s.field(t,{aggregate:"min"}),r[t.field].max=s.field(t,{aggregate:"max"}))):i(a,n,t)}),u.keys(a).length+u.keys(r).length===0?null:new t(a,r)):null},t.makeFromTransform=function(e){for(var n={},i={},r=0,a=e.summarize;r<a.length;r++)(c=a[r]).aggregate&&("count"===c.aggregate?(i["*"]=i["*"]||{},i["*"].count=c.as||s.field(c)):(i[c.field]=i[c.field]||{},i[c.field][c.aggregate]=c.as||s.field(c)));for(var o=0,l=e.groupby;o<l.length;o++){var c=l[o];n[c]=!0}return u.keys(n).length+u.keys(i).length===0?null:new t(n,i)},t.prototype.merge=function(e){u.differ(this.dimensions,e.dimensions)?l.debug("different dimensions, cannot merge"):(r(this.measures,e.measures),e.remove())},t.prototype.addDimensions=function(e){var t=this;e.forEach(function(e){return t.dimensions[e]=!0})},t.prototype.dependentFields=function(){var e={};return u.keys(this.dimensions).forEach(function(t){return e[t]=!0}),u.keys(this.measures).forEach(function(t){return e[t]=!0}),e},t.prototype.producedFields=function(){var e=this,t={};return u.keys(this.measures).forEach(function(n){u.keys(e.measures[n]).forEach(function(e){t[e+"_"+n]=!0})}),t},t.prototype.assemble=function(){var e=this,t=[],n=[],i=[];return u.keys(this.measures).forEach(function(r){u.keys(e.measures[r]).forEach(function(a){i.push(e.measures[r][a]),t.push(a),n.push(r)})}),{type:"aggregate",groupby:u.keys(this.dimensions),ops:t,fields:n,as:i}},t}(e("./dataflow").DataFlowNode);n.AggregateNode=f},{"../../channel":12,"../../fielddef":96,"../../log":101,"../../util":114,"../common":20,"./dataflow":27,tslib:5}],24:[function(e,t,n){"use strict";function i(e){function t(i,o){if(i instanceof y.SourceNode&&(a.isUrlData(i.data)||(e.push(o),o=S={name:null,source:o.name,transform:[]})),i instanceof p.ParseNode&&(i.parent instanceof y.SourceNode&&!o.source?o.format=r.__assign({},o.format||{},{parse:i.assembleFormatParse()}):o.transform=o.transform.concat(i.assembleTransforms())),i instanceof f.FacetNode)return o.name||(o.name="data_"+n++),!o.source||o.transform.length>0?(e.push(o),i.data=o.name):i.data=o.source,void i.assemble().forEach(function(t){return e.push(t)});if((i instanceof d.FilterNode||i instanceof v.NullFilterNode||i instanceof u.CalculateNode||i instanceof s.AggregateNode||i instanceof g.LookupNode||i instanceof m.IdentifierNode)&&o.transform.push(i.assemble()),(i instanceof h.NonPositiveFilterNode||i instanceof l.BinNode||i instanceof _.TimeUnitNode||i instanceof b.StackNode)&&(o.transform=o.transform.concat(i.assemble())),i instanceof s.AggregateNode&&(o.name||(o.name="data_"+n++)),i instanceof c.OutputNode)if(o.source&&0===o.transform.length)i.setSource(o.source);else if(i.parent instanceof c.OutputNode)i.setSource(o.name);else if(o.name||(o.name="data_"+n++),i.setSource(o.name),1===i.numChildren()){e.push(o);var S={name:null,source:o.name,transform:[]};o=S}switch(i.numChildren()){case 0:i instanceof c.OutputNode&&(!o.source||o.transform.length>0)&&e.push(o);break;case 1:t(i.children[0],o);break;default:o.name||(o.name="data_"+n++);var E=o.name;!o.source||o.transform.length>0?e.push(o):E=o.source,i.children.forEach(function(e){t(e,{name:null,source:E,transform:[]})})}}var n=0;return t}Object.defineProperty(n,"__esModule",{value:!0});var r=e("tslib"),a=e("../../data"),o=e("../../util"),s=e("./aggregate"),l=e("./bin"),u=e("./calculate"),c=e("./dataflow"),f=e("./facet"),d=e("./filter"),p=e("./formatparse"),m=e("./indentifier"),g=e("./lookup"),h=e("./nonpositivefilter"),v=e("./nullfilter"),y=e("./source"),b=e("./stack"),_=e("./timeunit");n.assembleFacetData=function(e){var t=[],n=i(t);return e.children.forEach(function(t){return n(t,{source:e.name,name:null,transform:[]})}),t},n.assembleRootData=function(e){var t=o.vals(e.sources),n=[],r=i(n),a=0;t.forEach(function(e){e.hasName()||(e.dataName="source_"+a++);var t=e.assemble();r(e,t)}),n.forEach(function(e){0===e.transform.length&&delete e.transform}),n.sort(function(e,t){return 0===(e.transform||[]).length?-1:0===(t.transform||[]).length?1:0});for(var s=0,l=n;s<l.length;s++)for(var u=0,c=l[s].transform||[];u<c.length;u++){var f=c[u];"lookup"===f.type&&(f.from=e.outputNodes[f.from].getSource())}return n}},{"../../data":92,"../../util":114,"./aggregate":23,"./bin":25,"./calculate":26,"./dataflow":27,"./facet":28,"./filter":29,"./formatparse":30,"./indentifier":31,"./lookup":32,"./nonpositivefilter":33,"./nullfilter":34,"./source":38,"./stack":39,"./timeunit":40,tslib:5}],25:[function(e,t,n){"use strict";function i(e,t,n,i){if(d.binRequiresRange(t,n)){var r=p.isUnitModel(e)?e.axis(n)||e.legend(n)||{}:{},a=c.field(t,{expr:"datum"}),o=c.field(t,{expr:"datum",binSuffix:"end"});return{formulaAs:c.field(t,{binSuffix:"range"}),formula:d.binFormatExpression(a,o,r.format,i)}}return{}}function r(e,t){return u.binToString(e)+"_"+t}function a(e){return!!e.model}function o(e,t){if(a(e)){var n=e.model;return{signal:n.getName(t+"_bins"),extentSignal:n.getName(t+"_extent")}}return e}function s(e,t){var n=c.normalizeBin(e.bin,void 0)||{},i=r(n,e.field),a=o(t,i),s=a.signal,u=a.extentSignal;return{key:i,binComponent:l.__assign({bin:n,field:e.field,as:[c.field(e,{}),c.field(e,{binSuffix:"end"})]},s?{signal:s}:{},u?{extentSignal:u}:{})}}Object.defineProperty(n,"__esModule",{value:!0});var l=e("tslib"),u=e("../../bin"),c=e("../../fielddef"),f=e("../../util"),d=e("../common"),p=e("../model"),m=function(e){function t(t){var n=e.call(this)||this;return n.bins=t,n}return l.__extends(t,e),t.prototype.clone=function(){return new t(f.duplicate(this.bins))},t.makeBinFromEncoding=function(e){var n=e.reduceFieldDef(function(t,n,r){if(n.bin){var a=s(n,{model:e}),o=a.key,u=a.binComponent;t[o]=l.__assign({},u,t[o],i(e,n,r,e.config))}return t},{});return 0===f.keys(n).length?null:new t(n)},t.makeFromTransform=function(e,n){var i=s(e,n),r=i.key,a=i.binComponent;return new t((o={},o[r]=a,o));var o},t.prototype.merge=function(e){this.bins=l.__assign({},this.bins,e.bins),e.remove()},t.prototype.producedFields=function(){var e={};return f.vals(this.bins).forEach(function(t){t.as.forEach(function(t){return e[t]=!0})}),e},t.prototype.dependentFields=function(){var e={};return f.vals(this.bins).forEach(function(t){e[t.field]=!0}),e},t.prototype.assemble=function(){return f.flatten(f.vals(this.bins).map(function(e){var t=[],n=l.__assign({type:"bin",field:e.field,as:e.as,signal:e.signal},e.bin);return!e.bin.extent&&e.extentSignal&&(t.push({type:"extent",field:e.field,signal:e.extentSignal}),n.extent={signal:e.extentSignal}),t.push(n),e.formula&&t.push({type:"formula",expr:e.formula,as:e.formulaAs}),t}))},t}(e("./dataflow").DataFlowNode);n.BinNode=m},{"../../bin":11,"../../fielddef":96,"../../util":114,"../common":20,"../model":63,"./dataflow":27,tslib:5}],26:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib"),r=e("../../util"),a=function(e){function t(t){var n=e.call(this)||this;return n.transform=t,n}return i.__extends(t,e),t.prototype.clone=function(){return new t(r.duplicate(this.transform))},t.prototype.producedFields=function(){var e={};return e[this.transform.as]=!0,e},t.prototype.assemble=function(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}},t}(e("./dataflow").DataFlowNode);n.CalculateNode=a},{"../../util":114,"./dataflow":27,tslib:5}],27:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib"),r=function(){function e(e){this.debugName=e,this._children=[],this._parent=null}return e.prototype.clone=function(){throw new Error("Cannot clone node")},e.prototype.producedFields=function(){return{}},e.prototype.dependentFields=function(){return{}},Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},set:function(e){this._parent=e,e.addChild(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"children",{get:function(){return this._children},enumerable:!0,configurable:!0}),e.prototype.numChildren=function(){return this._children.length},e.prototype.addChild=function(e){this._children.push(e)},e.prototype.removeChild=function(e){this._children.splice(this._children.indexOf(e),1)},e.prototype.remove=function(){for(var e=0,t=this._children;e<t.length;e++)t[e].parent=this._parent;this._parent.removeChild(this)},e.prototype.insertAsParentOf=function(e){var t=e.parent;t.removeChild(this),this.parent=t,e.parent=this},e.prototype.swapWithParent=function(){for(var e=this._parent,t=e.parent,n=0,i=this._children;n<i.length;n++)i[n].parent=e;this._children=[],e.removeChild(this),e.parent.removeChild(e),this.parent=t,e.parent=this},e}();n.DataFlowNode=r;var a=function(e){function t(t,n,i){var r=e.call(this,t)||this;return r.type=n,r.refCounts=i,r._source=r._name=t,!r.refCounts||r._name in r.refCounts||(r.refCounts[r._name]=0),r}return i.__extends(t,e),t.prototype.clone=function(){var e=new this.constructor;return e.debugName="clone_"+this.debugName,e._source=this._source,e._name="clone_"+this._name,e.type=this.type,e.refCounts=this.refCounts,e.refCounts[e._name]=0,e},t.prototype.getSource=function(){return this.refCounts[this._name]++,this._source},t.prototype.isRequired=function(){return!!this.refCounts[this._name]},t.prototype.setSource=function(e){this._source=e},t}(r);n.OutputNode=a},{tslib:5}],28:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib"),r=e("../../channel"),a=e("../../log"),o=e("../../scale"),s=e("../../vega.schema"),l=e("../scale/domain"),u=function(e){function t(t,n,i){var a=e.call(this)||this;return a.model=t,a.name=n,a.data=i,t.facet.column&&(a.columnFields=[t.field(r.COLUMN)],a.columnName=t.getName("column_domain"),t.fieldDef(r.COLUMN).bin&&a.columnFields.push(t.field(r.COLUMN,{binSuffix:"end"}))),t.facet.row&&(a.rowFields=[t.field(r.ROW)],a.rowName=t.getName("row_domain"),t.fieldDef(r.ROW).bin&&a.rowFields.push(t.field(r.ROW,{binSuffix:"end"}))),a.childModel=t.child,a}return i.__extends(t,e),Object.defineProperty(t.prototype,"fields",{get:function(){var e=[];return this.columnFields&&(e=e.concat(this.columnFields)),this.rowFields&&(e=e.concat(this.rowFields)),e},enumerable:!0,configurable:!0}),t.prototype.getSource=function(){return this.name},t.prototype.getChildIndependentFieldsWithStep=function(){for(var e={},t=0,n=["x","y"];t<n.length;t++){var i=n[t],r=this.childModel.component.scales[i];if(r&&!r.merged){var u=r.get("type"),c=r.get("range");if(o.hasDiscreteDomain(u)&&s.isVgRangeStep(c)){var f=l.assembleDomain(this.childModel,i),d=l.getFieldFromDomain(f);d?e[i]=d:a.warn("Unknown field for ${channel}.  Cannot calculate view size.")}}}return e},t.prototype.assembleRowColumnData=function(e,t,n){var r={},a="row"===e?"y":"x";return n[a]&&(r=t?{fields:["distinct_"+n[a]],ops:["max"],as:["distinct_"+n[a]]}:{fields:[n[a]],ops:["distinct"]}),{name:"row"===e?this.rowName:this.columnName,source:t||this.data,transform:[i.__assign({type:"aggregate",groupby:"row"===e?this.rowFields:this.columnFields},r)]}},t.prototype.assemble=function(){var e=[],t=null,n=this.getChildIndependentFieldsWithStep();if(this.columnName&&this.rowName&&(n.x||n.y)){t="cross_"+this.columnName+"_"+this.rowName;var i=[].concat(n.x?[n.x]:[],n.y?[n.y]:[]),r=i.map(function(){return"distinct"});e.push({name:t,source:this.data,transform:[{type:"aggregate",groupby:this.columnFields.concat(this.rowFields),fields:i,ops:r}]})}return this.columnName&&e.push(this.assembleRowColumnData("column",t,n)),this.rowName&&e.push(this.assembleRowColumnData("row",t,n)),e},t}(e("./dataflow").DataFlowNode);n.FacetNode=u},{"../../channel":12,"../../log":101,"../../scale":104,"../../vega.schema":116,"../scale/domain":69,"./dataflow":27,tslib:5}],29:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib"),r=e("../../filter"),a=e("../../util"),o=function(e){function t(t,n){var i=e.call(this)||this;return i.model=t,i.filter=n,i.expr=r.expression(i.model,i.filter,i),i}return i.__extends(t,e),t.prototype.clone=function(){return new t(this.model,a.duplicate(this.filter))},t.prototype.assemble=function(){return{type:"filter",expr:this.expr}},t}(e("./dataflow").DataFlowNode);n.FilterNode=o},{"../../filter":97,"../../util":114,"./dataflow":27,tslib:5}],30:[function(e,t,n){"use strict";function i(e,t){var n="datum["+f.stringValue(e)+"]";if("number"===t)return"toNumber("+n+")";if("boolean"===t)return"toBoolean("+n+")";if("string"===t)return"toString("+n+")";if("date"===t)return"toDate("+n+")";if(0===t.indexOf("date:"))return"timeParse("+n+","+(i=t.slice(5,t.length))+")";if(0===t.indexOf("utc:")){var i=t.slice(4,t.length);return"utcParse("+n+","+i+")"}return l.warn(l.message.unrecognizedParse(t)),null}Object.defineProperty(n,"__esModule",{value:!0});var r=e("tslib"),a=e("../../aggregate"),o=e("../../fielddef"),s=e("../../filter"),l=e("../../log"),u=e("../../logical"),c=e("../../transform"),f=e("../../util"),d=e("../model"),p=function(e){function t(t){var n=e.call(this)||this;return n._parse={},n._parse=t,n}return r.__extends(t,e),t.prototype.clone=function(){return new t(f.duplicate(this.parse))},t.make=function(e){var n={},i={};(e.transforms||[]).forEach(function(e){c.isCalculate(e)?i[e.as]=!0:c.isFilter(e)&&u.forEachLeave(e.filter,function(e){(s.isEqualFilter(e)||s.isRangeFilter(e)||s.isOneOfFilter(e))&&e.timeUnit&&(n[e.field]="date")})},{}),(d.isUnitModel(e)||d.isFacetModel(e))&&e.forEachFieldDef(function(e){if(o.isTimeFieldDef(e))n[e.field]="date";else if(o.isNumberFieldDef(e)){if(i[e.field]||a.isCountingAggregateOp(e.aggregate))return;n[e.field]="number"}});var r=e.data;if(r&&r.format&&r.format.parse){var p=r.format.parse;f.keys(p).forEach(function(e){n[e]=p[e]})}var m=e.component.data.ancestorParse;return f.keys(m).forEach(function(e){n[e]!==m[e]?l.warn(l.message.differentParse(e,n[e],m[e])):delete n[e]}),0===f.keys(n).length?null:new t(n)},Object.defineProperty(t.prototype,"parse",{get:function(){return this._parse},enumerable:!0,configurable:!0}),t.prototype.merge=function(e){this._parse=r.__assign({},this._parse,e.parse),e.remove()},t.prototype.assembleFormatParse=function(){return this._parse},t.prototype.producedFields=function(){return f.toSet(f.keys(this.parse))},t.prototype.dependentFields=function(){return f.toSet(f.keys(this.parse))},t.prototype.assembleTransforms=function(){var e=this;return f.keys(this._parse).map(function(t){var n=i(t,e._parse[t]);return n?{type:"formula",expr:n,as:t}:null}).filter(function(e){return null!==e})},t}(e("./dataflow").DataFlowNode);n.ParseNode=p},{"../../aggregate":9,"../../fielddef":96,"../../filter":97,"../../log":101,"../../logical":102,"../../transform":112,"../../util":114,"../model":63,"./dataflow":27,tslib:5}],31:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib"),r=e("../../selection"),a=function(e){function t(){return e.call(this)||this}return i.__extends(t,e),t.prototype.clone=function(){return new t},t.prototype.producedFields=function(){return e={},e[r.SELECTION_ID]=!0,e;var e},t.prototype.assemble=function(){return{type:"identifier",as:r.SELECTION_ID}},t}(e("./dataflow").DataFlowNode);n.IdentifierNode=a},{"../../selection":105,"./dataflow":27,tslib:5}],32:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib"),r=e("vega-util"),a=e("../../log"),o=e("./dataflow"),s=e("./source"),l=function(e){function t(t,n){var i=e.call(this)||this;return i.transform=t,i.secondary=n,i}return i.__extends(t,e),t.make=function(e,n,i){var r=e.component.data.sources,a=new s.SourceNode(n.from.data),l=r[a.hash()];l||(r[a.hash()]=a,l=a);var u=e.getName("lookup_"+i),c=new o.OutputNode(u,"lookup",e.component.data.outputNodeRefCounts);return c.parent=l,e.component.data.outputNodes[u]=c,new t(n,c.getSource())},t.prototype.producedFields=function(){return r.toSet(this.transform.from.fields||(this.transform.as instanceof Array?this.transform.as:[this.transform.as]))},t.prototype.assemble=function(){var e;if(this.transform.from.fields)e=i.__assign({values:this.transform.from.fields},this.transform.as?{as:this.transform.as instanceof Array?this.transform.as:[this.transform.as]}:{});else{var t=this.transform.as;r.isString(t)||(a.warn(a.message.NO_FIELDS_NEEDS_AS),t="_lookup"),e={as:[t]}}return i.__assign({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},e,this.transform.default?{default:this.transform.default}:{})},t}(o.DataFlowNode);n.LookupNode=l},{"../../log":101,"./dataflow":27,"./source":38,tslib:5,"vega-util":7}],33:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib"),r=e("../../channel"),a=e("../../scale"),o=e("../../util"),s=function(e){function t(t){var n=e.call(this)||this;return n._filter=t,n}return i.__extends(t,e),t.prototype.clone=function(){return new t(i.__assign({},this._filter))},t.make=function(e){var n=r.SCALE_CHANNELS.reduce(function(t,n){var i=e.getScaleComponent(n);return i&&e.field(n)?(t[e.field(n)]=i.get("type")===a.ScaleType.LOG,t):t},{});return o.keys(n).length?new t(n):null},Object.defineProperty(t.prototype,"filter",{get:function(){return this._filter},enumerable:!0,configurable:!0}),t.prototype.assemble=function(){var e=this;return o.keys(this._filter).filter(function(t){return e._filter[t]}).map(function(e){return{type:"filter",expr:"datum["+o.stringValue(e)+"] > 0"}})},t}(e("./dataflow").DataFlowNode);n.NonPositiveFilterNode=s},{"../../channel":12,"../../scale":104,"../../util":114,"./dataflow":27,tslib:5}],34:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib"),r=e("../../channel"),a=e("../../scale"),o=e("../../type"),s=e("../../util"),l=function(e){function t(t){var n=e.call(this)||this;return n._filteredFields=t,n}return i.__extends(t,e),t.prototype.clone=function(){return new t(s.duplicate(this._filteredFields))},t.make=function(e){var n=e.reduceFieldDef(function(t,n,i){if("filter"===e.config.invalidValues&&!n.aggregate&&n.field){var o=r.isScaleChannel(i)&&e.getScaleComponent(i);if(o){var s=o.get("type");a.hasContinuousDomain(s)&&(t[n.field]=n)}}return t},{});return 0===s.keys(n).length?null:new t(n)},Object.defineProperty(t.prototype,"filteredFields",{get:function(){return this._filteredFields},enumerable:!0,configurable:!0}),t.prototype.merge=function(e){var t=this,n=s.keys(this._filteredFields).map(function(e){return e+" "+s.hash(t._filteredFields[e])}),r=s.keys(e.filteredFields).map(function(t){return t+" "+s.hash(e.filteredFields[t])});s.differArray(n,r)||(this._filteredFields=i.__assign({},this._filteredFields,e._filteredFields),e.remove())},t.prototype.assemble=function(){var e=this,t=s.keys(this._filteredFields).reduce(function(t,n){var i=e._filteredFields[n];return null!==i&&(t.push("datum["+s.stringValue(i.field)+"] !== null"),s.contains([o.QUANTITATIVE,o.TEMPORAL],i.type)&&t.push("!isNaN(datum["+s.stringValue(i.field)+"])")),t},[]);return t.length>0?{type:"filter",expr:t.join(" && ")}:null},t}(e("./dataflow").DataFlowNode);n.NullFilterNode=l},{"../../channel":12,"../../scale":104,"../../type":113,"../../util":114,"./dataflow":27,tslib:5}],35:[function(e,t,n){"use strict";function i(e){function t(i){if(!(i instanceof d.FacetNode)){var r=i.clone();if(r instanceof f.OutputNode){var a=n.FACET_SCALE_PREFIX+r.getSource();r.setSource(a),e.model.component.data.outputNodes[a]=r}else(r instanceof c.AggregateNode||r instanceof h.StackNode)&&r.addDimensions(e.fields);return u.flatten(i.children.map(t)).forEach(function(e){return e.parent=r}),[r]}return u.flatten(i.children.map(t))}return t}function r(e){if(e instanceof d.FacetNode)if(1!==e.numChildren()||e.children[0]instanceof f.OutputNode)a(e.model.component.data.main),u.flatten(e.children.map(i(e))).forEach(function(t){return t.parent=e.model.component.data.main});else{var t=e.children[0];(t instanceof c.AggregateNode||t instanceof h.StackNode)&&t.addDimensions(e.fields),t.swapWithParent(),r(e)}else e.children.forEach(r)}function a(e){if(e instanceof f.OutputNode&&e.type===l.MAIN&&1===e.numChildren()){var t=e.children[0];t instanceof d.FacetNode||(t.swapWithParent(),a(e))}}function o(e){e instanceof p.NonPositiveFilterNode&&u.every(u.vals(e.filter),function(e){return!1===e})&&e.remove(),e instanceof m.NullFilterNode&&u.every(u.vals(e.filteredFields),function(e){return null===e})&&e.remove(),e instanceof f.OutputNode&&!e.isRequired()&&e.remove(),e.children.forEach(o)}function s(e){function t(e){0===e.numChildren()?n.push(e):e.children.forEach(t)}var n=[];return e.forEach(t),n}Object.defineProperty(n,"__esModule",{value:!0});var l=e("../../data"),u=e("../../util"),c=e("./aggregate"),f=e("./dataflow"),d=e("./facet"),p=e("./nonpositivefilter"),m=e("./nullfilter"),g=e("./optimizers"),h=e("./stack");n.FACET_SCALE_PREFIX="scale_",n.optimizeDataflow=function(e){var t=u.vals(e.sources);t.forEach(o),s(t=t.filter(function(e){return e.numChildren()>0})).forEach(g.iterateFromLeaves(g.removeUnusedSubtrees)),s(t=t.filter(function(e){return e.numChildren()>0})).forEach(g.iterateFromLeaves(g.moveParseUp)),s(t).forEach(g.removeDuplicateTimeUnits),t.forEach(r),u.keys(e.sources).forEach(function(t){0===e.sources[t].numChildren()&&delete e.sources[t]})}},{"../../data":92,"../../util":114,"./aggregate":23,"./dataflow":27,"./facet":28,"./nonpositivefilter":33,"./nullfilter":34,"./optimizers":36,"./stack":39}],36:[function(e,t,n){"use strict";function i(e){function t(n){if(!(n instanceof l.SourceNode)){var i=n.parent;e(n)&&t(i)}}return t}Object.defineProperty(n,"__esModule",{value:!0});var r=e("tslib"),a=e("../../util"),o=e("./dataflow"),s=e("./formatparse"),l=e("./source"),u=e("./timeunit");n.iterateFromLeaves=i,n.moveParseUp=function(e){var t=e.parent;if(e instanceof s.ParseNode){if(t instanceof l.SourceNode)return!1;if(t.numChildren()>1)return!0;if(t instanceof s.ParseNode)t.merge(e);else{if(a.hasIntersection(t.producedFields(),e.dependentFields()))return!0;e.swapWithParent()}}return!0},n.removeUnusedSubtrees=function(e){return!(e instanceof o.OutputNode||e.numChildren()>0||(e.remove(),0))},n.removeDuplicateTimeUnits=function(e){var t={};return i(function(e){if(e instanceof u.TimeUnitNode){var n=e.producedFields();a.keys(n).every(function(e){return!!t[e]})?e.remove():t=r.__assign({},t,n)}return!0})(e)}},{"../../util":114,"./dataflow":27,"./formatparse":30,"./source":38,"./timeunit":40,tslib:5}],37:[function(e,t,n){"use strict";function i(e,t){if(e.data||!e.parent){var n=new w.SourceNode(e.data),i=n.hash();return i in t?t[i]:(t[i]=n,n)}return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}function r(e){function t(e){r?e.parent?i.insertAsParentOf(e):e.parent=i:r=e.parent||e,i=e}var n,i,r=null,a=0;return e.transforms.forEach(function(i){if(f.isCalculate(i))n=new v.CalculateNode(i);else if(f.isFilter(i)){var r={},s=i.filter,p=null;u.isEqualFilter(s)?p=s.equal:u.isRangeFilter(s)?p=s.range[0]:u.isOneOfFilter(s)&&(p=(s.oneOf||s.in)[0]),p&&(l.isDateTime(p)?r[s.field]="date":o.isNumber(p)?r[s.field]="number":o.isString(p)&&(r[s.field]="string")),d.keys(r).length>0&&t(new S.ParseNode(r)),n=new _.FilterNode(e,i.filter)}else if(f.isBin(i))n=h.BinNode.makeFromTransform(i,{model:e});else if(f.isTimeUnit(i))n=k.TimeUnitNode.makeFromTransform(i);else if(f.isSummarize(i))n=g.AggregateNode.makeFromTransform(i),m.requiresSelectionId(e)&&(t(n),n=new E.IdentifierNode);else{if(!f.isLookup(i))return void c.warn(c.message.invalidTransformIgnored(i));n=x.LookupNode.make(e,i,a++)}t(n)}),{first:r,last:n}}Object.defineProperty(n,"__esModule",{value:!0});var a=e("tslib"),o=e("vega-util"),s=e("../../data"),l=e("../../datetime"),u=e("../../filter"),c=e("../../log"),f=e("../../transform"),d=e("../../util"),p=e("../model"),m=e("../selection/selection"),g=e("./aggregate"),h=e("./bin"),v=e("./calculate"),y=e("./dataflow"),b=e("./facet"),_=e("./filter"),S=e("./formatparse"),E=e("./indentifier"),x=e("./lookup"),O=e("./nonpositivefilter"),N=e("./nullfilter"),w=e("./source"),T=e("./stack"),k=e("./timeunit");n.parseTransformArray=r,n.parseData=function(e){var t=i(e,e.component.data.sources),n=e.component.data.outputNodes,o=e.component.data.outputNodeRefCounts,l=t;m.requiresSelectionId(e)&&!e.parent&&((P=new E.IdentifierNode).parent=l,l=P);var u=e.parent&&p.isLayerModel(e.parent);if((p.isUnitModel(e)||p.isFacetModel(e))&&u&&(x=h.BinNode.makeBinFromEncoding(e))&&(x.parent=l,l=x),e.transforms.length>0){var c=r(e),f=c.first,d=c.last;f.parent=l,l=d}var v=S.ParseNode.make(e);if(v&&(v.parent=l,l=v),p.isUnitModel(e)||p.isFacetModel(e)){var _=N.NullFilterNode.make(e);if(_&&(_.parent=l,l=_),!u){var x=h.BinNode.makeBinFromEncoding(e);x&&(x.parent=l,l=x)}var w=k.TimeUnitNode.makeFromEncoding(e);w&&(w.parent=l,l=w)}var D=e.getName(s.RAW),C=new y.OutputNode(D,s.RAW,o);if(n[D]=C,C.parent=l,l=C,p.isUnitModel(e)){var A=g.AggregateNode.makeFromEncoding(e);if(A&&(A.parent=l,l=A,m.requiresSelectionId(e))){var P=new E.IdentifierNode;P.parent=l,l=P}var R=T.StackNode.make(e);R&&(R.parent=l,l=R);var M=O.NonPositiveFilterNode.make(e);M&&(M.parent=l,l=M)}var L=e.getName(s.MAIN),I=new y.OutputNode(L,s.MAIN,o);n[L]=I,I.parent=l,l=I;var F=null;if(p.isFacetModel(e)){var U=e.getName("facet");F=new b.FacetNode(e,U,I.getSource()),n[U]=F,F.parent=l,l=F}var z=a.__assign({},e.component.data.ancestorParse,v?v.parse:{});return a.__assign({},e.component.data,{outputNodes:n,outputNodeRefCounts:o,raw:C,main:I,facetRoot:F,ancestorParse:z})}},{"../../data":92,"../../datetime":93,"../../filter":97,"../../log":101,"../../transform":112,"../../util":114,"../model":63,"../selection/selection":76,"./aggregate":23,"./bin":25,"./calculate":26,"./dataflow":27,"./facet":28,"./filter":29,"./formatparse":30,"./indentifier":31,"./lookup":32,"./nonpositivefilter":33,"./nullfilter":34,"./source":38,"./stack":39,"./timeunit":40,tslib:5,"vega-util":7}],38:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib"),r=e("../../data"),a=e("../../util"),o=function(e){function t(t){var n=e.call(this)||this;if(t=t||{name:"source"},r.isInlineData(t))n._data={values:t.values};else if(r.isUrlData(t)){var o=/(?:\.([^.]+))?$/.exec(t.url)[1];a.contains(["json","csv","tsv","topojson"],o)||(o="json");var s=t.format||{},l=s.type||t.formatType,u=s.property,c=s.feature,f=s.mesh,d=i.__assign({type:l||o},u?{property:u}:{},c?{feature:c}:{},f?{mesh:f}:{});n._data={url:t.url,format:d}}else r.isNamedData(t)&&(n._name=t.name,n._data={});return n}return i.__extends(t,e),Object.defineProperty(t.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),t.prototype.hasName=function(){return!!this._name},Object.defineProperty(t.prototype,"dataName",{get:function(){return this._name},set:function(e){this._name=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{set:function(e){throw new Error("Source nodes have to be roots.")},enumerable:!0,configurable:!0}),t.prototype.remove=function(){throw new Error("Source nodes are roots and cannot be removed.")},t.prototype.hash=function(){return r.isInlineData(this._data)?a.hash(this._data):r.isUrlData(this._data)?this._data.url+" "+a.hash(this._data.format):this._name},t.prototype.assemble=function(){return i.__assign({name:this._name},this._data,{transform:[]})},t}(e("./dataflow").DataFlowNode);n.SourceNode=o},{"../../data":92,"../../util":114,"./dataflow":27,tslib:5}],39:[function(e,t,n){"use strict";function i(e){return e.stack.stackBy.reduce(function(e,t){var n=t.fieldDef,i=o.field(n);return i&&e.push(i),e},[])}Object.defineProperty(n,"__esModule",{value:!0});var r=e("tslib"),a=e("vega-util"),o=e("../../fielddef"),s=e("../../util"),l=e("../common"),u=function(e){function t(t){var n=e.call(this)||this;return n._stack=t,n}return r.__extends(t,e),t.prototype.clone=function(){return new t(s.duplicate(this._stack))},t.make=function(e){var n=e.stack;if(!n)return null;var r;n.groupbyChannel&&(r=e.fieldDef(n.groupbyChannel));var a,o=i(e),s=e.encoding.order;return a=s?l.sortParams(s):o.reduce(function(e,t){return e.field.push(t),e.order.push("descending"),e},{field:[],order:[]}),new t({dimensionFieldDef:r,field:e.field(n.fieldChannel),facetby:[],stackby:o,sort:a,offset:n.offset,impute:n.impute})},Object.defineProperty(t.prototype,"stack",{get:function(){return this._stack},enumerable:!0,configurable:!0}),t.prototype.addDimensions=function(e){this._stack.facetby=this._stack.facetby.concat(e)},t.prototype.dependentFields=function(){var e={};e[this._stack.field]=!0,this.getGroupbyFields().forEach(function(t){return e[t]=!0}),this._stack.facetby.forEach(function(t){return e[t]=!0});var t=this._stack.sort.field;return a.isArray(t)?t.forEach(function(t){return e[t]=!0}):e[t]=!0,e},t.prototype.producedFields=function(){var e={};return e[this._stack.field+"_start"]=!0,e[this._stack.field+"_end"]=!0,e},t.prototype.getGroupbyFields=function(){var e=this._stack,t=e.dimensionFieldDef,n=e.impute;return t?t.bin?n?[o.field(t,{binSuffix:"mid"})]:[o.field(t,{}),o.field(t,{binSuffix:"end"})]:[o.field(t)]:[]},t.prototype.assemble=function(){var e=[],t=this._stack,n=t.facetby,i=t.field,r=t.dimensionFieldDef,a=t.impute,s=t.offset,l=t.sort,u=t.stackby;if(a&&r){var c=r?o.field(r,{binSuffix:"mid"}):void 0;r.bin&&e.push({type:"formula",expr:"("+o.field(r,{expr:"datum"})+"+"+o.field(r,{expr:"datum",binSuffix:"end"})+")/2",as:c}),e.push({type:"impute",field:i,groupby:u,key:c,method:"value",value:0})}return e.push({type:"stack",groupby:this.getGroupbyFields().concat(n),field:i,sort:l,as:[i+"_start",i+"_end"],offset:s}),e},t}(e("./dataflow").DataFlowNode);n.StackNode=u},{"../../fielddef":96,"../../util":114,"../common":20,"./dataflow":27,tslib:5,"vega-util":7}],40:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib"),r=e("../../fielddef"),a=e("../../timeunit"),o=e("../../util"),s=function(e){function t(t){var n=e.call(this)||this;return n.formula=t,n}return i.__extends(t,e),t.prototype.clone=function(){return new t(o.duplicate(this.formula))},t.makeFromEncoding=function(e){var n=e.reduceFieldDef(function(e,t){if(t.timeUnit){var n=r.field(t);e[n]={as:n,timeUnit:t.timeUnit,field:t.field}}return e},{});return 0===o.keys(n).length?null:new t(n)},t.makeFromTransform=function(e){return new t((n={},n[e.field]={as:e.as,timeUnit:e.timeUnit,field:e.field},n));var n},t.prototype.merge=function(e){this.formula=i.__assign({},this.formula,e.formula),e.remove()},t.prototype.producedFields=function(){var e={};return o.vals(this.formula).forEach(function(t){e[t.as]=!0}),e},t.prototype.dependentFields=function(){var e={};return o.vals(this.formula).forEach(function(t){e[t.field]=!0}),e},t.prototype.assemble=function(){return o.vals(this.formula).map(function(e){return{type:"formula",as:e.as,expr:a.fieldExpr(e.timeUnit,e.field)}})},t}(e("./dataflow").DataFlowNode);n.TimeUnitNode=s},{"../../fielddef":96,"../../timeunit":109,"../../util":114,"./dataflow":27,tslib:5}],41:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib"),r=e("../channel"),a=e("../encoding"),o=e("../fielddef"),s=e("../log"),l=e("../scale"),u=e("../util"),c=e("../vega.schema"),f=e("./buildmodel"),d=e("./data/assemble"),p=e("./data/parse"),m=e("./layout/header"),g=e("./layoutsize/parse"),h=e("./model"),v=e("./repeater"),y=e("./resolve"),b=e("./scale/domain"),_=function(e){function t(t,n,i,r,a){var o=e.call(this,t,n,i,a,t.resolve)||this;o.type="facet",o.child=f.buildModel(t.spec,o,o.getName("child"),void 0,r,a),o.children=[o.child];var s=v.replaceRepeaterInFacet(t.facet,r);return o.facet=o.initFacet(s),o}return i.__extends(t,e),t.prototype.initFacet=function(e){return a.reduce(e,function(e,t,n){return u.contains([r.ROW,r.COLUMN],n)?void 0===t.field?(s.warn(s.message.emptyFieldDef(t,n)),e):(e[n]=o.normalize(t,n),e):(s.warn(s.message.incompatibleChannel(n,"facet")),e)},{})},t.prototype.channelHasField=function(e){return!!this.facet[e]},t.prototype.fieldDef=function(e){return this.facet[e]},t.prototype.parseData=function(){this.component.data=p.parseData(this),this.child.parseData()},t.prototype.parseLayoutSize=function(){g.parseChildrenLayoutSize(this)},t.prototype.parseSelection=function(){this.child.parseSelection(),this.component.selection=this.child.component.selection},t.prototype.parseMarkGroup=function(){this.child.parseMarkGroup()},t.prototype.parseAxisAndHeader=function(){this.child.parseAxisAndHeader(),this.parseHeader("column"),this.parseHeader("row"),this.mergeChildAxis("x"),this.mergeChildAxis("y")},t.prototype.parseHeader=function(e){if(this.channelHasField(e)){var t=this.facet[e],n=t.header||{},i=void 0!==n.title?n.title:o.title(t,this.config);this.child.component.layoutHeaders[e].title&&(i+=" / "+this.child.component.layoutHeaders[e].title,this.child.component.layoutHeaders[e].title=null),this.component.layoutHeaders[e]={title:i,facetFieldDef:t,header:[this.makeHeaderComponent(e,!0)]}}},t.prototype.makeHeaderComponent=function(e,t){var n="row"===e?"height":"width";return{labels:t,sizeSignal:this.child.component.layoutSize.get(n)?this.child.getSizeSignalRef(n):void 0,axes:[]}},t.prototype.mergeChildAxis=function(e){var t=this.child;if(t.component.axes[e]){var n=this.component,i=n.layoutHeaders,r=n.resolve;if(r.axis[e]=y.parseGuideResolve(r,e),"shared"===r.axis[e])for(var a="x"===e?"column":"row",o=i[a],s=0,l=t.component.axes[e];s<l.length;s++){var u=l[s],c=u.main,f=m.getHeaderType(c.get("orient"));o[f]=o[f]||[this.makeHeaderComponent(a,!1)],o[f][0].axes.push(c.combine()),delete u.main}}},t.prototype.assembleSelectionTopLevelSignals=function(e){return this.child.assembleSelectionTopLevelSignals(e)},t.prototype.assembleSelectionSignals=function(){return this.child.assembleSelectionSignals(),[]},t.prototype.assembleSelectionData=function(e){return this.child.assembleSelectionData(e)},t.prototype.getLayoutBandMixins=function(e){for(var t={},n="header"===e?"headerBand":"footerBand",i=0,r=["row","column"];i<r.length;i++){var a=r[i],o=this.component.layoutHeaders[a][e];if(o&&o[0]){var s="row"===a?"height":"width";this.child.component.layoutSize.get(s)||(t[n]=t[n]||{},t[n][a]=.5)}}return t},t.prototype.assembleLayout=function(){var e=this.channelHasField("column")?this.columnDistinctSignal():1;return i.__assign({padding:{row:10,column:10}},this.getLayoutBandMixins("header"),this.getLayoutBandMixins("footer"),{offset:10,columns:e,bounds:"full",align:"all"})},t.prototype.assembleLayoutSignals=function(){return this.child.assembleLayoutSignals()},t.prototype.columnDistinctSignal=function(){return this.parent&&this.parent instanceof t?void 0:{signal:"length(data('"+this.getName("column_domain")+"'))"}},t.prototype.assembleGroup=function(n){return this.parent&&this.parent instanceof t?i.__assign({},this.channelHasField("column")?{encode:{update:{columns:{field:o.field(this.facet.column,{prefix:"distinct"})}}}}:{},e.prototype.assembleGroup.call(this,n)):e.prototype.assembleGroup.call(this,n)},t.prototype.getCardinalityAggregateForChild=function(){var e=[],n=[];if(this.child instanceof t)this.child.channelHasField("column")&&(e.push(o.field(this.child.facet.column)),n.push("distinct"));else for(var i=0,r=["x","y"];i<r.length;i++){var a=r[i],u=this.child.component.scales[a];if(u&&!u.merged){var f=u.get("type"),d=u.get("range");if(l.hasDiscreteDomain(f)&&c.isVgRangeStep(d)){var p=b.assembleDomain(this.child,a),m=b.getFieldFromDomain(p);m?(e.push(m),n.push("distinct")):s.warn("Unknown field for ${channel}.  Cannot calculate view size.")}}}return e.length?{fields:e,ops:n}:void 0},t.prototype.assembleMarks=function(){var e=this,t=e.child,n=e.facet,a=this.component.data.facetRoot,o=d.assembleFacetData(a),s=this.channelHasField(r.ROW),l=this.channelHasField(r.COLUMN),u=t.assembleLayoutSize(),c={};s&&l&&(c.aggregate={cross:!0});var f=this.getCardinalityAggregateForChild();f&&(c.aggregate=i.__assign({},c.aggregate,f));var p=t.assembleTitle(),m=t.assembleGroupStyle();return[i.__assign({name:this.getName("cell"),type:"group"},p?{title:p}:{},m?{style:m}:{},{from:{facet:i.__assign({name:a.name,data:a.data,groupby:[].concat(s?[this.field(r.ROW)]:[],l?[this.field(r.COLUMN)]:[])},c)},sort:{field:[].concat(s?[this.field(r.ROW,{expr:"datum"})]:[],l?[this.field(r.COLUMN,{expr:"datum"})]:[]),order:[].concat(s?[n.row.sort||"ascending"]:[],l?[n.column.sort||"ascending"]:[])}},o.length>0?{data:o}:{},u?{encode:{update:u}}:{},t.assembleGroup())]},t.prototype.getMapping=function(){return this.facet},t}(h.ModelWithField);n.FacetModel=_},{"../channel":12,"../encoding":94,"../fielddef":96,"../log":101,"../scale":104,"../util":114,"../vega.schema":116,"./buildmodel":19,"./data/assemble":24,"./data/parse":37,"./layout/header":43,"./layoutsize/parse":45,"./model":63,"./repeater":65,"./resolve":66,"./scale/domain":69,tslib:5}],42:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib"),r=e("../log"),a=e("../spec"),o=e("../util"),s=e("./axis/parse"),l=e("./data/parse"),u=e("./layoutsize/assemble"),c=e("./layoutsize/parse"),f=e("./model"),d=e("./selection/selection"),p=e("./unit"),m=function(e){function t(n,o,s,l,u,c){var f=e.call(this,n,o,s,c,n.resolve)||this;f.type="layer";var d=i.__assign({},l,n.width?{width:n.width}:{},n.height?{height:n.height}:{});return f.initSize(d),f.children=n.layer.map(function(e,n){if(a.isLayerSpec(e))return new t(e,f,f.getName("layer_"+n),d,u,c);if(a.isUnitSpec(e))return new p.UnitModel(e,f,f.getName("layer_"+n),d,u,c);throw new Error(r.message.INVALID_SPEC)}),f}return i.__extends(t,e),t.prototype.parseData=function(){this.component.data=l.parseData(this);for(var e=0,t=this.children;e<t.length;e++)t[e].parseData()},t.prototype.parseLayoutSize=function(){c.parseLayerLayoutSize(this)},t.prototype.parseSelection=function(){var e=this;this.component.selection={};for(var t=0,n=this.children;t<n.length;t++)!function(t){t.parseSelection(),o.keys(t.component.selection).forEach(function(n){e.component.selection[n]=t.component.selection[n]})}(n[t])},t.prototype.parseMarkGroup=function(){for(var e=0,t=this.children;e<t.length;e++)t[e].parseMarkGroup()},t.prototype.parseAxisAndHeader=function(){s.parseLayerAxis(this)},t.prototype.assembleSelectionTopLevelSignals=function(e){return this.children.reduce(function(e,t){return t.assembleSelectionTopLevelSignals(e)},e)},t.prototype.assembleSelectionSignals=function(){return this.children.reduce(function(e,t){return e.concat(t.assembleSelectionSignals())},[])},t.prototype.assembleLayoutSignals=function(){return this.children.reduce(function(e,t){return e.concat(t.assembleLayoutSignals())},u.assembleLayoutSignals(this))},t.prototype.assembleSelectionData=function(e){return this.children.reduce(function(e,t){return t.assembleSelectionData(e)},[])},t.prototype.assembleTitle=function(){var t=e.prototype.assembleTitle.call(this);if(t)return t;for(var n=0,i=this.children;n<i.length;n++)if(t=i[n].assembleTitle())return t},t.prototype.assembleLayout=function(){return null},t.prototype.assembleMarks=function(){return d.assembleLayerSelectionMarks(this,o.flatten(this.children.map(function(e){return e.assembleMarks()})))},t}(f.Model);n.LayerModel=m},{"../log":101,"../spec":107,"../util":114,"./axis/parse":16,"./data/parse":37,"./layoutsize/assemble":44,"./layoutsize/parse":45,"./model":63,"./selection/selection":76,"./unit":87,tslib:5}],43:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib"),r=e("../../fielddef"),a=e("../common");n.HEADER_CHANNELS=["row","column"],n.HEADER_TYPES=["header","footer"],n.getHeaderType=function(e){return"top"===e||"left"===e?"header":"footer"},n.getTitleGroup=function(e,t){var n=e.component.layoutHeaders[t].title,r="row"===t?"vertical":void 0;return{name:e.getName(t+"_title"),role:t+"-title",type:"group",marks:[{type:"text",role:t+"-title-text",style:"guide-title",encode:{update:i.__assign({align:{value:"center"},text:{value:n}},"vertical"===r?{angle:{value:270}}:{})}}]}},n.getHeaderGroup=function(e,t,n,o,s){if(s){var l=null;if(o.facetFieldDef&&s.labels){var u=o.facetFieldDef,c=u.header?u.header.format:void 0;l={text:a.formatSignalRef(u,c,"parent",e.config),offset:10,orient:"row"===t?"left":"top",style:"guide-label",encode:{update:i.__assign({fontWeight:{value:"normal"},angle:{value:0},fontSize:{value:10}},"row"===t?{align:{value:"right"},baseline:{value:"middle"}}:{})}}}var f=s.axes,d=f&&f.length>0;if(l||d){var p="row"===t?"height":"width";return i.__assign({name:e.getName(t+"_"+n),type:"group",role:t+"-"+n},o.facetFieldDef?{from:{data:e.getName(t+"_domain")},sort:{field:r.field(o.facetFieldDef,{expr:"datum"}),order:o.facetFieldDef.header&&o.facetFieldDef.sort||"ascending"}}:{},l?{title:l}:{},s.sizeSignal?{encode:{update:(m={},m[p]=s.sizeSignal,m)}}:{},d?{axes:f}:{})}}return null;var m}},{"../../fielddef":96,"../common":20,tslib:5}],44:[function(e,t,n){"use strict";function i(e,t){var n="width"===t?"x":"y",i=e.component.layoutSize.get(t);if(!i||"merged"===i)return[];var u=e.getSizeSignalRef(t).signal;if("range-step"===i){var c=e.getScaleComponent(n);if(c){var f=c.get("type"),d=c.get("range");if(o.hasDiscreteDomain(f)&&s.isVgRangeStep(d)){var p=e.scaleName(n);return l.isFacetModel(e.parent)&&"independent"===e.parent.component.resolve.scale[n]?[r(p,d)]:[r(p,d),{name:u,update:a(p,c,"domain('"+p+"').length")}]}}throw new Error("layout size is range step although there is no rangeStep.")}return[{name:u,update:""+i}]}function r(e,t){return{name:e+"_step",value:t.step}}function a(e,t,n){var i=t.get("type"),r=t.get("padding"),a=t.get("paddingOuter");a=void 0!==a?a:r;var o=t.get("paddingInner");return o="band"===i?void 0!==o?o:r:1,"bandspace("+n+", "+o+", "+a+") * "+e+"_step"}Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../scale"),s=e("../../vega.schema"),l=e("../model");n.assembleLayoutSignals=function(e){return[].concat(i(e,"width"),i(e,"height"))},n.sizeSignals=i,n.sizeExpr=a},{"../../scale":104,"../../vega.schema":116,"../model":63}],45:[function(e,t,n){"use strict";function i(e){r(e);var t=e.component.layoutSize;t.setWithExplicit("width",a(e,"width")),t.setWithExplicit("height",a(e,"height"))}function r(e){for(var t=0,n=e.children;t<n.length;t++)n[t].parseLayoutSize()}function a(e,t){for(var n,i="width"===t?"x":"y",r=e.component.resolve,a=0,o=e.children;a<o.length;a++){var s=(d=o[a]).component.layoutSize.getWithExplicit(t),l=r.scale[i];if("independent"===l&&"range-step"===s.value){n=void 0;break}if(n){if("independent"===l&&n.value!==s.value){n=void 0;break}n=u.mergeValuesWithExplicit(n,s,t,"",u.defaultTieBreaker)}else n=s}if(n){for(var c=0,f=e.children;c<f.length;c++){var d=f[c];e.renameLayoutSize(d.getName(t),e.getName(t)),d.component.layoutSize.set(t,"merged",!1)}return n}return{explicit:!1,value:void 0}}function o(e,t){var n="width"===t?"x":"y",i=e.config,r=e.getScaleComponent(n);if(r){var a=r.get("type"),o=r.get("range");return s.hasDiscreteDomain(a)&&l.isVgRangeStep(o)?"range-step":i.view[t]}return"width"===t&&"text"===e.mark()?i.scale.textXRangeStep:i.scale.rangeStep||s.defaultScaleConfig.rangeStep}Object.defineProperty(n,"__esModule",{value:!0});var s=e("../../scale"),l=e("../../vega.schema"),u=e("../split");n.parseLayerLayoutSize=i,n.parseRepeatLayoutSize=i,n.parseConcatLayoutSize=function(e){r(e);var t=e.component.layoutSize,n=e.isVConcat?"width":"height";t.setWithExplicit(n,a(e,n))},n.parseChildrenLayoutSize=r,n.parseUnitLayoutSize=function(e){var t=e.component.layoutSize;if(!t.explicit.width){var n=o(e,"width");t.set("width",n,!1)}if(!t.explicit.height){var i=o(e,"height");t.set("height",i,!1)}}},{"../../scale":104,"../../vega.schema":116,"../split":86}],46:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("json-stable-stringify"),r=e("../../util"),a=e("./parse");n.assembleLegends=function(e){var t=e.component.legends,n={};return r.keys(t).forEach(function(r){var o=e.getScaleComponent(r),s=i(o.domains);if(n[s])for(var l=0,u=n[s];l<u.length;l++){var c=u[l];a.mergeLegendComponent(c,t[r])||n[s].push(t[r])}else n[s]=[t[r].clone()]}),r.flatten(r.vals(n)).map(function(e){return e.combine()})}},{"../../util":114,"./parse":49,"json-stable-stringify":1}],47:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib"),r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i.__extends(t,e),t}(e("../split").Split);n.LegendComponent=r},{"../split":86,tslib:5}],48:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib"),r=e("../../channel"),a=e("../../fielddef"),o=e("../../mark"),s=e("../../scale"),l=e("../../util"),u=e("../common"),c=e("../mark/mixins");n.symbols=function(e,t,n,s,f){if("gradient"!==f.get("type")){var d={},p=n.mark();switch(p){case o.BAR:case o.TICK:case o.TEXT:d.shape={value:"square"};break;case o.CIRCLE:case o.SQUARE:d.shape={value:p};break;case o.POINT:case o.LINE:case o.AREA:}var m=n.markDef.filled,g=s===r.COLOR?l.without(o.FILL_STROKE_CONFIG,[m?"fill":"stroke","strokeDash","strokeDashOffset"]):o.FILL_STROKE_CONFIG;if(g=l.without(g,["strokeDash","strokeDashOffset"]),u.applyMarkConfig(d,n,g),s!==r.COLOR){var h=c.color(n);h.fill&&(h.fill.field||"transparent"===h.fill.value)&&delete h.fill,h.stroke&&(h.stroke.field||"transparent"===h.stroke.value)&&delete h.stroke,d=i.__assign({},d,h)}if(s!==r.SHAPE){var v=n.encoding.shape;a.isValueDef(v)&&(d.shape={value:v.value})}if(s!==r.OPACITY){var y=n.encoding.opacity;a.isValueDef(y)&&(d.opacity={value:y.value})}return d=i.__assign({},d,t),l.keys(d).length>0?d:void 0}},n.gradient=function(e,t,n,r,o){var s={};if("gradient"===o.get("type")){var u=n.encoding.opacity;a.isValueDef(u)&&(s.opacity={value:u.value})}return s=i.__assign({},s,t),l.keys(s).length>0?s:void 0},n.labels=function(e,t,n,r,o){var c=n.legend(r),f=n.config,d={};if(a.isTimeFieldDef(e)){var p=n.getScaleComponent(r).get("type")===s.ScaleType.UTC;t=i.__assign({text:{signal:u.timeFormatExpression("datum.value",e.timeUnit,c.format,f.legend.shortTimeLabels,f.timeFormat,p)}},t)}return d=i.__assign({},d,t),l.keys(d).length>0?d:void 0}},{"../../channel":12,"../../fielddef":96,"../../mark":103,"../../scale":104,"../../util":114,"../common":20,"../mark/mixins":56,tslib:5}],49:[function(e,t,n){"use strict";function i(e){g.isUnitModel(e)?e.component.legends=r(e):e.component.legends=l(e)}function r(e){return[c.COLOR,c.SIZE,c.SHAPE,c.OPACITY].reduce(function(t,n){return e.legend(n)&&(t[n]=o(e,n)),t},{})}function a(e,t){switch(t){case c.COLOR:var n=e.scaleName(c.COLOR);return e.markDef.filled?{fill:n}:{stroke:n};case c.SIZE:return{size:e.scaleName(c.SIZE)};case c.SHAPE:return{shape:e.scaleName(c.SHAPE)};case c.OPACITY:return{opacity:e.scaleName(c.OPACITY)}}return null}function o(e,t){var n=e.fieldDef(t),i=e.legend(t),r=new b.LegendComponent({},a(e,t));d.LEGEND_PROPERTIES.forEach(function(n){var a=s(n,i,t,e);if(void 0!==a){var o="values"===n?!!i.values:a===i[n];r.set(n,a,o)}});var o=i.encoding||{},l=["labels","legend","title","symbols","gradient"].reduce(function(i,a){var s=_[a]?_[a](n,o[a],e,t,r):o[a];return void 0!==s&&p.keys(s).length>0&&(i[a]={update:s}),i},{});return p.keys(l).length>0&&r.set("encode",l,!!i.encoding),r}function s(e,t,n,i){var r=i.fieldDef(n);switch(e){case"format":return m.numberFormat(r,t.format,i.config);case"title":return m.getSpecifiedOrDefaultValue(t.title,f.title(r,i.config));case"values":return S.values(t);case"type":return m.getSpecifiedOrDefaultValue(t.type,S.type(r.type,n,i.getScaleComponent(n).get("type")))}return t[e]}function l(e){for(var t=e.component,n=t.legends,r=t.resolve,a=0,o=e.children;a<o.length;a++)!function(t){i(t),p.keys(t.component.legends).forEach(function(i){r.legend[i]=h.parseGuideResolve(e.component.resolve,i),"shared"===r.legend[i]&&(n[i]=u(n[i],t.component.legends[i]),n[i]||(r.legend[i]="independent",delete n[i]))})}(o[a]);return p.keys(n).forEach(function(t){for(var n=0,i=e.children;n<i.length;n++){var a=i[n];a.component.legends[t]&&("shared"===r.legend[t]&&delete a.component.legends[t])}}),n}function u(e,t){if(!e)return t.clone();var n=e.getWithExplicit("orient"),i=t.getWithExplicit("orient");if(!n.explicit||!i.explicit||n.value===i.value){for(var r=!1,a=0,o=d.VG_LEGEND_PROPERTIES;a<o.length;a++)!function(n){var i=y.mergeValuesWithExplicit(e.getWithExplicit(n),t.getWithExplicit(n),n,"legend",function(e,t){switch(n){case"title":return m.titleMerger(e,t);case"type":return r=!0,v.makeImplicit("symbol")}return y.defaultTieBreaker(e,t,n,"legend")});e.setWithExplicit(n,i)}(o[a]);return r&&(((e.implicit||{}).encode||{}).gradient&&p.deleteNestedProperty(e.implicit,["encode","gradient"]),((e.explicit||{}).encode||{}).gradient&&p.deleteNestedProperty(e.explicit,["encode","gradient"])),e}}Object.defineProperty(n,"__esModule",{value:!0});var c=e("../../channel"),f=e("../../fielddef"),d=e("../../legend"),p=e("../../util"),m=e("../common"),g=e("../model"),h=e("../resolve"),v=e("../split"),y=e("../split"),b=e("./component"),_=e("./encode"),S=e("./properties");n.parseLegend=i,n.parseLegendForChannel=o,n.mergeLegendComponent=u},{"../../channel":12,"../../fielddef":96,"../../legend":100,"../../util":114,"../common":20,"../model":63,"../resolve":66,"../split":86,"./component":47,"./encode":48,"./properties":50}],50:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../channel"),r=e("../../datetime"),a=e("../../scale"),o=e("../../util");n.values=function(e){var t=e.values;return t&&r.isDateTime(t[0])?t.map(function(e){return{signal:r.dateTimeExpr(e,!0)}}):t},n.type=function(e,t,n){if(t===i.COLOR&&("quantitative"===e&&!a.isBinScale(n)||"temporal"===e&&o.contains(["time","utc"],n)))return"gradient"}},{"../../channel":12,"../../datetime":93,"../../scale":104,"../../util":114}],51:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib"),r=e("./mixins");n.area={vgMark:"area",encodeEntry:function(e){return i.__assign({},r.pointPosition("x",e,"zeroOrMin"),r.pointPosition("y",e,"zeroOrMin"),r.pointPosition2(e,"zeroOrMin"),r.color(e),r.text(e,"tooltip"),r.nonPosition("opacity",e),r.markDefProperties(e.markDef,["orient","interpolate","tension"]))}}},{"./mixins":56,tslib:5}],52:[function(e,t,n){"use strict";function i(e,t){var n=e.config,i=e.width,r=e.markDef.orient,s=e.encoding.size,c=e.encoding.x,d=e.scaleName(l.X),g=e.getScaleComponent(l.X);if("horizontal"===r)return o.__assign({},p.pointPosition("x",e,"zeroOrMin"),p.pointPosition2(e,"zeroOrMin"));if(u.isFieldDef(c)){var h=g.get("type");if(c.bin&&!s&&!f.hasDiscreteDomain(h))return p.binnedPosition(c,"x",e.scaleName("x"),n.bar.binSpacing,g.get("reverse"));if(h===f.ScaleType.BAND)return p.bandPosition(c,"x",e)}return p.centeredBandPosition("x",e,o.__assign({},m.mid(i)),a(d,g,n))}function r(e,t){var n=e.config,i=e.encoding,r=e.height,s=e.markDef.orient,c=i.size,d=i.y,g=e.scaleName(l.Y),h=e.getScaleComponent(l.Y);if("vertical"===s)return o.__assign({},p.pointPosition("y",e,"zeroOrMin"),p.pointPosition2(e,"zeroOrMin"));if(u.isFieldDef(d)){var v=h.get("type");if(d.bin&&!c&&!f.hasDiscreteDomain(v))return p.binnedPosition(d,"y",e.scaleName("y"),n.bar.binSpacing,h.get("reverse"));if(v===f.ScaleType.BAND)return p.bandPosition(d,"y",e)}return p.centeredBandPosition("y",e,m.mid(r),a(g,h,n))}function a(e,t,n){if(n.bar.discreteBandSize)return{value:n.bar.discreteBandSize};if(t){var i=t.get("type");if(i!==f.ScaleType.POINT)return i===f.ScaleType.BAND?m.band(e):{value:n.bar.continuousBandSize};var r=t.get("range");if(d.isVgRangeStep(r)&&s.isNumber(r.step))return{value:r.step-1};c.warn(c.message.BAR_WITH_POINT_SCALE_AND_RANGESTEP_NULL)}return n.scale.rangeStep&&null!==n.scale.rangeStep?{value:n.scale.rangeStep-1}:{value:20}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("tslib"),s=e("vega-util"),l=e("../../channel"),u=e("../../fielddef"),c=e("../../log"),f=e("../../scale"),d=e("../../vega.schema"),p=e("./mixins"),m=e("./valueref");n.bar={vgMark:"rect",encodeEntry:function(e){e.stack;return o.__assign({},i(e),r(e),p.color(e),p.text(e,"tooltip"),p.nonPosition("opacity",e))}}},{"../../channel":12,"../../fielddef":96,"../../log":101,"../../scale":104,"../../vega.schema":116,"./mixins":56,"./valueref":62,tslib:5,"vega-util":7}],53:[function(e,t,n){"use strict";function i(e,t,n){if(d.contains([u.POINT,u.TICK,u.CIRCLE,u.SQUARE],e)&&!o.isAggregate(t))return.7}function r(e,t){var n=p.getMarkConfig("filled",e,t),i=e.type;return void 0!==n?n:i!==u.POINT&&i!==u.LINE&&i!==u.RULE}function a(e,t,n,i){switch(e){case u.POINT:case u.CIRCLE:case u.SQUARE:case u.TEXT:case u.RECT:return}var r=t.y&&t.y2,a=t.x&&t.x2;switch(e){case u.TICK:var o=n.x?n.x.get("type"):null,d=n.y?n.y.get("type"):null;return!c.hasDiscreteDomain(o)&&(!t.y||c.hasDiscreteDomain(d)||s.isFieldDef(t.y)&&t.y.bin)?"vertical":"horizontal";case u.RULE:case u.BAR:case u.AREA:if(r)return"vertical";if(a)return"horizontal";if(e===u.RULE){if(t.x&&!t.y)return"vertical";if(t.y&&!t.x)return"horizontal"}case u.LINE:var p=s.isFieldDef(t.x)&&s.isContinuous(t.x),m=s.isFieldDef(t.y)&&s.isContinuous(t.y);if(p&&!m)return"horizontal";if(!p&&m)return"vertical";if(p&&m){var g=t.x,h=t.y,v=g.type===f.TEMPORAL,y=h.type===f.TEMPORAL;return v&&!y?"vertical":!v&&y?"horizontal":!g.aggregate&&h.aggregate?"vertical":g.aggregate&&!h.aggregate?"horizontal":i||(e===u.LINE&&t.order||l.warn(l.message.unclearOrientContinuous(e)),"vertical")}return void l.warn(l.message.unclearOrientDiscreteOrEmpty(e))}return"vertical"}Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../encoding"),s=e("../../fielddef"),l=e("../../log"),u=e("../../mark"),c=e("../../scale"),f=e("../../type"),d=e("../../util"),p=e("../common");n.normalizeMarkDef=function(e,t,n,i){var o=e.orient||p.getMarkConfig("orient",e,i);e.orient=a(e.type,t,n,o),void 0!==o&&o!==e.orient&&l.warn(l.message.orientOverridden(e.orient,o)),void 0===e.filled&&(e.filled=r(e,i))},n.initEncoding=function(e,t,n,r){var a=p.getMarkConfig("opacity",e,r);if(!t.opacity&&void 0===a){var o=i(e.type,t);void 0!==o&&(t.opacity={value:o})}return t}},{"../../encoding":94,"../../fielddef":96,"../../log":101,"../../mark":103,"../../scale":104,"../../type":113,"../../util":114,"../common":20}],54:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib"),r=e("./mixins"),a=e("./valueref");n.line={vgMark:"line",encodeEntry:function(e){var t=e.width,n=e.height;return i.__assign({},r.pointPosition("x",e,a.mid(t)),r.pointPosition("y",e,a.mid(n)),r.color(e),r.text(e,"tooltip"),r.nonPosition("opacity",e),r.nonPosition("size",e,{vgChannel:"strokeWidth"}),r.markDefProperties(e.markDef,["interpolate","tension"]))}}},{"./mixins":56,"./valueref":62,tslib:5}],55:[function(e,t,n){"use strict";function i(e){if(b.isUnitModel(e))E.normalizeMarkDef(e.markDef,e.encoding,e.component.scales,e.config);else for(var t=0,n=e.children;t<n.length;t++)i(n[t])}function r(e){var t=e.mark(),n=s(e),i=void 0!==e.markDef.clip?!!e.markDef.clip:l(e),r=y.getStyles(e.markDef),o=a(e),c=[u.__assign({name:e.getName("marks"),type:D[t].vgMark},i?{clip:!0}:{},r?{style:r}:{},o?{sort:o}:{},{from:{data:(n.length>0?C:"")+e.requestDataName(d.MAIN)},encode:{update:D[t].encodeEntry(e)}})];return n.length>0?[{name:e.getName("pathgroup"),type:"group",from:{facet:{name:C+e.requestDataName(d.MAIN),data:e.requestDataName(d.MAIN),groupby:n}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:c}]:c}function a(e){if("line"===e.mark()&&e.channelHasField("order"))return y.sortParams(e.encoding.order,{expr:"datum"});var t="horizontal"===e.markDef.orient?"y":"x",n=e.sort(t);return{field:h.isSortField(n)?m.field({aggregate:p.isAggregate(e.encoding)?n.op:void 0,field:n.field},{expr:"datum"}):e.field(t,{binSuffix:e.stack&&e.stack.impute?"mid":void 0,expr:"datum"}),order:"descending"}}function o(e){var t=e.mark(),n=y.getStyles(e.markDef),i=void 0!==e.markDef.clip?!!e.markDef.clip:l(e),r=[];return r.push(u.__assign({name:e.getName("marks"),type:D[t].vgMark},i?{clip:!0}:{},n?{style:n}:{},{from:{data:e.requestDataName(d.MAIN)},encode:{update:D[t].encodeEntry(e)}})),r}function s(e){return f.NONSPATIAL_CHANNELS.reduce(function(t,n){var i=e.encoding;if("order"===n)return t;if("detail"===n){var r=i[n];r&&(c.isArray(r)?r:[r]).forEach(function(e){e.aggregate||t.push(m.field(e,{}))})}else{var a=m.getFieldDef(i[n]);a&&!a.aggregate&&t.push(m.field(a,{}))}return t},[])}function l(e){var t=e.getScaleComponent("x"),n=e.getScaleComponent("y");return!!(t&&t.get("domainRaw")||n&&n.get("domainRaw"))}Object.defineProperty(n,"__esModule",{value:!0});var u=e("tslib"),c=e("vega-util"),f=e("../../channel"),d=e("../../data"),p=e("../../encoding"),m=e("../../fielddef"),g=e("../../mark"),h=e("../../sort"),v=e("../../util"),y=e("../common"),b=e("../model"),_=e("./area"),S=e("./bar"),E=e("./init"),x=e("./line"),O=e("./point"),N=e("./rect"),w=e("./rule"),T=e("./text"),k=e("./tick"),D={area:_.area,bar:S.bar,line:x.line,point:O.point,text:T.text,tick:k.tick,rect:N.rect,rule:w.rule,circle:O.circle,square:O.square};n.parseMarkDef=i,n.parseMarkGroup=function(e){return v.contains([g.LINE,g.AREA],e.mark())?r(e):o(e)};var C="faceted_path_";n.getPathSort=a},{"../../channel":12,"../../data":92,"../../encoding":94,"../../fielddef":96,"../../mark":103,"../../sort":106,"../../util":114,"../common":20,"../model":63,"./area":51,"./bar":52,"./init":53,"./line":54,"./point":57,"./rect":58,"./rule":59,"./text":60,"./tick":61,tslib:5,"vega-util":7}],56:[function(e,t,n){"use strict";function i(e,t,n){void 0===n&&(n={});var i=n.defaultValue,a=n.vgChannel,o=n.defaultRef||(void 0!==i?{value:i}:void 0),s=t.encoding[e];return r(t,s,a||e,function(n){return d.midPoint(e,n,t.scaleName(e),t.getScaleComponent(e),null,o)})}function r(e,t,n,i){var r=t&&t.condition,a=i(t);if(r){var s=i(r);return l={},l[n]=[o.__assign({test:f.predicate(e,r.selection)},s)].concat(void 0!==a?[a]:[]),l}return void 0!==a?(u={},u[n]=a,u):{};var l,u}function a(e,t,n,i){var r=t.encoding,a=t.stack,o=d.stackable(e,r[e],t.scaleName(e),t.getScaleComponent(e),a,n);return s={},s[i||e]=o,s;var s}Object.defineProperty(n,"__esModule",{value:!0});var o=e("tslib"),s=e("../../fielddef"),l=e("../../log"),u=e("../../util"),c=e("../common"),f=e("../selection/selection"),d=e("./valueref");n.color=function(e){var t=e.config,n=e.markDef.filled?"fill":"stroke",r=i("color",e,{vgChannel:n,defaultValue:c.getMarkConfig(n,e.markDef,t)||c.getMarkConfig("color",e.markDef,t)});return!r.fill&&u.contains(["bar","point","circle","square"],e.mark())&&(r.fill={value:"transparent"}),r},n.markDefProperties=function(e,t){return t.reduce(function(t,n){return e[n]&&(t[n]={value:e[n]}),t},{})},n.valueIfDefined=function(e,t){if(void 0!==t)return n={},n[e]={value:t},n;return;var n},n.nonPosition=i,n.text=function(e,t){void 0===t&&(t="text");var n=e.encoding[t];return r(e,n,t,function(t){return d.text(t,e.config)})},n.bandPosition=function(e,t,n){var r=n.scaleName(t),a="x"===t?"width":"height";if(n.encoding.size)if(n.markDef.orient){var u=(c={},c[t+"c"]=d.fieldRef(e,r,{},{band:.5}),c);if(s.getFieldDef(n.encoding.size))l.warn(l.message.cannotUseSizeFieldWithBandSize(t));else if(s.isValueDef(n.encoding.size))return o.__assign({},u,i("size",n,{vgChannel:a}))}else l.warn(l.message.cannotApplySizeToNonOrientedMark(n.markDef.type));return f={},f[t]=d.fieldRef(e,r,{binSuffix:"range"}),f[a]=d.band(r),f;var c,f},n.centeredBandPosition=function(e,t,n,r){var s="x"===e?"xc":"yc",l="x"===e?"width":"height";return o.__assign({},a(e,t,n,s),i("size",t,{defaultRef:r,vgChannel:l}))},n.binnedPosition=function(e,t,n,i,r){return"x"===t?{x2:d.bin(e,n,"start",r?0:i),x:d.bin(e,n,"end",r?i:0)}:{y2:d.bin(e,n,"start",r?i:0),y:d.bin(e,n,"end",r?0:i)}},n.pointPosition=a,n.pointPosition2=function(e,t,n){var i=e.encoding,r=e.markDef,a=e.stack,o="x2"===(n=n||("horizontal"===r.orient?"x2":"y2"))?"x":"y",s=d.stackable2(n,i[o],i[n],e.scaleName(o),e.getScaleComponent(o),a,t);return l={},l[n]=s,l;var l}},{"../../fielddef":96,"../../log":101,"../../util":114,"../common":20,"../selection/selection":76,"./valueref":62,tslib:5}],57:[function(e,t,n){"use strict";function i(e,t){var n=e.config,i=e.width,o=e.height;return a.__assign({},s.pointPosition("x",e,l.mid(i)),s.pointPosition("y",e,l.mid(o)),s.color(e),s.text(e,"tooltip"),s.nonPosition("size",e),r(e,n,t),s.nonPosition("opacity",e))}function r(e,t,n){return n?{shape:{value:n}}:s.nonPosition("shape",e,{defaultValue:o.getMarkConfig("shape",e.markDef,t)})}Object.defineProperty(n,"__esModule",{value:!0});var a=e("tslib"),o=e("../common"),s=e("./mixins"),l=e("./valueref");n.shapeMixins=r,n.point={vgMark:"symbol",encodeEntry:function(e){return i(e)}},n.circle={vgMark:"symbol",encodeEntry:function(e){return i(e,"circle")}},n.square={vgMark:"symbol",encodeEntry:function(e){return i(e,"square")}}},{"../common":20,"./mixins":56,"./valueref":62,tslib:5}],58:[function(e,t,n){"use strict";function i(e){var t=e.encoding.x,n=e.encoding.x2,i=e.getScaleComponent(o.X),r=i?i.get("type"):void 0;if(s.isFieldDef(t)&&t.bin&&!n)return f.binnedPosition(t,"x",e.scaleName("x"),0,i.get("reverse"));if(s.isFieldDef(t)&&i&&c.hasDiscreteDomain(r)){if(r===c.ScaleType.BAND)return f.bandPosition(t,"x",e);throw new Error(l.message.scaleTypeNotWorkWithMark(u.RECT,r))}return a.__assign({},f.pointPosition("x",e,"zeroOrMax"),f.pointPosition2(e,"zeroOrMin","x2"))}function r(e){var t=e.encoding.y,n=e.encoding.y2,i=e.getScaleComponent(o.Y),r=i?i.get("type"):void 0;if(s.isFieldDef(t)&&t.bin&&!n)return f.binnedPosition(t,"y",e.scaleName("y"),0,i.get("reverse"));if(s.isFieldDef(t)&&i&&c.hasDiscreteDomain(r)){if(r===c.ScaleType.BAND)return f.bandPosition(t,"y",e);throw new Error(l.message.scaleTypeNotWorkWithMark(u.RECT,r))}return a.__assign({},f.pointPosition("y",e,"zeroOrMax"),f.pointPosition2(e,"zeroOrMin","y2"))}Object.defineProperty(n,"__esModule",{value:!0});var a=e("tslib"),o=e("../../channel"),s=e("../../fielddef"),l=e("../../log"),u=e("../../mark"),c=e("../../scale"),f=e("./mixins");n.rect={vgMark:"rect",encodeEntry:function(e){return a.__assign({},i(e),r(e),f.color(e),f.text(e,"tooltip"),f.nonPosition("opacity",e))}}},{"../../channel":12,"../../fielddef":96,"../../log":101,"../../mark":103,"../../scale":104,"./mixins":56,tslib:5}],59:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib"),r=e("./mixins"),a=e("./valueref");n.rule={vgMark:"rule",encodeEntry:function(e){e.config;var t=e.markDef,n=e.width,o=e.height,s=t.orient;return i.__assign({},r.pointPosition("x",e,"horizontal"===s?"zeroOrMin":a.mid(n)),r.pointPosition("y",e,"vertical"===s?"zeroOrMin":a.mid(o)),r.pointPosition2(e,"zeroOrMax"),r.color(e),r.text(e,"tooltip"),r.nonPosition("opacity",e),r.nonPosition("size",e,{vgChannel:"strokeWidth"}))}}},{"./mixins":56,"./valueref":62,tslib:5}],60:[function(e,t,n){"use strict";function i(e,t){return l.isFieldDef(t)&&t.type===u.QUANTITATIVE?{field:{group:"width"},offset:-5}:{value:e.scale.textXRangeStep/2}}function r(e,t,n){if(void 0===c.getMarkConfig("align",e,n))return s.channelHasField(t,o.X)?"center":"right"}Object.defineProperty(n,"__esModule",{value:!0});var a=e("tslib"),o=e("../../channel"),s=e("../../encoding"),l=e("../../fielddef"),u=e("../../type"),c=e("../common"),f=e("./mixins"),d=e("./valueref");n.text={vgMark:"text",encodeEntry:function(e){var t=e.config,n=e.encoding,o=e.height,s=n.text;return a.__assign({},f.pointPosition("x",e,i(t,s)),f.pointPosition("y",e,d.mid(o)),f.text(e),f.color(e),f.text(e,"tooltip"),f.nonPosition("opacity",e),f.nonPosition("size",e,{vgChannel:"fontSize"}),f.valueIfDefined("align",r(e.markDef,n,t)))}}},{"../../channel":12,"../../encoding":94,"../../fielddef":96,"../../type":113,"../common":20,"./mixins":56,"./valueref":62,tslib:5}],61:[function(e,t,n){"use strict";function i(e){var t=e.config,n=e.markDef.orient,i=e.getScaleComponent("horizontal"===n?"x":"y");if(void 0!==t.tick.bandSize)return t.tick.bandSize;var r=i?i.get("range"):void 0,o=r&&a.isVgRangeStep(r)?r.step:t.scale.rangeStep;if("number"!=typeof o)throw new Error("Function does not handle non-numeric rangeStep");return o/1.5}Object.defineProperty(n,"__esModule",{value:!0});var r=e("tslib"),a=e("../../vega.schema"),o=e("./mixins"),s=e("./valueref");n.tick={vgMark:"rect",encodeEntry:function(e){var t=e.config,n=e.markDef,a=e.width,l=e.height,u=n.orient,c="horizontal"===u?"width":"height",f="horizontal"===u?"height":"width";return r.__assign({},o.pointPosition("x",e,s.mid(a),"xc"),o.pointPosition("y",e,s.mid(l),"yc"),o.nonPosition("size",e,{defaultValue:i(e),vgChannel:c}),(d={},d[f]={value:t.tick.thickness},d),o.color(e),o.nonPosition("opacity",e));var d}}},{"../../vega.schema":116,"./mixins":56,"./valueref":62,tslib:5}],62:[function(e,t,n){"use strict";function i(e,t,n,i){var r={scale:t,field:d.field(e,n)};return i?c.__assign({},r,i):r}function r(e,t){return{signal:'(scale("'+t+'", '+d.field(e,{expr:"datum"})+') + scale("'+t+'", '+d.field(e,{binSuffix:"end",expr:"datum"})+"))/2"}}function a(e,t,n,a,c,h){if(t){if(d.isFieldDef(t)){if(t.bin)return m.contains(["x","y"],e)&&"quantitative"===t.type?c&&c.impute?i(t,n,{binSuffix:"mid"}):r(t,n):i(t,n,g.binRequiresRange(t,e)?{binSuffix:"range"}:{});var v=a.get("type");return p.hasDiscreteDomain(v)?"band"===v?i(t,n,{binSuffix:"range"},{band:.5}):i(t,n,{binSuffix:"range"}):i(t,n,{})}if(d.isValueDef(t))return{value:t.value};throw new Error("FieldDef without field or value.")}if("zeroOrMin"===h){if(e===f.X||e===f.X2)return o(n,a);if(e===f.Y||e===f.Y2)return l(n,a);throw new Error("Unsupported channel "+e+" for base function")}if("zeroOrMax"===h){if(e===f.X||e===f.X2)return s(n,a);if(e===f.Y||e===f.Y2)return u(n,a);throw new Error("Unsupported channel "+e+" for base function")}return h}function o(e,t){return e&&!m.contains([p.ScaleType.LOG,p.ScaleType.TIME,p.ScaleType.UTC],t.get("type"))&&!1!==t.get("zero")?{scale:e,value:0}:{value:0}}function s(e,t){return e&&!m.contains([p.ScaleType.LOG,p.ScaleType.TIME,p.ScaleType.UTC],t.get("type"))&&!1!==t.get("zero")?{scale:e,value:0}:{field:{group:"width"}}}function l(e,t){return e&&!m.contains([p.ScaleType.LOG,p.ScaleType.TIME,p.ScaleType.UTC],t.get("type"))&&!1!==t.get("zero")?{scale:e,value:0}:{field:{group:"height"}}}function u(e,t){return e&&!m.contains([p.ScaleType.LOG,p.ScaleType.TIME,p.ScaleType.UTC],t.get("type"))&&!1!==t.get("zero")?{scale:e,value:0}:{value:0}}Object.defineProperty(n,"__esModule",{value:!0});var c=e("tslib"),f=e("../../channel"),d=e("../../fielddef"),p=e("../../scale"),m=e("../../util"),g=e("../common");n.stackable=function(e,t,n,r,o,s){return d.isFieldDef(t)&&o&&e===o.fieldChannel?i(t,n,{suffix:"end"}):a(e,t,n,r,o,s)},n.stackable2=function(e,t,n,r,o,s,l){return d.isFieldDef(t)&&s&&e.charAt(0)===s.fieldChannel.charAt(0)?i(t,r,{suffix:"start"}):a(e,n,r,o,s,l)},n.bin=function(e,t,n,r){return i(e,t,{binSuffix:"start"===n?void 0:"end"},r?{offset:r}:{})},n.fieldRef=i,n.band=function(e,t){return void 0===t&&(t=!0),{scale:e,band:t}},n.midPoint=a,n.text=function(e,t){if(e){if(d.isFieldDef(e))return g.formatSignalRef(e,e.format,"datum",t);if(d.isValueDef(e))return{value:e.value}}},n.mid=function(e){return c.__assign({},e,{mult:.5})}},{"../../channel":12,"../../fielddef":96,"../../scale":104,"../../util":114,"../common":20,tslib:5}],63:[function(e,t,n){"use strict";function i(e){return e&&"unit"===e.type}function r(e){return e&&"facet"===e.type}Object.defineProperty(n,"__esModule",{value:!0});var a=e("tslib"),o=e("vega-util"),s=e("../channel"),l=e("../encoding"),u=e("../fielddef"),c=e("../log"),f=e("../scale"),d=e("../title"),p=e("../transform"),m=e("../util"),g=e("../vega.schema"),h=e("./axis/assemble"),v=e("./layout/header"),y=e("./layoutsize/assemble"),b=e("./legend/assemble"),_=e("./legend/parse"),S=e("./mark/mark"),E=e("./scale/assemble"),x=e("./scale/domain"),O=e("./scale/parse"),N=e("./split"),w=function(){function e(){this.nameMap={}}return e.prototype.rename=function(e,t){this.nameMap[e]=t},e.prototype.has=function(e){return void 0!==this.nameMap[e]},e.prototype.get=function(e){for(;this.nameMap[e]&&e!==this.nameMap[e];)e=this.nameMap[e];return e},e}();n.NameMap=w,n.isUnitModel=i,n.isFacetModel=r,n.isRepeatModel=function(e){return e&&"repeat"===e.type},n.isConcatModel=function(e){return e&&"concat"===e.type},n.isLayerModel=function(e){return e&&"layer"===e.type};var T=function(){function e(e,t,n,i,r){var s=this;this.children=[],this.correctDataNames=function(e){return e.from&&e.from.data&&(e.from.data=s.lookupDataSource(e.from.data)),e.from&&e.from.facet&&e.from.facet.data&&(e.from.facet.data=s.lookupDataSource(e.from.facet.data)),e},this.parent=t,this.config=i,this.name=e.name||n,this.title=o.isString(e.title)?{text:e.title}:e.title,this.scaleNameMap=t?t.scaleNameMap:new w,this.layoutSizeNameMap=t?t.layoutSizeNameMap:new w,this.data=e.data,this.description=e.description,this.transforms=p.normalizeTransform(e.transform||[]),this.component={data:{sources:t?t.component.data.sources:{},outputNodes:t?t.component.data.outputNodes:{},outputNodeRefCounts:t?t.component.data.outputNodeRefCounts:{},ancestorParse:t?a.__assign({},t.component.data.ancestorParse):{}},layoutSize:new N.Split,layoutHeaders:{row:{},column:{}},mark:null,resolve:a.__assign({scale:{},axis:{},legend:{}},r||{}),selection:null,scales:null,axes:{},legends:{}}}return Object.defineProperty(e.prototype,"width",{get:function(){return this.getSizeSignalRef("width")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.getSizeSignalRef("height")},enumerable:!0,configurable:!0}),e.prototype.initSize=function(e){var t=e.width,n=e.height;t&&this.component.layoutSize.set("width",t,!0),n&&this.component.layoutSize.set("height",n,!0)},e.prototype.parse=function(){this.parseScale(),this.parseMarkDef(),this.parseLayoutSize(),this.renameTopLevelLayoutSize(),this.parseSelection(),this.parseData(),this.parseAxisAndHeader(),this.parseLegend(),this.parseMarkGroup()},e.prototype.parseScale=function(){O.parseScale(this)},e.prototype.renameTopLevelLayoutSize=function(){"width"!==this.getName("width")&&this.renameLayoutSize(this.getName("width"),"width"),"height"!==this.getName("height")&&this.renameLayoutSize(this.getName("height"),"height")},e.prototype.parseMarkDef=function(){S.parseMarkDef(this)},e.prototype.parseLegend=function(){_.parseLegend(this)},e.prototype.assembleGroupStyle=function(){if("unit"===this.type||"layer"===this.type)return"cell"},e.prototype.assembleLayoutSize=function(){if("unit"===this.type||"layer"===this.type)return{width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")}},e.prototype.assembleHeaderMarks=function(){for(var e=this.component.layoutHeaders,t=[],n=0,i=v.HEADER_CHANNELS;n<i.length;n++)e[o=i[n]].title&&t.push(v.getTitleGroup(this,o));for(var r=0,a=v.HEADER_CHANNELS;r<a.length;r++)for(var o=a[r],s=e[o],l=0,u=v.HEADER_TYPES;l<u.length;l++){var c=u[l];if(s[c])for(var f=0,d=s[c];f<d.length;f++){var p=d[f],m=v.getHeaderGroup(this,o,c,s,p);m&&t.push(m)}}return t},e.prototype.assembleAxes=function(){return h.assembleAxes(this.component.axes)},e.prototype.assembleLegends=function(){return b.assembleLegends(this)},e.prototype.assembleTitle=function(){var e=a.__assign({},d.extractTitleConfig(this.config.title).nonMark,this.title);if(e.text)return m.contains(["unit","layer"],this.type)||(e.anchor&&"start"!==e.anchor&&c.warn(c.message.cannotSetTitleAnchor(this.type)),e.anchor="start"),m.keys(e).length>0?e:void 0},e.prototype.assembleGroup=function(e){void 0===e&&(e=[]);var t={};(e=e.concat(this.assembleSelectionSignals())).length>0&&(t.signals=e);var n=this.assembleLayout();n&&(t.layout=n),t.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());var i=!this.parent||r(this.parent)?E.assembleScales(this):[];i.length>0&&(t.scales=i);var a=this.assembleAxes();a.length>0&&(t.axes=a);var o=this.assembleLegends();return o.length>0&&(t.legends=o),t},e.prototype.hasDescendantWithFieldOnChannel=function(e){for(var t=0,n=this.children;t<n.length;t++){var r=n[t];if(i(r)){if(r.channelHasField(e))return!0}else if(r.hasDescendantWithFieldOnChannel(e))return!0}return!1},e.prototype.getName=function(e){return m.varName((this.name?this.name+"_":"")+e)},e.prototype.requestDataName=function(e){var t=this.getName(e),n=this.component.data.outputNodeRefCounts;return n[t]=(n[t]||0)+1,t},e.prototype.getSizeSignalRef=function(e){if(r(this.parent)){var t="width"===e?"x":"y",n=this.component.scales[t];if(n&&!n.merged){var i=n.get("type"),a=n.get("range");if(f.hasDiscreteDomain(i)&&g.isVgRangeStep(a)){var o=n.get("name"),s=x.assembleDomain(this,t),l=x.getFieldFromDomain(s);if(l){var d=u.field({aggregate:"distinct",field:l},{expr:"datum"});return{signal:y.sizeExpr(o,n,d)}}return c.warn("Unknown field for ${channel}.  Cannot calculate view size."),null}}}return{signal:this.layoutSizeNameMap.get(this.getName(e))}},e.prototype.lookupDataSource=function(e){var t=this.component.data.outputNodes[e];return t?t.getSource():e},e.prototype.getSizeName=function(e){return this.layoutSizeNameMap.get(e)},e.prototype.renameLayoutSize=function(e,t){this.layoutSizeNameMap.rename(e,t)},e.prototype.renameScale=function(e,t){this.scaleNameMap.rename(e,t)},e.prototype.scaleName=function(e,t){return t?this.getName(e):s.isChannel(e)&&s.isScaleChannel(e)&&this.component.scales[e]||this.scaleNameMap.has(this.getName(e))?this.scaleNameMap.get(this.getName(e)):void 0},e.prototype.getScaleComponent=function(e){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale().  Make sure you have called parseScale or use parseUnitModelWithScale().");var t=this.component.scales[e];return t&&!t.merged?t:this.parent?this.parent.getScaleComponent(e):void 0},e.prototype.getSelectionComponent=function(e,t){var n=this.component.selection[e];if(!n&&this.parent&&(n=this.parent.getSelectionComponent(e,t)),!n)throw new Error(c.message.selectionNotFound(t));return n},e}();n.Model=T;var k=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a.__extends(t,e),t.prototype.field=function(e,t){void 0===t&&(t={});var n=this.fieldDef(e);if(n)return u.field(n,t)},t.prototype.reduceFieldDef=function(e,t,n){return l.reduce(this.getMapping(),function(t,n,i){var r=u.getFieldDef(n);return r?e(t,r,i):t},t,n)},t.prototype.forEachFieldDef=function(e,t){l.forEach(this.getMapping(),function(t,n){var i=u.getFieldDef(t);i&&e(i,n)},t)},t}(T);n.ModelWithField=k},{"../channel":12,"../encoding":94,"../fielddef":96,"../log":101,"../scale":104,"../title":110,"../transform":112,"../util":114,"../vega.schema":116,"./axis/assemble":13,"./layout/header":43,"./layoutsize/assemble":44,"./legend/assemble":46,"./legend/parse":49,"./mark/mark":55,"./scale/assemble":67,"./scale/domain":69,"./scale/parse":70,"./split":86,tslib:5,"vega-util":7}],64:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib"),r=e("./baseconcat"),a=e("./buildmodel"),o=e("./layoutsize/parse"),s=function(e){function t(t,n,i,r,a){var o=e.call(this,t,n,i,a,t.resolve)||this;return o.type="repeat",o.repeat=t.repeat,o.children=o._initChildren(t,o.repeat,r,a),o}return i.__extends(t,e),t.prototype._initChildren=function(e,t,n,i){for(var r=[],o=t.row||[n?n.row:null],s=t.column||[n?n.column:null],l=0,u=o;l<u.length;l++)for(var c=u[l],f=0,d=s;f<d.length;f++){var p=d[f],m=(c?"_"+c:"")+(p?"_"+p:""),g={row:c,column:p};r.push(a.buildModel(e.spec,this,this.getName("child"+m),void 0,g,i))}return r},t.prototype.parseLayoutSize=function(){o.parseRepeatLayoutSize(this)},t.prototype.assembleLayout=function(){return{padding:{row:10,column:10},offset:10,columns:this.repeat&&this.repeat.column?this.repeat.column.length:1,bounds:"full",align:"all"}},t}(r.BaseConcatModel);n.RepeatModel=s},{"./baseconcat":18,"./buildmodel":19,"./layoutsize/parse":45,tslib:5}],65:[function(e,t,n){"use strict";function i(e,t){var n=e.field;return s.isRepeatRef(n)?n.repeat in t?a.__assign({},e,{field:t[n.repeat]}):(l.warn(l.message.noSuchRepeatedValue(n.repeat)),null):e}function r(e,t){var n={};for(var r in e)if(e.hasOwnProperty(r)){var a=e[r];if(o.isArray(a))n[r]=a.map(function(e){return i(e,t)}).filter(function(e){return null!==e});else{var s=i(a,t);null!==s&&(n[r]=s)}}return n}Object.defineProperty(n,"__esModule",{value:!0});var a=e("tslib"),o=e("vega-util"),s=e("../fielddef"),l=e("../log");n.replaceRepeaterInFacet=function(e,t){return r(e,t)},n.replaceRepeaterInEncoding=function(e,t){return r(e,t)}},{"../fielddef":96,"../log":101,tslib:5,"vega-util":7}],66:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("../channel"),r=e("../log"),a=e("../util"),o=e("./model");n.defaultScaleResolve=function(e,t){if(o.isLayerModel(t)||o.isFacetModel(t))return"shared";if(o.isConcatModel(t)||o.isRepeatModel(t))return a.contains(i.SPATIAL_SCALE_CHANNELS,e)?"independent":"shared";throw new Error("invalid model type for resolve")},n.parseGuideResolve=function(e,t){var n=e.scale[t],o=a.contains(i.SPATIAL_SCALE_CHANNELS,t)?"axis":"legend";return"independent"===n?("shared"===e[o][t]&&r.warn(r.message.independentScaleMeansIndependentGuide(t)),"independent"):e[o][t]||"shared"}},{"../channel":12,"../log":101,"../util":114,"./model":63}],67:[function(e,t,n){"use strict";function i(e){return c.isLayerModel(e)||c.isConcatModel(e)||c.isRepeatModel(e)?e.children.reduce(function(e,t){return e.concat(i(t))},r(e)):r(e)}function r(e){return l.keys(e.component.scales).reduce(function(t,n){var i=e.component.scales[n];if(i.merged)return t;var r=i.combine(),s=r.domainRaw,l=r.range,u=r.name,c=r.type,p=(r.domainRaw,r.range,o.__rest(r,["name","type","domainRaw","range"]));return l=a(l,u,e,n),s&&f.isRawSelectionDomain(s)&&(s=f.selectionScaleDomain(e,s)),t.push(o.__assign({name:u,type:c,domain:d.assembleDomain(e,n)},s?{domainRaw:s}:{},{range:l},p)),t},[])}function a(e,t,n,i){if("x"===i||"y"===i){if(u.isVgRangeStep(e))return{step:{signal:t+"_step"}};if(s.isArray(e)&&2===e.length){var r=e[0],a=e[1];if(0===r&&u.isVgSignalRef(a))return[0,{signal:n.getSizeName(a.signal)}];if(u.isVgSignalRef(r)&&0===a)return[{signal:n.getSizeName(r.signal)},0]}}return e}Object.defineProperty(n,"__esModule",{value:!0});var o=e("tslib"),s=e("vega-util"),l=e("../../util"),u=e("../../vega.schema"),c=e("../model"),f=e("../selection/selection"),d=e("./domain");n.assembleScales=i,n.assembleScalesForModel=r,n.assembleScaleRange=a},{"../../util":114,"../../vega.schema":116,"../model":63,"../selection/selection":76,"./domain":69,tslib:5,"vega-util":7}],68:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib"),r=function(e){function t(t,n){var i=e.call(this,{},{name:t})||this;return i.merged=!1,i.domains=[],i.setWithExplicit("type",n),i}return i.__extends(t,e),t}(e("../split").Split);n.ScaleComponent=r},{"../split":86,tslib:5}],69:[function(e,t,n){"use strict";function i(e){T.isUnitModel(e)?r(e):a(e)}function r(e){var t=e.specifiedScales,n=e.component.scales;E.keys(n).forEach(function(i){var r=t[i],a=r?r.domain:void 0,o=s(e,i),l=n[i];l.domains=o,_.isSelectionDomain(a)&&l.set("domainRaw",{signal:k.SELECTION_DOMAIN+JSON.stringify(a)},!0)})}function a(e){for(var t=0,n=e.children;t<n.length;t++)i(n[t]);var r=e.component.scales;E.keys(r).forEach(function(t){for(var n,i=0,a=e.children;i<a.length;i++){var o=a[i].component.scales[t];o&&(n=void 0===n?o.domains:n.concat(o.domains))}T.isFacetModel(e)&&n.forEach(function(e){x.isDataRefDomain(e)&&(e.data=w.FACET_SCALE_PREFIX+e.data.replace(w.FACET_SCALE_PREFIX,""))}),r[t].domains=n})}function o(e,t,n,i){if("unaggregated"===e){var r=c(t,n),a=r.valid,o=r.reason;if(!a)return void b.warn(o)}else if(void 0===e&&i.useUnaggregatedDomain&&(a=c(t,n).valid))return"unaggregated";return e}function s(e,t){var n=e.getScaleComponent(t).get("type"),i=o(e.scaleDomain(t),e.fieldDef(t),n,e.config.scale);return i!==e.scaleDomain(t)&&(e.specifiedScales[t]=d.__assign({},e.specifiedScales[t],{domain:i})),"x"===t&&e.channelHasField("x2")?e.channelHasField("x")?l(n,i,e,"x").concat(l(n,i,e,"x2")):l(n,i,e,"x2"):"y"===t&&e.channelHasField("y2")?e.channelHasField("y")?l(n,i,e,"y").concat(l(n,i,e,"y2")):l(n,i,e,"y2"):l(n,i,e,t)}function l(e,t,n,i){var r=n.fieldDef(i);if(t&&"unaggregated"!==t&&!_.isSelectionDomain(t)){if(!r.bin)return y.isDateTime(t[0])?t.map(function(e){return{signal:"{data: "+y.dateTimeExpr(e,!0)+"}"}}):[t];b.warn(b.message.conflictedDomain(i))}var a=n.stack;if(a&&i===a.fieldChannel)return"normalize"===a.offset?[[0,1]]:[{data:l=n.requestDataName(v.MAIN),field:n.field(i,{suffix:"start"})},{data:l,field:n.field(i,{suffix:"end"})}];var o=h.isScaleChannel(i)?u(n,i,e):void 0;if("unaggregated"===t)return[{data:l=n.requestDataName(v.MAIN),field:n.field(i,{aggregate:"min"})},{data:l,field:n.field(i,{aggregate:"max"})}];if(r.bin){if(_.isBinScale(e)){var s=n.getName(g.binToString(r.bin)+"_"+r.field+"_bins");return[{signal:"sequence("+s+".start, "+s+".stop + "+s+".step, "+s+".step)"}]}if(_.hasDiscreteDomain(e))return[{data:E.isBoolean(o)?n.requestDataName(v.MAIN):n.requestDataName(v.RAW),field:n.field(i,N.binRequiresRange(r,i)?{binSuffix:"range"}:{}),sort:!0!==o&&S.isSortField(o)?o:{field:n.field(i,{}),op:"min"}}];if("x"===i||"y"===i){var l=n.requestDataName(v.MAIN);return[{data:l,field:n.field(i,{})},{data:l,field:n.field(i,{binSuffix:"end"})}]}return[{data:n.requestDataName(v.MAIN),field:n.field(i,{})}]}return o?[{data:E.isBoolean(o)?n.requestDataName(v.MAIN):n.requestDataName(v.RAW),field:n.field(i),sort:o}]:[{data:n.requestDataName(v.MAIN),field:n.field(i)}]}function u(e,t,n){if(_.hasDiscreteDomain(n)){var i=e.sort(t);return S.isSortField(i)?i:"descending"===i?{op:"min",field:e.field(t),order:"descending"}:!!E.contains(["ascending",void 0],i)||void 0}}function c(e,t){return e.aggregate?m.SHARED_DOMAIN_OP_INDEX[e.aggregate]?"quantitative"===e.type&&"log"===t?{valid:!1,reason:b.message.unaggregatedDomainWithLogScale(e)}:{valid:!0}:{valid:!1,reason:b.message.unaggregateDomainWithNonSharedDomainOp(e.aggregate)}:{valid:!1,reason:b.message.unaggregateDomainHasNoEffectForRawField(e)}}function f(e){var t=E.unique(e.map(function(e){if(x.isDataRefDomain(e)){e.sort;return d.__rest(e,["sort"])}return e}),E.hash),n=E.unique(e.map(function(e){if(x.isDataRefDomain(e)){var t=e.sort;return void 0===t||E.isBoolean(t)||("count"===t.op&&delete t.field,"ascending"===t.order&&delete t.order),t}}).filter(function(e){return void 0!==e}),E.hash);if(1===t.length){var i=e[0];if(x.isDataRefDomain(i)&&n.length>0){var r=n[0];return n.length>1&&(b.warn(b.message.MORE_THAN_ONE_SORT),r=!0),d.__assign({},i,{sort:r})}return i}var a=n.filter(function(e){return!!E.isBoolean(e)||("count"===e.op||(b.warn(b.message.domainSortDropped(e)),!1))}),o=!0;if(1===a.length)o=a[0];else if(a.length>1){var s=a.filter(function(e){return!1!==e});s.length>1?(b.warn(b.message.MORE_THAN_ONE_SORT),o=!0):o=s[0]}var l=E.unique(e.map(function(e){return x.isDataRefDomain(e)?e.data:null}),function(e){return e});return 1===l.length&&null!==l[0]?i={data:l[0],fields:t.map(function(e){return e.field}),sort:o}:{fields:t,sort:o}}Object.defineProperty(n,"__esModule",{value:!0});var d=e("tslib"),p=e("vega-util"),m=e("../../aggregate"),g=e("../../bin"),h=e("../../channel"),v=e("../../data"),y=e("../../datetime"),b=e("../../log"),_=e("../../scale"),S=e("../../sort"),E=e("../../util"),x=e("../../vega.schema"),O=e("../../vega.schema"),N=e("../common"),w=e("../data/optimize"),T=e("../model"),k=e("../selection/selection");n.parseScaleDomain=i,n.parseDomainForChannel=s,n.domainSort=u,n.canUseUnaggregatedDomain=c,n.mergeDomains=f,n.getFieldFromDomain=function(e){if(x.isDataRefDomain(e)&&p.isString(e.field))return e.field;if(O.isDataRefUnionedDomain(e)){for(var t=void 0,n=0,i=e.fields;n<i.length;n++){var r=i[n];if(x.isDataRefDomain(r)&&p.isString(r.field))if(t){if(t!==r.field)return b.warn("Detected faceted independent scales that union domain of multiple fields from different data sources.  We will use the first field.  The result view size may be incorrect."),t}else t=r.field}return b.warn("Detected faceted independent scales that union domain of identical fields from different source detected.  We will assume that this is the same field from a different fork of the same data source.  However, if this is not case, the result view size maybe incorrect."),t}if(O.isFieldRefUnionDomain(e)&&p.isString)return b.warn("Detected faceted independent scales that union domain of multiple fields from the same data source.  We will use the first field.  The result view size may be incorrect."),t=e.fields[0],p.isString(t)?t:void 0},n.assembleDomain=function(e,t){return f(e.component.scales[t].domains.map(function(t){return x.isDataRefDomain(t)&&(t.data=e.lookupDataSource(t.data)),t}))}},{"../../aggregate":9,"../../bin":11,"../../channel":12,"../../data":92,"../../datetime":93,"../../log":101,"../../scale":104,"../../sort":106,"../../util":114,"../../vega.schema":116,"../common":20,"../data/optimize":35,"../model":63,"../selection/selection":76,tslib:5,"vega-util":7}],70:[function(e,t,n){"use strict";function i(e){c.isUnitModel(e)?e.component.scales=r(e):e.component.scales=a(e)}function r(e){var t=e.encoding,n=e.config,i=e.mark();return o.SCALE_CHANNELS.reduce(function(r,a){var o,l={},u=t[a];if(s.isFieldDef(u)?(o=u,l=u.scale||{}):s.isConditionalDef(u)&&s.isFieldDef(u.condition)?(o=u.condition,l=u.condition.scale||{}):"x"===a?o=s.getFieldDef(t.x2):"y"===a&&(o=s.getFieldDef(t.y2)),o){var c=l.type,f=v.scaleType(l.type,a,o,i,n.scale);r[a]=new p.ScaleComponent(e.scaleName(a+"",!0),{value:f,explicit:c===f})}return r},{})}function a(e){for(var t=e.component.scales={},n={},r=e.component.resolve,a=0,o=e.children;a<o.length;a++)!function(t){i(t),u.keys(t.component.scales).forEach(function(i){if(r.scale[i]=r.scale[i]||f.defaultScaleResolve(i,e),"shared"===r.scale[i]){var a=n[i],o=t.component.scales[i].getWithExplicit("type");a?l.scaleCompatible(a.value,o.value)?n[i]=d.mergeValuesWithExplicit(a,o,"type","scale",y):(r.scale[i]="independent",delete n[i]):n[i]=o}})}(o[a]);return u.keys(n).forEach(function(i){var r=e.scaleName(i,!0),a=n[i];t[i]=new p.ScaleComponent(r,a);for(var o=0,s=e.children;o<s.length;o++){var l=s[o],u=l.component.scales[i];u&&(l.renameScale(u.get("name"),r),u.merged=!0)}}),t}Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../channel"),s=e("../../fielddef"),l=e("../../scale"),u=e("../../util"),c=e("../model"),f=e("../resolve"),d=e("../split"),p=e("./component"),m=e("./domain"),g=e("./properties"),h=e("./range"),v=e("./type");n.parseScale=function(e){i(e),m.parseScaleDomain(e);for(var t=0,n=l.NON_TYPE_DOMAIN_RANGE_VEGA_SCALE_PROPERTIES;t<n.length;t++){var r=n[t];g.parseScaleProperty(e,r)}h.parseScaleRange(e)},n.parseScaleCore=i;var y=d.tieBreakByComparing(function(e,t){return l.scaleTypePrecedence(e)-l.scaleTypePrecedence(t)})},{"../../channel":12,"../../fielddef":96,"../../scale":104,"../../util":114,"../model":63,"../resolve":66,"../split":86,"./component":68,"./domain":69,"./properties":71,"./range":72,"./type":73}],71:[function(e,t,n){"use strict";function i(e,t){b.isUnitModel(e)?r(e,t):o(e,t)}function r(e,t){var n=e.component.scales;y.keys(n).forEach(function(i){var r=e.specifiedScales[i],o=n[i],s=e.getScaleComponent(i),l=e.fieldDef(i),u=e.sort(i),c=e.config,f=r[t],d=s.get("type"),p=g.scaleTypeSupportProperty(d,t),h=g.channelScalePropertyIncompatability(i,t);if(void 0!==f&&(p?h&&m.warn(h):m.warn(m.message.scalePropertyNotWorkWithScaleType(d,t,i))),p&&void 0===h)if(void 0!==f)o.copyKeyFromObject(t,r);else{var v=a(t,i,l,u,s.get("type"),s.get("padding"),s.get("paddingInner"),r.domain,c.scale);void 0!==v&&o.set(t,v,!1)}})}function a(e,t,n,i,r,a,o,p,m){switch(e){case"nice":return s(r,t,n);case"padding":return l(t,r,m);case"paddingInner":return u(a,t,m);case"paddingOuter":return c(a,t,r,o,m);case"reverse":return f(r,i);case"zero":return d(t,n,p)}return m[e]}function o(e,t){for(var n=e.component.scales,r=0,a=e.children;r<a.length;r++){var o=a[r];"range"===t?S.parseScaleRange(o):i(o,t)}y.keys(n).forEach(function(i){for(var r,a=0,o=e.children;a<o.length;a++){var s=o[a].component.scales[i];if(s){var l=s.getWithExplicit(t);r=_.mergeValuesWithExplicit(r,l,t,"scale",_.tieBreakByComparing(function(e,n){switch(t){case"range":return e.step&&n.step?e.step-n.step:0}return 0}))}}n[i].setWithExplicit(t,r)})}function s(e,t,n){if(v.contains([g.ScaleType.TIME,g.ScaleType.UTC],e))return h.smallestUnit(n.timeUnit);if(!n.bin)return v.contains([p.X,p.Y],t)}function l(e,t,n){if(v.contains([p.X,p.Y],e)&&t===g.ScaleType.POINT)return n.pointPadding}function u(e,t,n){if(void 0===e)return v.contains([p.X,p.Y],t)?n.bandPaddingInner:void 0}function c(e,t,n,i,r){if(void 0===e)return v.contains([p.X,p.Y],t)&&n===g.ScaleType.BAND?void 0!==r.bandPaddingOuter?r.bandPaddingOuter:i/2:void 0}function f(e,t){if(g.hasContinuousDomain(e)&&"descending"===t)return!0}function d(e,t,n){return"size"===e&&"quantitative"===t.type||!(!!n&&"unaggregated"!==n||t.bin||!v.contains([p.X,p.Y],e))}Object.defineProperty(n,"__esModule",{value:!0});var p=e("../../channel"),m=e("../../log"),g=e("../../scale"),h=e("../../timeunit"),v=e("../../util"),y=e("../../util"),b=e("../model"),_=e("../split"),S=e("./range");n.parseScaleProperty=i,n.getDefaultValue=a,n.parseNonUnitScaleProperty=o,n.nice=s,n.padding=l,n.paddingInner=u,n.paddingOuter=c,n.reverse=f,n.zero=d},{"../../channel":12,"../../log":101,"../../scale":104,"../../timeunit":109,"../../util":114,"../model":63,"../split":86,"./range":72}],72:[function(e,t,n){"use strict";function i(e){var t=e.component.scales;d.SCALE_CHANNELS.forEach(function(n){var i=t[n];if(i){var o=e.getScaleComponent(n),s=e.specifiedScales[n],l=e.fieldDef(n),u="x"===n?"width":"y"===n?"height":void 0,c=u?e.component.layoutSize.get(u):void 0,f=r(e),d=a(n,o.get("type"),l.type,s,e.config,i.get("zero"),e.mark(),c,e.getName(u),f);i.setWithExplicit("range",d)}})}function r(e){var t=[],n=e.getScaleComponent("x"),i=n&&n.get("range");i&&h.isVgRangeStep(i)&&f.isNumber(i.step)&&t.push(i.step);var r=e.getScaleComponent("y"),a=r&&r.get("range");return a&&h.isVgRangeStep(a)&&f.isNumber(a.step)&&t.push(a.step),t}function a(e,t,i,r,a,l,u,c,f,d){for(var g=!!c||null===r.rangeStep,h=0,v=n.RANGE_PROPERTIES;h<v.length;h++){var b=v[h];if(void 0!==r[b]){var _=m.scaleTypeSupportProperty(t,b),S=m.channelScalePropertyIncompatability(e,b);if(_)if(S)p.warn(S);else switch(b){case"range":return y.makeImplicit(r[b]);case"scheme":return y.makeImplicit(o(r[b]));case"rangeStep":var E=r[b];if(null!==E){if(void 0===c)return y.makeImplicit({step:E});p.warn(p.message.rangeStepDropped(e))}}else p.warn(p.message.scalePropertyNotWorkWithScaleType(t,b,e))}}return{explicit:!1,value:s(e,t,i,a,l,u,f,d,g)}}function o(e){if(m.isExtendedScheme(e)){var t={scheme:e.name};return e.count&&(t.count=e.count),e.extent&&(t.extent=e.extent),t}return{scheme:e}}function s(e,t,n,i,r,a,o,s,c){switch(e){case d.X:case d.Y:if(g.contains(["point","band"],t)&&!c)if(e===d.X&&"text"===a){if(i.scale.textXRangeStep)return{step:i.scale.textXRangeStep}}else if(i.scale.rangeStep)return{step:i.scale.rangeStep};return e===d.X?[0,{signal:o}]:[{signal:o},0];case d.SIZE:return[l(a,r,i),u(a,s,i)];case d.SHAPE:return"symbol";case d.COLOR:return"ordinal"===t?"nominal"===n?"category":"ordinal":"rect"===a?"heatmap":"ramp";case d.OPACITY:return[i.scale.minOpacity,i.scale.maxOpacity]}throw new Error("Scale range undefined for channel "+e)}function l(e,t,n){if(t)return 0;switch(e){case"bar":case"tick":return n.scale.minBandSize;case"line":case"rule":return n.scale.minStrokeWidth;case"text":return n.scale.minFontSize;case"point":case"square":case"circle":return n.scale.minSize}throw new Error(p.message.incompatibleChannel("size",e))}function u(e,t,n){var i=n.scale;switch(e){case"bar":case"tick":return void 0!==n.scale.maxBandSize?n.scale.maxBandSize:c(t,n.scale)-1;case"line":case"rule":return n.scale.maxStrokeWidth;case"text":return n.scale.maxFontSize;case"point":case"square":case"circle":if(n.scale.maxSize)return n.scale.maxSize;var r=c(t,i);return(r-2)*(r-2)}throw new Error(p.message.incompatibleChannel("size",e))}function c(e,t){return e.length>0?Math.min.apply(null,e):t.rangeStep?t.rangeStep:21}Object.defineProperty(n,"__esModule",{value:!0});var f=e("vega-util"),d=e("../../channel"),p=e("../../log"),m=e("../../scale"),g=e("../../util"),h=e("../../vega.schema"),v=e("../model"),y=e("../split"),b=e("./properties");n.RANGE_PROPERTIES=["range","rangeStep","scheme"],n.parseScaleRange=function(e){v.isUnitModel(e)?i(e):b.parseNonUnitScaleProperty(e,"range")},n.parseRangeForChannel=a,n.defaultRange=s},{"../../channel":12,"../../log":101,"../../scale":104,"../../util":114,"../../vega.schema":116,"../model":63,"../split":86,"./properties":71,"vega-util":7}],73:[function(e,t,n){"use strict";function i(e,t,n,i){switch(t.type){case"nominal":case"ordinal":if("color"===e||"discrete"===a.rangeType(e))return"shape"===e&&"ordinal"===t.type&&o.warn(o.message.discreteChannelCannotEncode(e,"ordinal")),"ordinal";if(c.contains(["x","y"],e)){if("rect"===n)return"band";if("bar"===n)return"band"}return"point";case"temporal":return"color"===e?"sequential":"discrete"===a.rangeType(e)?(o.warn(o.message.discreteChannelCannotEncode(e,"temporal")),"ordinal"):"time";case"quantitative":return"color"===e?t.bin?"bin-ordinal":"sequential":"discrete"===a.rangeType(e)?(o.warn(o.message.discreteChannelCannotEncode(e,"quantitative")),"ordinal"):t.bin&&"x"!==e&&"y"!==e?"bin-linear":"linear"}throw new Error(o.message.invalidFieldType(t.type))}function r(e,t){var n=t.type;return f.contains([u.Type.ORDINAL,u.Type.NOMINAL],n)?void 0===e||l.hasDiscreteDomain(e):n===u.Type.TEMPORAL?f.contains([s.ScaleType.TIME,s.ScaleType.UTC,s.ScaleType.SEQUENTIAL,void 0],e):n!==u.Type.QUANTITATIVE||(t.bin?f.contains([s.ScaleType.BIN_LINEAR,s.ScaleType.BIN_ORDINAL,s.ScaleType.LINEAR],e):f.contains([s.ScaleType.LOG,s.ScaleType.POW,s.ScaleType.SQRT,s.ScaleType.QUANTILE,s.ScaleType.QUANTIZE,s.ScaleType.LINEAR,s.ScaleType.SEQUENTIAL,void 0],e))}Object.defineProperty(n,"__esModule",{value:!0});var a=e("../../channel"),o=e("../../log"),s=e("../../scale"),l=e("../../scale"),u=e("../../type"),c=e("../../util"),f=e("../../util");n.scaleType=function(e,t,n,l,u){var c=i(t,n,l);return a.isScaleChannel(t)?void 0!==e?s.channelSupportScaleType(t,e)?r(e,n)?e:(o.warn(o.message.scaleTypeNotWorkWithFieldDef(e,c)),c):(o.warn(o.message.scaleTypeNotWorkWithChannel(t,e,c)),c):c:null},n.fieldDefMatchScaleType=r},{"../../channel":12,"../../log":101,"../../scale":104,"../../type":113,"../../util":114}],74:[function(e,t,n){"use strict";function i(e,t,i){var a=c.channelSignalName(t,i,"visual"),s=c.channelSignalName(t,i,"data"),d=f.default.has(t),p=e.scaleName(i),m=u.stringValue(p),g=e.getScaleComponent(i),h=g?g.get("type"):void 0,v=e.getSizeSignalRef(i===o.X?"width":"height").signal,y=i+"(unit)",b=r(t,function(e,t){return e.concat({events:t.between[0],update:"["+y+", "+y+"]"},{events:t,update:"["+a+"[0], clamp("+y+", 0, "+v+")]"})});return b.push({events:{signal:t.name+n.SCALE_TRIGGER},update:l.hasContinuousDomain(h)&&!l.isBinScale(h)?"[scale("+m+", "+s+"[0]), scale("+m+", "+s+"[1])]":"[0, 0]"}),d?[{name:s,on:[]}]:[{name:a,value:[],on:b},{name:s,on:[{events:{signal:a},update:a+"[0] === "+a+"[1] ? null : invert("+m+", "+a+")"}]}]}function r(e,t){return e.events.reduce(function(e,n){return n.between?t(e,n):(s.warn(n+" is not an ordered event stream for interval selections"),e)},[])}Object.defineProperty(n,"__esModule",{value:!0});var a=e("tslib"),o=e("../../channel"),s=e("../../log"),l=e("../../scale"),u=e("../../util"),c=e("./selection"),f=e("./transforms/scales");n.BRUSH="_brush",n.SCALE_TRIGGER="_scale_trigger";var d={predicate:"vlInterval",scaleDomain:"vlIntervalDomain",signals:function(e,t){var a=t.name,d=f.default.has(t),p=[],m=[],g=[],h=[];if(t.translate&&!d){var v="!event.item || event.item.mark.name !== "+u.stringValue(a+n.BRUSH);r(t,function(e,t){var n=t.between[0].filter||(t.between[0].filter=[]);n.indexOf(v)<0&&n.push(v)})}return t.project.forEach(function(n){var r=n.channel;if(r===o.X||r===o.Y){var a=i(e,t,r),f=c.channelSignalName(t,r,"data"),d=c.channelSignalName(t,r,"visual"),v=u.stringValue(e.scaleName(r)),y=e.getScaleComponent(r).get("type"),b=l.hasContinuousDomain(y)?"+":"";p.push.apply(p,a),g.push(f),m.push("{encoding: "+u.stringValue(r)+", field: "+u.stringValue(n.field)+", extent: "+f+"}"),h.push({scaleName:e.scaleName(r),expr:"(!isArray("+f+") || ("+b+"invert("+v+", "+d+")[0] === "+b+f+"[0] && "+b+"invert("+v+", "+d+")[1] === "+b+f+"[1]))"})}else s.warn("Interval selections only support x and y encoding channels.")}),d||p.push({name:a+n.SCALE_TRIGGER,update:h.map(function(e){return e.expr}).join(" && ")+" ? "+(a+n.SCALE_TRIGGER)+" : {}"}),p.concat({name:a+c.TUPLE,on:[{events:g.map(function(e){return{signal:e}}),update:g.join(" && ")+" ? {unit: "+c.unitName(e)+", intervals: ["+m.join(", ")+"]} : null"}]})},modifyExpr:function(e,t){return t.name+c.TUPLE+", "+("global"===t.resolve?"true":"{unit: "+c.unitName(e)+"}")},marks:function(e,t,i){var r=t.name,o=c.spatialProjections(t),s=o.xi,l=o.yi,d="data("+u.stringValue(t.name+c.STORE)+")";if(f.default.has(t))return i;var p={x:null!==s?{signal:r+"_x[0]"}:{value:0},y:null!==l?{signal:r+"_y[0]"}:{value:0},x2:null!==s?{signal:r+"_x[1]"}:{field:{group:"width"}},y2:null!==l?{signal:r+"_y[1]"}:{field:{group:"height"}}};"global"===t.resolve&&u.keys(p).forEach(function(t){p[t]=[a.__assign({test:d+".length && "+d+"[0].unit === "+c.unitName(e)},p[t]),{value:0}]});var m=t.mark,g=m.fill,h=m.fillOpacity,v=a.__rest(m,["fill","fillOpacity"]),y=u.keys(v).reduce(function(e,t){return e[t]={value:v[t]},e},{});return[{name:r+n.BRUSH+"_bg",type:"rect",clip:!0,encode:{enter:{fill:{value:g},fillOpacity:{value:h}},update:p}}].concat(i,{name:r+n.BRUSH,type:"rect",clip:!0,encode:{enter:a.__assign({fill:{value:"transparent"}},y),update:p}})}};n.default=d},{"../../channel":12,"../../log":101,"../../scale":104,"../../util":114,"./selection":76,"./transforms/scales":81,tslib:5}],75:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../util"),r=e("./selection"),a=e("./transforms/nearest"),o={predicate:"vlMulti",scaleDomain:"vlMultiDomain",signals:function(e,t){var n=t.project,o=a.default.has(t)?"(item().isVoronoi ? datum.datum : datum)":"datum",s=[],l=n.map(function(e){return i.stringValue(e.channel)}).filter(function(e){return e}).join(", "),u=n.map(function(e){return i.stringValue(e.field)}).join(", "),c=n.map(function(t){var n=t.channel,r=e.fieldDef(n);return r&&r.bin?(s.push(t.field),"["+o+"["+i.stringValue(e.field(n,{}))+"], "+o+"["+i.stringValue(e.field(n,{binSuffix:"end"}))+"]]"):o+"["+i.stringValue(t.field)+"]"}).join(", ");return[{name:t.name+r.TUPLE,value:{},on:[{events:t.events,update:"datum && item().mark.marktype !== 'group' ? {unit: "+r.unitName(e)+", encodings: ["+l+"], fields: ["+u+"], values: ["+c+"]"+(s.length?", "+s.map(function(e){return i.stringValue("bin_"+e)+": 1"}).join(", "):"")+"} : null",force:!0}]}]},modifyExpr:function(e,t){return t.name+r.TUPLE+", "+("global"===t.resolve?"null":"{unit: "+r.unitName(e)+"}")}};n.default=o},{"../../util":114,"./selection":76,"./transforms/nearest":79}],76:[function(e,t,n){"use strict";function i(e,t){var n=t;return r(e,function(i,r){n=r.marks?r.marks(e,i,n):n,v.forEachTransform(i,function(r){r.marks&&(n=r.marks(e,i,t,n))})}),n}function r(e,t){var n=e.component.selection;for(var i in n)if(n.hasOwnProperty(i)){var r=n[i];t(r,a(r.type))}}function a(e){switch(e){case"single":return h.default;case"multi":return g.default;case"interval":return m.default}return null}function o(e){for(var t=e.parent;t&&!p.isFacetModel(t);)t=t.parent;return t}Object.defineProperty(n,"__esModule",{value:!0});var s=e("tslib"),l=e("vega-event-selector"),u=e("../../channel"),c=e("../../log"),f=e("../../selection"),d=e("../../util"),p=e("../model"),m=e("./interval"),g=e("./multi"),h=e("./single"),v=e("./transforms/transforms");n.STORE="_store",n.TUPLE="_tuple",n.MODIFY="_modify",n.SELECTION_DOMAIN="_selection_domain_",n.parseUnitSelection=function(e,t){var n={},i=e.config.selection;for(var r in t)!function(r){if(!t.hasOwnProperty(r))return"continue";var a=t[r],o=i[a.type];for(var u in o)"encodings"===u&&a.fields||"fields"===u&&a.encodings||("mark"===u&&(a[u]=s.__assign({},o[u],a[u])),void 0!==a[u]&&!0!==a[u]||(a[u]=o[u]||a[u]));r=d.varName(r);var c=n[r]=s.__assign({},a,{name:r,events:d.isString(a.on)?l.selector(a.on,"scope"):a.on});v.forEachTransform(c,function(t){t.parse&&t.parse(e,a,c)})}(r);return n},n.assembleUnitSelectionSignals=function(e,t){r(e,function(i,r){var a=i.name,o=r.modifyExpr(e,i);t.push.apply(t,r.signals(e,i)),v.forEachTransform(i,function(n){n.signals&&(t=n.signals(e,i,t)),n.modifyExpr&&(o=n.modifyExpr(e,i,o))}),t.push({name:a+n.MODIFY,on:[{events:{signal:a+n.TUPLE},update:"modify("+d.stringValue(i.name+n.STORE)+", "+o+")"}]})});var i=o(e);if(t.length&&i){var a=d.stringValue(i.getName("cell"));t.unshift({name:"facet",value:{},on:[{events:l.selector("mousemove","scope"),update:"isTuple(facet) ? facet : group("+a+").datum"}]})}return t},n.assembleTopLevelSignals=function(e,t){var n=!1;return r(e,function(i,r){r.topLevelSignals&&(t=r.topLevelSignals(e,i,t)),v.forEachTransform(i,function(n){n.topLevelSignals&&(t=n.topLevelSignals(e,i,t))}),n=!0}),n&&(t.filter(function(e){return"unit"===e.name}).length||t.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]})),t},n.assembleUnitSelectionData=function(e,t){return r(e,function(e){t.filter(function(t){return t.name===e.name+n.STORE}).length||t.push({name:e.name+n.STORE})}),t},n.assembleUnitSelectionMarks=i,n.assembleLayerSelectionMarks=function(e,t){return e.children.forEach(function(e){p.isUnitModel(e)&&(t=i(e,t))}),t},n.predicate=function(e,t,i){var r=[],o=d.logicalExpr(t,function(t){var o=d.varName(t),s=e.getSelectionComponent(o,t),l=d.stringValue(o+n.STORE);if(s.timeUnit){var u=i||e.component.data.raw,c=s.timeUnit.clone();u.parent?c.insertAsParentOf(u):u.parent=c}return r.push(l),a(s.type).predicate+"("+l+", datum"+("global"===s.resolve?")":", "+d.stringValue(s.resolve)+")")});return"!("+r.map(function(e){return"length(data("+e+"))"}).join(" || ")+") || ("+o+")"},n.isRawSelectionDomain=function(e){return e.signal.indexOf(n.SELECTION_DOMAIN)>=0},n.selectionScaleDomain=function(e,t){var i=JSON.parse(t.signal.replace(n.SELECTION_DOMAIN,"")),r=d.varName(i.selection),o=e.component.selection&&e.component.selection[r];return o?(c.warn('Use "bind": "scales" to setup a binding for scales and selections within the same view.'),{signal:"null"}):(o=e.getSelectionComponent(r,i.selection),i.encoding||i.field||(i.field=o.project[0].field,o.project.length>1&&c.warn('A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": '+d.stringValue(i.field)+".")),{signal:a(o.type).scaleDomain+"("+d.stringValue(r+n.STORE)+", "+d.stringValue(i.encoding||null)+", "+d.stringValue(i.field||null)+("global"===o.resolve?")":", "+d.stringValue(o.resolve)+")")})},n.unitName=function(e){var t=d.stringValue(e.name),n=o(e);return n&&(t+=(n.facet.row?" + '_' + facet["+d.stringValue(n.field("row"))+"]":"")+(n.facet.column?" + '_' + facet["+d.stringValue(n.field("column"))+"]":"")),t},n.requiresSelectionId=function(e){var t=!1;return r(e,function(e){t=t||e.project.some(function(e){return e.field===f.SELECTION_ID})}),t},n.channelSignalName=function(e,t,n){return d.varName(e.name+"_"+("visual"===n?t:e.fields[t]))},n.spatialProjections=function(e){var t=null,n=null,i=null,r=null;return e.project.forEach(function(e,a){e.channel===u.X?(t=e,n=a):e.channel===u.Y&&(i=e,r=a)}),{x:t,xi:n,y:i,yi:r}}},{"../../channel":12,"../../log":101,"../../selection":105,"../../util":114,"../model":63,"./interval":74,"./multi":75,"./single":77,"./transforms/transforms":83,tslib:5,"vega-event-selector":6}],77:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../util"),r=e("./multi"),a=e("./selection"),o={predicate:"vlSingle",scaleDomain:"vlSingleDomain",signals:r.default.signals,topLevelSignals:function(e,t,n){var r=n.filter(function(e){return e.name===t.name}),o="data("+i.stringValue(t.name+a.STORE)+")",s=o+"[0].values";return r.length?n:n.concat({name:t.name,update:o+".length && {"+t.project.map(function(e,t){return e.field+": "+s+"["+t+"]"}).join(", ")+"}"})},modifyExpr:function(e,t){return t.name+a.TUPLE+", "+("global"===t.resolve?"true":"{unit: "+a.unitName(e)+"}")}};n.default=o},{"../../util":114,"./multi":75,"./selection":76}],78:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../../util"),r=e("../selection"),a=e("./nearest"),o={has:function(e){return"single"===e.type&&"global"===e.resolve&&e.bind&&"scales"!==e.bind},topLevelSignals:function(e,t,n){var r=t.name,o=t.project,s=t.bind,l=a.default.has(t)?"(item().isVoronoi ? datum.datum : datum)":"datum";return o.forEach(function(e){var a=i.varName(r+"_"+e.field);n.filter(function(e){return e.name===a}).length||n.unshift({name:a,value:"",on:[{events:t.events,update:"datum && item().mark.marktype !== 'group' ? "+l+"["+i.stringValue(e.field)+"] : null"}],bind:s[e.field]||s[e.channel]||s})}),n},signals:function(e,t,n){var a=t.name,o=t.project,s=n.filter(function(e){return e.name===a+r.TUPLE})[0],l=o.map(function(e){return i.stringValue(e.field)}).join(", "),u=o.map(function(e){return i.varName(a+"_"+e.field)});return s.update=u.join(" && ")+" ? {fields: ["+l+"], values: ["+u.join(", ")+"]} : null",delete s.value,delete s.on,n}};n.default=o},{"../../../util":114,"../selection":76,"./nearest":79}],79:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("../selection"),r={has:function(e){return"interval"!==e.type&&e.nearest},marks:function(e,t,n,r){var a=i.spatialProjections(t),o=a.x,s=a.y,l=n[0],u=r.indexOf(l),c=l.name===e.getName("pathgroup"),f=function(e){return e.name&&e.name.indexOf("voronoi")>=0},d={name:e.getName("voronoi"),type:"path",from:{data:e.getName("marks")},encode:{enter:{fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}}},transform:[{type:"voronoi",x:o||!o&&!s?"datum.x":{expr:"0"},y:s||!o&&!s?"datum.y":{expr:"0"},size:[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]}]};return c&&!l.marks.filter(f).length?(l.marks.push(d),r.splice(u,1,l)):c||r.filter(f).length||r.splice(u+1,0,d),r}};n.default=r},{"../selection":76}],80:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../../log"),r=e("../../../util"),a=e("../../data/timeunit"),o={has:function(e){return void 0!==e.fields||void 0!==e.encodings},parse:function(e,t,n){var o={},s={};(t.fields||[]).forEach(function(e){return o[e]=null}),(t.encodings||[]).forEach(function(t){var n=e.fieldDef(t);if(n)if(n.timeUnit){var r=e.field(t);o[r]=t,s[r]={as:r,field:n.field,timeUnit:n.timeUnit}}else o[n.field]=t;else i.warn(i.message.cannotProjectOnChannelWithoutField(t))});var l=n.project||(n.project=[]);for(var u in o)o.hasOwnProperty(u)&&l.push({field:u,channel:o[u]});var c=n.fields||(n.fields={});l.filter(function(e){return e.channel}).forEach(function(e){return c[e.channel]=e.field}),r.keys(s).length&&(n.timeUnit=new a.TimeUnitNode(s))}};n.default=o},{"../../../log":101,"../../../util":114,"../../data/timeunit":40}],81:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../../log"),r=e("../../../scale"),a=e("../../../util"),o=e("../selection"),s={has:function(e){return"interval"===e.type&&"global"===e.resolve&&e.bind&&"scales"===e.bind},parse:function(e,t,n){var a=n.scales=[];n.project.forEach(function(t){var s=t.channel,l=e.getScaleComponent(s),u=l?l.get("type"):void 0;l&&r.hasContinuousDomain(u)&&!r.isBinScale(u)?(l.set("domainRaw",{signal:o.channelSignalName(n,s,"data")},!0),a.push(s)):i.warn("Scale bindings are currently only supported for scales with unbinned, continuous domains.")})},topLevelSignals:function(e,t,n){if(!e.parent)return n;var i=t.scales.filter(function(e){return!n.filter(function(n){return n.name===o.channelSignalName(t,e,"data")}).length});return n.concat(i.map(function(e){return{name:o.channelSignalName(t,e,"data")}}))},signals:function(e,t,n){return e.parent&&t.scales.forEach(function(e){var i=n.filter(function(n){return n.name===o.channelSignalName(t,e,"data")})[0];i.push="outer",delete i.value,delete i.update}),n}};n.default=s,n.domain=function(e,t){return"domain("+a.stringValue(e.scaleName(t))+")"}},{"../../../log":101,"../../../scale":104,"../../../util":114,"../selection":76}],82:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("../selection"),r={has:function(e){return"multi"===e.type&&e.toggle},signals:function(e,t,n){return n.concat({name:t.name+"_toggle",value:!1,on:[{events:t.events,update:t.toggle}]})},modifyExpr:function(e,t,n){var r=t.name+i.TUPLE,a=t.name+"_toggle";return a+" ? null : "+r+", "+("global"===t.resolve?a+" ? null : true, ":a+" ? null : {unit: "+i.unitName(e)+"}, ")+a+" ? "+r+" : null"}};n.default=r},{"../selection":76}],83:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("./inputs"),r=e("./nearest"),a=e("./project"),o=e("./scales"),s=e("./toggle"),l=e("./translate"),u=e("./zoom"),c={project:a.default,toggle:s.default,scales:o.default,translate:l.default,zoom:u.default,inputs:i.default,nearest:r.default};n.forEachTransform=function(e,t){for(var n in c)c[n].has(e)&&t(c[n])}},{"./inputs":78,"./nearest":79,"./project":80,"./scales":81,"./toggle":82,"./translate":84,"./zoom":85}],84:[function(e,t,n){"use strict";function i(e,t,n,i,r){var o=t.name,f=l.default.has(t),d=r.filter(function(e){return e.name===s.channelSignalName(t,n,f?"data":"visual")})[0],p=o+u,m=o+c,g=e.getSizeSignalRef(i).signal,h=e.getScaleComponent(n),v=h.get("type"),y=f&&n===a.X?"-":"",b=p+".extent_"+n,_=""+y+m+"."+n+" / "+(f?""+g:"span("+b+")"),S=(f?"log"===v?"panLog":"pow"===v?"panPow":"panLinear":"panLinear")+"("+b+", "+_+(f&&"pow"===v?", "+(h.get("exponent")||1):"")+")";d.on.push({events:{signal:m},update:f?S:"clampRange("+S+", 0, "+g+")"})}Object.defineProperty(n,"__esModule",{value:!0});var r=e("vega-event-selector"),a=e("../../../channel"),o=e("../interval"),s=e("../selection"),l=e("./scales"),u="_translate_anchor",c="_translate_delta",f={has:function(e){return"interval"===e.type&&e.translate},signals:function(e,t,n){var f=t.name,d=l.default.has(t),p=f+u,m=s.spatialProjections(t),g=m.x,h=m.y,v=r.selector(t.translate,"scope");return d||(v=v.map(function(e){return e.between[0].markname=f+o.BRUSH,e})),n.push({name:p,value:{},on:[{events:v.map(function(e){return e.between[0]}),update:"{x: x(unit), y: y(unit)"+(null!==g?", extent_x: "+(d?l.domain(e,a.X):"slice("+s.channelSignalName(t,"x","visual")+")"):"")+(null!==h?", extent_y: "+(d?l.domain(e,a.Y):"slice("+s.channelSignalName(t,"y","visual")+")"):"")+"}"}]},{name:f+c,value:{},on:[{events:v,update:"{x: "+p+".x - x(unit), y: "+p+".y - y(unit)}"}]}),null!==g&&i(e,t,a.X,"width",n),null!==h&&i(e,t,a.Y,"height",n),n}};n.default=f},{"../../../channel":12,"../interval":74,"../selection":76,"./scales":81,"vega-event-selector":6}],85:[function(e,t,n){"use strict";function i(e,t,n,i,r){var a=t.name,o=u.default.has(t),s=r.filter(function(e){return e.name===l.channelSignalName(t,n,o?"data":"visual")})[0],d=e.getSizeSignalRef(i).signal,p=e.getScaleComponent(n),m=p.get("type"),g=o?u.domain(e,n):s.name,h=a+f,v=""+a+c+"."+n,y=(o?"log"===m?"zoomLog":"pow"===m?"zoomPow":"zoomLinear":"zoomLinear")+"("+g+", "+v+", "+h+(o&&"pow"===m?", "+(p.get("exponent")||1):"")+")";s.on.push({events:{signal:h},update:o?y:"clampRange("+y+", 0, "+d+")"})}Object.defineProperty(n,"__esModule",{value:!0});var r=e("vega-event-selector"),a=e("../../../channel"),o=e("../../../util"),s=e("../interval"),l=e("../selection"),u=e("./scales"),c="_zoom_anchor",f="_zoom_delta",d={has:function(e){return"interval"===e.type&&e.zoom},signals:function(e,t,n){var d=t.name,p=u.default.has(t),m=d+f,g=l.spatialProjections(t),h=g.x,v=g.y,y=o.stringValue(e.scaleName(a.X)),b=o.stringValue(e.scaleName(a.Y)),_=r.selector(t.zoom,"scope");return p||(_=_.map(function(e){return e.markname=d+s.BRUSH,e})),n.push({name:d+c,on:[{events:_,update:p?"{"+[y?"x: invert("+y+", x(unit))":"",b?"y: invert("+b+", y(unit))":""].filter(function(e){return!!e}).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:m,on:[{events:_,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),null!==h&&i(e,t,"x","width",n),null!==v&&i(e,t,"y","height",n),n}};n.default=d},{"../../../channel":12,"../../../util":114,"../interval":74,"../selection":76,"./scales":81,"vega-event-selector":6}],86:[function(e,t,n){"use strict";function i(e,t,n,i){return e.explicit&&t.explicit&&a.warn(a.message.mergeConflictingProperty(n,i,e.value,t.value)),e}Object.defineProperty(n,"__esModule",{value:!0});var r=e("tslib"),a=e("../log"),o=e("../util"),s=function(){function e(e,t){void 0===e&&(e={}),void 0===t&&(t={}),this.explicit=e,this.implicit=t}return e.prototype.clone=function(){return new e(o.duplicate(this.explicit),o.duplicate(this.implicit))},e.prototype.combine=function(){return r.__assign({},this.explicit,this.implicit)},e.prototype.get=function(e){return void 0!==this.explicit[e]?this.explicit[e]:this.implicit[e]},e.prototype.getWithExplicit=function(e){return void 0!==this.explicit[e]?{explicit:!0,value:this.explicit[e]}:void 0!==this.implicit[e]?{explicit:!1,value:this.implicit[e]}:{explicit:!1,value:void 0}},e.prototype.setWithExplicit=function(e,t){void 0!==t.value&&this.set(e,t.value,t.explicit)},e.prototype.set=function(e,t,n){return delete this[n?"implicit":"explicit"][e],this[n?"explicit":"implicit"][e]=t,this},e.prototype.copyKeyFromSplit=function(e,t){void 0!==t.explicit[e]?this.set(e,t.explicit[e],!0):void 0!==t.implicit[e]&&this.set(e,t.implicit[e],!1)},e.prototype.copyKeyFromObject=function(e,t){void 0!==t[e]&&this.set(e,t[e],!0)},e}();n.Split=s,n.makeExplicit=function(e){return{explicit:!0,value:e}},n.makeImplicit=function(e){return{explicit:!1,value:e}},n.tieBreakByComparing=function(e){return function(t,n,r,a){var o=e(t.value,n.value);return o>0?t:o<0?n:i(t,n,r,a)}},n.defaultTieBreaker=i,n.mergeValuesWithExplicit=function(e,t,n,r,a){return void 0===a&&(a=i),void 0===e||void 0===e.value?t:e.explicit&&!t.explicit?e:t.explicit&&!e.explicit?t:e.value===t.value?e:a(e,t,n,r)}},{"../log":101,"../util":114,tslib:5}],87:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib"),r=e("../channel"),a=e("../encoding"),o=e("../encoding"),s=e("../fielddef"),l=e("../mark"),u=e("../stack"),c=e("../util"),f=e("./axis/parse"),d=e("./data/parse"),p=e("./layoutsize/assemble"),m=e("./layoutsize/parse"),g=e("./mark/init"),h=e("./mark/mark"),v=e("./model"),y=e("./repeater"),b=e("./selection/selection"),_=function(e){function t(t,n,r,a,s,c){void 0===a&&(a={});var f=e.call(this,t,n,r,c,void 0)||this;f.type="unit",f.specifiedScales={},f.specifiedAxes={},f.specifiedLegends={},f.selection={},f.children=[],f.initSize(i.__assign({},a,t.width?{width:t.width}:{},t.height?{height:t.height}:{})),f.markDef=l.isMarkDef(t.mark)?i.__assign({},t.mark):{type:t.mark};var d=f.markDef.type,p=f.encoding=o.normalizeEncoding(y.replaceRepeaterInEncoding(t.encoding||{},s),d);return f.stack=u.stack(d,p,f.config.stack),f.specifiedScales=f.initScales(d,p),f.encoding=g.initEncoding(f.markDef,p,f.stack,f.config),f.specifiedAxes=f.initAxes(p),f.specifiedLegends=f.initLegend(p),f.selection=t.selection,f}return i.__extends(t,e),t.prototype.scaleDomain=function(e){var t=this.specifiedScales[e];return t?t.domain:void 0},t.prototype.sort=function(e){return(this.getMapping()[e]||{}).sort},t.prototype.axis=function(e){return this.specifiedAxes[e]},t.prototype.legend=function(e){return this.specifiedLegends[e]},t.prototype.initScales=function(e,t){return r.SCALE_CHANNELS.reduce(function(e,n){var i,r,a=t[n];return s.isFieldDef(a)?(i=a,r=a.scale):s.isConditionalDef(a)&&s.isFieldDef(a.condition)?(i=a.condition,r=a.condition.scale):"x"===n?i=s.getFieldDef(t.x2):"y"===n&&(i=s.getFieldDef(t.y2)),i&&(e[n]=r||{}),e},{})},t.prototype.initAxes=function(e){return[r.X,r.Y].reduce(function(t,n){var a=e[n];if(s.isFieldDef(a)||n===r.X&&s.isFieldDef(e.x2)||n===r.Y&&s.isFieldDef(e.y2)){var o=s.isFieldDef(a)?a.axis:null;null!==o&&!1!==o&&(t[n]=i.__assign({},o))}return t},{})},t.prototype.initLegend=function(e){return r.NONSPATIAL_SCALE_CHANNELS.reduce(function(t,n){var r=e[n];if(r){var a=s.isFieldDef(r)?r.legend:r.condition&&s.isFieldDef(r.condition)?r.condition.legend:null;null!==a&&!1!==a&&(t[n]=i.__assign({},a))}return t},{})},t.prototype.parseData=function(){this.component.data=d.parseData(this)},t.prototype.parseLayoutSize=function(){m.parseUnitLayoutSize(this)},t.prototype.parseSelection=function(){this.component.selection=b.parseUnitSelection(this,this.selection)},t.prototype.parseMarkGroup=function(){this.component.mark=h.parseMarkGroup(this)},t.prototype.parseAxisAndHeader=function(){this.component.axes=f.parseUnitAxis(this)},t.prototype.assembleSelectionTopLevelSignals=function(e){return b.assembleTopLevelSignals(this,e)},t.prototype.assembleSelectionSignals=function(){return b.assembleUnitSelectionSignals(this,[])},t.prototype.assembleSelectionData=function(e){return b.assembleUnitSelectionData(this,e)},t.prototype.assembleLayout=function(){return null},t.prototype.assembleLayoutSignals=function(){return p.assembleLayoutSignals(this)},t.prototype.assembleMarks=function(){var e=this.component.mark||[];return this.parent&&v.isLayerModel(this.parent)||(e=b.assembleUnitSelectionMarks(this,e)),e.map(this.correctDataNames)},t.prototype.assembleLayoutSize=function(){return{width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")}},t.prototype.getMapping=function(){return this.encoding},t.prototype.toSpec=function(e,t){var n,i=c.duplicate(this.encoding);return n={mark:this.markDef,encoding:i},e||(n.config=c.duplicate(this.config)),t||(n.data=c.duplicate(this.data)),n},t.prototype.mark=function(){return this.markDef.type},t.prototype.channelHasField=function(e){return a.channelHasField(this.encoding,e)},t.prototype.fieldDef=function(e){var t=this.encoding[e];return s.getFieldDef(t)},t}(v.ModelWithField);n.UnitModel=_},{"../channel":12,"../encoding":94,"../fielddef":96,"../mark":103,"../stack":108,"../util":114,"./axis/parse":16,"./data/parse":37,"./layoutsize/assemble":44,"./layoutsize/parse":45,"./mark/init":53,"./mark/mark":55,"./model":63,"./repeater":65,"./selection/selection":76,tslib:5}],88:[function(e,t,n){"use strict";function i(e){return!!e.type}function r(e){return l.__assign({},e,{encoding:c.reduce(e.encoding,function(e,t,i){return m.indexOf(i)>-1?e[i]=t:p.warn(p.message.incompatibleChannel(i,n.BOXPLOT)),e},{})})}function a(e){var t=e.mark,r=e.encoding;l.__rest(e,["mark","encoding"]);if(d.isFieldDef(r.x)&&d.isContinuous(r.x)){if(d.isFieldDef(r.y)&&d.isContinuous(r.y)){if(void 0===r.x.aggregate&&r.y.aggregate===n.BOXPLOT)return"vertical";if(void 0===r.y.aggregate&&r.x.aggregate===n.BOXPLOT)return"horizontal";if(r.x.aggregate===n.BOXPLOT&&r.y.aggregate===n.BOXPLOT)throw new Error("Both x and y cannot have aggregate");return i(t)&&t.orient?t.orient:"vertical"}return"horizontal"}if(d.isFieldDef(r.y)&&d.isContinuous(r.y))return"vertical";throw new Error("Need a valid continuous axis for boxplots")}function o(e,t){e.mark;var i,r,a=e.encoding;l.__rest(e,["mark","encoding"]);if("vertical"===t?(r="y",i=a.y):(r="x",i=a.x),i&&i.aggregate){var o=i.aggregate,s=l.__rest(i,["aggregate"]);o!==n.BOXPLOT&&p.warn("Continuous axis should not have customized aggregation function "+o),i=s}return{continuousAxisChannelDef:i,continuousAxis:r}}function s(e,t,i){var r=o(e,t),a=r.continuousAxisChannelDef,s=r.continuousAxis,l=e.encoding,u=void 0===i,c=[{aggregate:"q1",field:a.field,as:"lowerBox"},{aggregate:"q3",field:a.field,as:"upperBox"},{aggregate:"median",field:a.field,as:"midBox"}],p=[];u?(c.push({aggregate:"min",field:a.field,as:"lowerWhisker"}),c.push({aggregate:"max",field:a.field,as:"upperWhisker"})):p=[{calculate:"datum.upperBox - datum.lowerBox",as:"IQR"},{calculate:"datum.lowerBox - datum.IQR * "+i,as:"lowerWhisker"},{calculate:"datum.upperBox + datum.IQR * "+i,as:"lowerWhisker"}];var m=[],g=[],h=[],v={};return f.forEach(l,function(e,t){if(t!==s)if(d.isFieldDef(e)){if(e.aggregate&&e.aggregate!==n.BOXPLOT)c.push({aggregate:e.aggregate,field:e.field,as:d.field(e)});else if(void 0===e.aggregate){var i=d.field(e),r=e.bin;if(r){var a=e.field;g.push({bin:r,field:a,as:i})}else if(e.timeUnit){var o=e.timeUnit,u=e.field;h.push({timeUnit:o,field:u,as:i})}m.push(i)}v[t]={field:d.field(e),type:e.type}}else v[t]=l[t]}),{transform:[].concat(g,h,[{summarize:c,groupby:m}],p),continuousAxisChannelDef:a,continuousAxis:s,encodingWithoutContinuousAxis:v}}Object.defineProperty(n,"__esModule",{value:!0});var l=e("tslib"),u=e("vega-util"),c=e("../encoding"),f=e("./../encoding"),d=e("./../fielddef"),p=e("./../log");n.BOXPLOT="box-plot",n.isBoxPlotDef=i,n.BOXPLOT_STYLES=["boxWhisker","box","boxMid"],n.VL_ONLY_BOXPLOT_CONFIG_PROPERTY_INDEX={box:["size"]};var m=["x","y","color","detail","opacity","size"];n.filterUnsupportedChannels=r,n.normalizeBoxPlot=function(e,t){var n=(e=r(e)).mark,o=(e.encoding,e.selection),c=l.__rest(e,["mark","encoding","selection"]),f=void 0;i(n)&&n.extent&&u.isNumber(n.extent)&&(f=n.extent);var d=s(e,a(e),f),p=d.transform,m=d.continuousAxisChannelDef,g=d.continuousAxis,h=d.encodingWithoutContinuousAxis,v=h.size,y=(h.color,l.__rest(h,["size","color"])),b=v?{size:v}:{size:{value:t.box.size}},_={};return m.scale&&(_.scale=m.scale),m.axis&&(_.axis=m.axis),l.__assign({},c,{transform:p,layer:[{mark:{type:"rule",style:"boxWhisker"},encoding:l.__assign((S={},S[g]=l.__assign({field:"lowerWhisker",type:m.type},_),S[g+"2"]={field:"lowerBox",type:m.type},S),y)},{mark:{type:"rule",style:"boxWhisker"},encoding:l.__assign((E={},E[g]={field:"upperBox",type:m.type},E[g+"2"]={field:"upperWhisker",type:m.type},E),y)},l.__assign({},o?{selection:o}:{},{mark:{type:"bar",style:"box"},encoding:l.__assign((x={},x[g]={field:"lowerBox",type:m.type},x[g+"2"]={field:"upperBox",type:m.type},x),h,b)}),{mark:{type:"tick",style:"boxMid"},encoding:l.__assign((O={},O[g]={field:"midBox",type:m.type},O),y,b)}]});var S,E,x,O}},{"../encoding":94,"./../encoding":94,"./../fielddef":96,"./../log":101,tslib:5,"vega-util":7}],89:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib");n.ERRORBAR="error-bar",n.normalizeErrorBar=function(e){e.mark,e.selection;var t=e.encoding,n=i.__rest(e,["mark","selection","encoding"]),r=(t.size,i.__rest(t,["size"])),a=(t.x2,t.y2,i.__rest(t,["x2","y2"])),o=(a.x,a.y,i.__rest(a,["x","y"]));if(!t.x2&&!t.y2)throw new Error("Neither x2 or y2 provided");return i.__assign({},n,{layer:[{mark:"rule",encoding:r},{mark:"tick",encoding:a},{mark:"tick",encoding:t.x2?i.__assign({x:t.x2,y:t.y},o):i.__assign({x:t.x,y:t.y2},o)}]})}},{tslib:5}],90:[function(e,t,n){"use strict";function i(e,t){l[e]=t}Object.defineProperty(n,"__esModule",{value:!0});var r=e("tslib"),a=e("./../mark"),o=e("./boxplot"),s=e("./errorbar"),l={};n.add=i,n.remove=function(e){delete l[e]},n.COMPOSITE_MARK_STYLES=o.BOXPLOT_STYLES,n.VL_ONLY_COMPOSITE_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX=r.__assign({},o.VL_ONLY_BOXPLOT_CONFIG_PROPERTY_INDEX),i(o.BOXPLOT,o.normalizeBoxPlot),i(s.ERRORBAR,s.normalizeErrorBar),n.normalize=function(e,t){var n=a.isMarkDef(e.mark)?e.mark.type:e.mark,i=l[n];if(i)return i(e,t);throw new Error("Unregistered composite mark "+n)}},{"./../mark":103,"./boxplot":88,"./errorbar":89,tslib:5}],91:[function(e,t,n){"use strict";function i(e,t,n){var i="title"===t?p.extractTitleConfig(e.title).mark:e[t];"view"===t&&(n="cell");var a=r.__assign({},i,e.style[t]);m.keys(a).length>0&&(e.style[n||t]=a),delete e[t]}Object.defineProperty(n,"__esModule",{value:!0});var r=e("tslib"),a=e("./compositemark"),o=e("./compositemark/index"),s=e("./guide"),l=e("./legend"),u=e("./mark"),c=e("./mark"),f=e("./scale"),d=e("./selection"),p=e("./title"),m=e("./util");n.defaultViewConfig={width:200,height:200},n.defaultConfig={padding:5,timeFormat:"%b %d, %Y",countTitle:"Number of Records",invalidValues:"filter",view:n.defaultViewConfig,mark:c.defaultMarkConfig,area:{},bar:c.defaultBarConfig,circle:{},line:{},point:{},rect:{},rule:{color:"black"},square:{},text:{color:"black"},tick:c.defaultTickConfig,box:{size:14},boxWhisker:{},boxMid:{color:"white"},scale:f.defaultScaleConfig,axis:{},axisX:{},axisY:{minExtent:30},axisLeft:{},axisRight:{},axisTop:{},axisBottom:{},axisBand:{},legend:l.defaultLegendConfig,selection:d.defaultConfig,style:{},title:{}},n.initConfig=function(e){return m.mergeDeep(m.duplicate(n.defaultConfig),e)};var g=["view"].concat(u.PRIMITIVE_MARKS,a.COMPOSITE_MARK_STYLES),h=["padding","numberFormat","timeFormat","countTitle","stack","scale","selection","invalidValues","overlay"],v=r.__assign({view:["width","height"]},u.VL_ONLY_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX,o.VL_ONLY_COMPOSITE_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX);n.stripAndRedirectConfig=function(e){e=m.duplicate(e);for(var t=0,n=h;t<n.length;t++)delete e[O=n[t]];if(e.axis)for(var r=0,a=s.VL_ONLY_GUIDE_CONFIG;r<a.length;r++)O=a[r],delete e.axis[O];if(e.legend)for(var o=0,l=s.VL_ONLY_GUIDE_CONFIG;o<l.length;o++)O=l[o],delete e.legend[O];if(e.mark)for(var c=0,f=u.VL_ONLY_MARK_CONFIG_PROPERTIES;c<f.length;c++)O=f[c],delete e.mark[O];for(var d=0,p=g;d<p.length;d++){for(var y=p[d],b=0,_=u.VL_ONLY_MARK_CONFIG_PROPERTIES;b<_.length;b++)O=_[b],delete e[y][O];var S=v[y];if(S)for(var E=0,x=S;E<x.length;E++)O=x[E],delete e[y][O];i(e,y)}i(e,"title","group-title");for(var O in e)m.isObject(e[O])&&0===m.keys(e[O]).length&&delete e[O];return m.keys(e).length>0?e:void 0}},{"./compositemark":90,"./compositemark/index":90,"./guide":98,"./legend":100,"./mark":103,"./scale":104,"./selection":105,"./title":110,"./util":114,tslib:5}],92:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.isUrlData=function(e){return!!e.url},n.isInlineData=function(e){return!!e.values},n.isNamedData=function(e){return!!e.name},n.MAIN="main",n.RAW="raw"},{}],93:[function(e,t,n){"use strict";function i(e){if(s.isNumber(e))return e>4&&o.warn(o.message.invalidTimeUnit("quarter",e)),e-1+"";throw new Error(o.message.invalidTimeUnit("quarter",e))}function r(e){if(s.isNumber(e))return e-1+"";var t=e.toLowerCase(),i=n.MONTHS.indexOf(t);if(-1!==i)return i+"";var r=t.substr(0,3),a=n.SHORT_MONTHS.indexOf(r);if(-1!==a)return a+"";throw new Error(o.message.invalidTimeUnit("month",e))}function a(e){if(s.isNumber(e))return e%7+"";var t=e.toLowerCase(),i=n.DAYS.indexOf(t);if(-1!==i)return i+"";var r=t.substr(0,3),a=n.SHORT_DAYS.indexOf(r);if(-1!==a)return a+"";throw new Error(o.message.invalidTimeUnit("day",e))}Object.defineProperty(n,"__esModule",{value:!0});var o=e("./log"),s=e("./util"),l=2006;n.isDateTime=function(e){return!(!e||!(e.year||e.quarter||e.month||e.date||e.day||e.hours||e.minutes||e.seconds||e.milliseconds))},n.MONTHS=["january","february","march","april","may","june","july","august","september","october","november","december"],n.SHORT_MONTHS=n.MONTHS.map(function(e){return e.substr(0,3)}),n.DAYS=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],n.SHORT_DAYS=n.DAYS.map(function(e){return e.substr(0,3)}),n.dateTimeExpr=function(e,t){void 0===t&&(t=!1);var n=[];if(t&&void 0!==e.day&&s.keys(e).length>1&&(o.warn(o.message.droppedDay(e)),delete(e=s.duplicate(e)).day),void 0!==e.year?n.push(e.year):void 0!==e.day?n.push(l):n.push(0),void 0!==e.month){var u=t?r(e.month):e.month;n.push(u)}else if(void 0!==e.quarter){var c=t?i(e.quarter):e.quarter;n.push(c+"*3")}else n.push(0);if(void 0!==e.date)n.push(e.date);else if(void 0!==e.day){var f=t?a(e.day):e.day;n.push(f+"+1")}else n.push(1);for(var d=0,p=["hours","minutes","seconds","milliseconds"];d<p.length;d++){var m=p[d];void 0!==e[m]?n.push(e[m]):n.push(0)}return e.utc?"utc("+n.join(", ")+")":"datetime("+n.join(", ")+")"}},{"./log":101,"./util":114}],94:[function(e,t,n){"use strict";function i(e,t){var n=e&&e[t];return!!n&&(s.isArray(n)?s.some(n,function(e){return!!e.field}):a.isFieldDef(n)||a.hasConditionFieldDef(n))}Object.defineProperty(n,"__esModule",{value:!0});var r=e("./channel"),a=e("./fielddef"),o=e("./log"),s=e("./util");n.channelHasField=i,n.isAggregate=function(e){return s.some(r.CHANNELS,function(t){if(i(e,t)){var n=e[t];if(s.isArray(n))return s.some(n,function(e){return!!e.aggregate});var r=a.getFieldDef(n);return r&&!!r.aggregate}return!1})},n.normalizeEncoding=function(e,t){return s.keys(e).reduce(function(n,i){if(!r.supportMark(i,t))return o.warn(o.message.incompatibleChannel(i,t)),n;if("size"===i&&"line"===t){var l=a.getFieldDef(e[i]);if(l&&l.aggregate)return o.warn(o.message.incompatibleChannel(i,t,"when the field is aggregated.")),n}if("detail"===i||"order"===i)(u=e[i])&&(n[i]=(s.isArray(u)?u:[u]).reduce(function(e,t){return a.isFieldDef(t)?e.push(a.normalizeFieldDef(t,i)):o.warn(o.message.emptyFieldDef(t,i)),e},[]));else{var u=e[i];if(!a.isFieldDef(u)&&!a.isValueDef(u)&&!a.isConditionalDef(u))return o.warn(o.message.emptyFieldDef(u,i)),n;n[i]=a.normalize(u,i)}return n},{})},n.isRanged=function(e){return e&&(!!e.x&&!!e.x2||!!e.y&&!!e.y2)},n.fieldDefs=function(e){var t=[];return r.CHANNELS.forEach(function(n){if(i(e,n)){var r=e[n];(s.isArray(r)?r:[r]).forEach(function(e){a.isFieldDef(e)?t.push(e):a.hasConditionFieldDef(e)&&t.push(e.condition)})}}),t},n.forEach=function(e,t,n){e&&s.keys(e).forEach(function(i){var r=i;s.isArray(e[r])?e[r].forEach(function(e){t.call(n,e,r)}):t.call(n,e[r],r)})},n.reduce=function(e,t,n,i){return e?s.keys(e).reduce(function(n,r){var a=r;return s.isArray(e[a])?e[a].reduce(function(e,n){return t.call(i,e,n,a)},n):t.call(i,n,e[a],a)},n):n}},{"./channel":12,"./fielddef":96,"./log":101,"./util":114}],95:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],96:[function(e,t,n){"use strict";function i(e){return!!e&&!!e.condition&&r(e.condition)}function r(e){return!(!e||!e.field&&"count"!==e.aggregate)}function a(e){switch(e.type){case"nominal":case"ordinal":return!0;case"quantitative":return!!e.bin;case"temporal":return!1}throw new Error(h.message.invalidFieldType(e.type))}function o(e){return!a(e)}function s(e){return"count"===e.aggregate}function l(e,t){if(e.timeUnit)return"temporal";if(e.bin)return"quantitative";switch(g.rangeType(t)){case"continuous":return"quantitative";case"discrete":case"flexible":return"nominal";default:return"quantitative"}}function u(e,t){if(e.aggregate&&!p.isAggregateOp(e.aggregate)){e.aggregate;var n=d.__rest(e,["aggregate"]);h.warn(h.message.invalidAggregate(e.aggregate)),e=n}if(e.timeUnit&&(e=d.__assign({},e,{timeUnit:v.normalizeTimeUnit(e.timeUnit)})),e.bin&&(e=d.__assign({},e,{bin:c(e.bin,t)})),e.type){var i=y.getFullName(e.type);e.type!==i&&(e=d.__assign({},e,{type:i})),"quantitative"!==e.type&&p.isCountingAggregateOp(e.aggregate)&&(h.warn(h.message.invalidFieldTypeForCountAggregate(e.type,e.aggregate)),e=d.__assign({},e,{type:"quantitative"}))}else{var r=l(e,t);h.warn(h.message.emptyOrInvalidFieldType(e.type,t,r)),e=d.__assign({},e,{type:r})}var a=f(e,t),o=a.compatible,s=a.warning;return o||h.warn(s),e}function c(e,t){return b.isBoolean(e)?{maxbins:m.autoMaxBins(t)}:e.maxbins||e.step?e:d.__assign({},e,{maxbins:m.autoMaxBins(t)})}function f(e,t){switch(t){case"row":case"column":return o(e)&&!e.timeUnit?{compatible:!1,warning:h.message.facetChannelShouldBeDiscrete(t)}:_;case"x":case"y":case"color":case"text":case"detail":case"tooltip":return _;case"opacity":case"size":case"x2":case"y2":return a(e)&&!e.bin?{compatible:!1,warning:"Channel "+t+" should not be used with discrete field."}:_;case"shape":return"nominal"!==e.type?{compatible:!1,warning:"Shape channel should be used with nominal data only"}:_;case"order":return"nominal"===e.type?{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}:_}throw new Error("channelCompatability not implemented for channel "+t)}Object.defineProperty(n,"__esModule",{value:!0});var d=e("tslib"),p=e("./aggregate"),m=e("./bin"),g=e("./channel"),h=e("./log"),v=e("./timeunit"),y=e("./type"),b=e("./util");n.isRepeatRef=function(e){return e&&!b.isString(e)&&"repeat"in e},n.isConditionalDef=function(e){return!!e&&!!e.condition},n.hasConditionFieldDef=i,n.isFieldDef=r,n.isValueDef=function(e){return e&&"value"in e&&void 0!==e.value},n.isScaleFieldDef=function(e){return!(!e||!e.scale&&!e.sort)},n.field=function(e,t){void 0===t&&(t={});var n=e.field,i=t.prefix,r=t.suffix;if(s(e))n="count_*";else{var a=void 0;t.nofn||(e.bin?(a=m.binToString(e.bin),r=t.binSuffix||""):e.aggregate?a=String(t.aggregate||e.aggregate):e.timeUnit&&(a=String(e.timeUnit))),a&&(n=a+"_"+n)}return r&&(n=n+"_"+r),i&&(n=i+"_"+n),t.expr&&(n=t.expr+"["+b.stringValue(n)+"]"),n},n.isDiscrete=a,n.isContinuous=o,n.isCount=s,n.title=function(e,t){if(s(e))return t.countTitle;var n=e.aggregate||e.timeUnit||e.bin&&"bin";return n?n.toUpperCase()+"("+e.field+")":e.field},n.defaultType=l,n.getFieldDef=function(e){return r(e)?e:i(e)?e.condition:void 0},n.normalize=function(e,t){return r(e)?u(e,t):i(e)?d.__assign({},e,{condition:u(e.condition,t)}):e},n.normalizeFieldDef=u,n.normalizeBin=c;var _={compatible:!0};n.channelCompatibility=f,n.isNumberFieldDef=function(e){return"quantitative"===e.type||!!e.bin},n.isTimeFieldDef=function(e){return"temporal"===e.type||!!e.timeUnit}},{"./aggregate":9,"./bin":11,"./channel":12,"./log":101,"./timeunit":109,"./type":113,"./util":114,tslib:5}],97:[function(e,t,n){"use strict";function i(e){return e&&e.selection}function r(e){return e&&!!e.field&&void 0!==e.equal}function a(e){return!!(e&&e.field&&g.isArray(e.range)&&2===e.range.length)}function o(e){return e&&!!e.field&&(g.isArray(e.oneOf)||g.isArray(e.in))}function s(e){return o(e)||r(e)||a(e)}function l(e,t){void 0===t&&(t=!0);var n=e.timeUnit?"time("+m.fieldExpr(e.timeUnit,e.field)+")":p.field(e,{expr:"datum"});if(r(e))return n+"==="+u(e.equal,e.timeUnit);if(o(e))return"indexof(["+(e.oneOf||e.in).map(function(t){return u(t,e.timeUnit)}).join(",")+"], "+n+") !== -1";if(a(e)){var i=e.range[0],s=e.range[1];if(null!==i&&null!==s&&t)return"inrange("+n+", ["+u(i,e.timeUnit)+", "+u(s,e.timeUnit)+"])";var l=[];return null!==i&&l.push(n+" >= "+u(i,e.timeUnit)),null!==s&&l.push(n+" <= "+u(s,e.timeUnit)),l.length>0?l.join(" && "):"true"}throw new Error("Invalid field filter: "+JSON.stringify(e))}function u(e,t){if(d.isDateTime(e))return"time("+(i=d.dateTimeExpr(e,!0))+")";if(m.isLocalSingleTimeUnit(t)){var n={};n[t]=e;var i=d.dateTimeExpr(n,!0);return"time("+i+")"}return m.isUtcSingleTimeUnit(t)?u(e,m.getLocalTimeUnit(t)):JSON.stringify(e)}Object.defineProperty(n,"__esModule",{value:!0});var c=e("tslib"),f=e("./compile/selection/selection"),d=e("./datetime"),p=e("./fielddef"),m=e("./timeunit"),g=e("./util");n.isSelectionFilter=i,n.isEqualFilter=r,n.isRangeFilter=a,n.isOneOfFilter=o,n.isFieldFilter=s,n.expression=function(e,t,n){return g.logicalExpr(t,function(t){return g.isString(t)?t:i(t)?f.predicate(e,t.selection,n):l(t)})},n.fieldFilterExpression=l,n.normalizeFilter=function(e){return s(e)&&e.timeUnit?c.__assign({},e,{timeUnit:m.normalizeTimeUnit(e.timeUnit)}):e}},{"./compile/selection/selection":76,"./datetime":93,"./fielddef":96,"./timeunit":109,"./util":114,tslib:5}],98:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.VL_ONLY_GUIDE_CONFIG=["shortTimeLabels"]},{}],99:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.axis=e("./axis"),n.aggregate=e("./aggregate"),n.bin=e("./bin"),n.channel=e("./channel"),n.compositeMark=e("./compositemark");var i=e("./compile/compile");n.compile=i.compile,n.config=e("./config"),n.data=e("./data"),n.datetime=e("./datetime"),n.encoding=e("./encoding"),n.facet=e("./facet"),n.fieldDef=e("./fielddef"),n.legend=e("./legend"),n.mark=e("./mark"),n.scale=e("./scale"),n.sort=e("./sort"),n.spec=e("./spec"),n.stack=e("./stack"),n.timeUnit=e("./timeunit"),n.transform=e("./transform"),n.type=e("./type"),n.util=e("./util"),n.validate=e("./validate"),n.version=e("../package.json").version},{"../package.json":8,"./aggregate":9,"./axis":10,"./bin":11,"./channel":12,"./compile/compile":21,"./compositemark":90,"./config":91,"./data":92,"./datetime":93,"./encoding":94,"./facet":95,"./fielddef":96,"./legend":100,"./mark":103,"./scale":104,"./sort":106,"./spec":107,"./stack":108,"./timeunit":109,"./transform":112,"./type":113,"./util":114,"./validate":115}],100:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.defaultLegendConfig={},n.LEGEND_PROPERTIES=["entryPadding","format","offset","orient","tickCount","title","type","values","zindex"],n.VG_LEGEND_PROPERTIES=[].concat(["fill","stroke","shape","size","opacity","encode"],n.LEGEND_PROPERTIES)},{}],101:[function(e,t,n){"use strict";function i(){return o=a}Object.defineProperty(n,"__esModule",{value:!0});var r=e("vega-util"),a=r.logger(r.Warn),o=a,s=function(){function e(){this.warns=[],this.infos=[],this.debugs=[]}return e.prototype.level=function(){return this},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(n=this.warns).push.apply(n,e),this;var n},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(n=this.infos).push.apply(n,e),this;var n},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(n=this.debugs).push.apply(n,e),this;var n},e}();n.LocalLogger=s,n.runLocalLogger=function(e){e(o=new s),i()},n.wrap=function(e){return function(){var t=o=new s;e(t),i()}},n.set=function(e){return o=e},n.reset=i,n.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];o.warn.apply(o,arguments)},n.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];o.info.apply(o,arguments)},n.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];o.debug.apply(o,arguments)};!function(e){e.INVALID_SPEC="Invalid spec",e.cannotProjectOnChannelWithoutField=function(e){return'Cannot project a selection on encoding channel "'+e+'", which has no field.'},e.selectionNotFound=function(e){return'Cannot find a selection named "'+e+'"'},e.noSuchRepeatedValue=function(e){return'Unknown repeated value "'+e+'".'},e.cannotSetTitleAnchor=function(e){return'Cannot set title "anchor" for a '+e+" spec"},e.unrecognizedParse=function(e){return'Unrecognized parse "'+e+'".'},e.differentParse=function(e,t,n){return'An ancestor parsed field "'+e+'" as '+n+" but a child wants to parse the field as "+t+"."},e.invalidTransformIgnored=function(e){return"Ignoring an invalid transform: "+JSON.stringify(e)+"."},e.NO_FIELDS_NEEDS_AS='If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the the data from the secondary source.',e.invalidFieldType=function(e){return'Invalid field type "'+e+'"'},e.invalidFieldTypeForCountAggregate=function(e,t){return'Invalid field type "'+e+'" for aggregate: "'+t+'", using "quantitative" instead.'},e.invalidAggregate=function(e){return'Invalid aggregation operator "'+e+'"'},e.emptyOrInvalidFieldType=function(e,t,n){return'Invalid field type "'+e+'" for channel "'+t+'", using "'+n+'" instead.'},e.emptyFieldDef=function(e,t){return"Dropping "+JSON.stringify(e)+' from channel "'+t+'" since it does not contain data field or value.'},e.incompatibleChannel=function(e,t,n){return e+' dropped as it is incompatible with "'+t+'"'+(n?" when "+n:"")+"."},e.facetChannelShouldBeDiscrete=function(e){return e+" encoding should be discrete (ordinal / nominal / binned)."},e.discreteChannelCannotEncode=function(e,t){return'Using discrete channel "'+e+'" to encode "'+t+'" field can be misleading as it does not encode '+("ordinal"===t?"order":"magnitude")+"."},e.BAR_WITH_POINT_SCALE_AND_RANGESTEP_NULL="Bar mark should not be used with point scale when rangeStep is null. Please use band scale instead.",e.unclearOrientContinuous=function(e){return'Cannot clearly determine orientation for "'+e+'" since both x and y channel encode continous fields. In this case, we use vertical by default'},e.unclearOrientDiscreteOrEmpty=function(e){return'Cannot clearly determine orientation for "'+e+'" since both x and y channel encode discrete or empty fields.'},e.orientOverridden=function(e,t){return'Specified orient "'+e+'" overridden with "'+t+'"'},e.CANNOT_UNION_CUSTOM_DOMAIN_WITH_FIELD_DOMAIN="custom domain scale cannot be unioned with default field-based domain",e.cannotUseScalePropertyWithNonColor=function(e){return'Cannot use the scale property "'+e+'" with non-color channel.'},e.unaggregateDomainHasNoEffectForRawField=function(e){return"Using unaggregated domain with raw field has no effect ("+JSON.stringify(e)+")."},e.unaggregateDomainWithNonSharedDomainOp=function(e){return'Unaggregated domain not applicable for "'+e+'" since it produces values outside the origin domain of the source data.'},e.unaggregatedDomainWithLogScale=function(e){return"Unaggregated domain is currently unsupported for log scale ("+JSON.stringify(e)+")."},e.CANNOT_USE_RANGE_WITH_POSITION='Cannot use a custom "range" with x or y channel.  Please customize width, height, padding, or rangeStep instead.',e.cannotUseSizeFieldWithBandSize=function(e){return"Using size field when "+e+"-channel has a band scale is not supported."},e.cannotApplySizeToNonOrientedMark=function(e){return'Cannot apply size to non-oriented mark "'+e+'".'},e.rangeStepDropped=function(e){return'rangeStep for "'+e+'" is dropped as top-level '+("x"===e?"width":"height")+" is provided."},e.scaleTypeNotWorkWithChannel=function(e,t,n){return'Channel "'+e+'" does not work with "'+t+'" scale. We are using "'+n+'" scale instead.'},e.scaleTypeNotWorkWithFieldDef=function(e,t){return'FieldDef does not work with "'+e+'" scale. We are using "'+t+'" scale instead.'},e.scalePropertyNotWorkWithScaleType=function(e,t,n){return n+"-scale's \""+t+'" is dropped as it does not work with '+e+" scale."},e.scaleTypeNotWorkWithMark=function(e,t){return'Scale type "'+t+'" does not work with mark "'+e+'".'},e.mergeConflictingProperty=function(e,t,n,i){return"Conflicting "+t+' property "'+e+'" ("'+n+'" and "'+i+'").  Using "'+n+'".'},e.independentScaleMeansIndependentGuide=function(e){return'Setting the scale to be independent for "'+e+'" means we also have to set the guide (axis or legend) to be independent.'},e.conflictedDomain=function(e){return"Cannot set "+e+'-scale\'s "domain" as it is binned. Please use "bin"\'s "extent" instead.'},e.domainSortDropped=function(e){return'Dropping sort property "'+JSON.stringify(e)+"\" as unioned domains only support boolean or op 'count'."},e.UNABLE_TO_MERGE_DOMAINS="Unable to merge domains",e.MORE_THAN_ONE_SORT="Domains that should be unioned has conflicting sort properties. Sort will be set to true.",e.INVALID_CHANNEL_FOR_AXIS="Invalid channel for axis.",e.cannotStackRangedMark=function(e){return'Cannot stack "'+e+'" if there is already "'+e+'2"'},e.cannotStackNonLinearScale=function(e){return"Cannot stack non-linear scale ("+e+")"},e.cannotStackNonSummativeAggregate=function(e){return'Cannot stack when the aggregate function is non-summative ("'+e+'")'},e.invalidTimeUnit=function(e,t){return"Invalid "+e+': "'+t+'"'},e.dayReplacedWithDate=function(e){return'Time unit "'+e+'" is not supported. We are replacing it with '+e.replace("day","date")+"."},e.droppedDay=function(e){return"Dropping day from datetime "+JSON.stringify(e)+" as day cannot be combined with other units."}}(n.message||(n.message={}))},{"vega-util":7}],102:[function(e,t,n){"use strict";function i(e){return!!e.or}function r(e){return!!e.and}function a(e){return!!e.not}function o(e,t){if(a(e))o(e.not,t);else if(r(e))for(var n=0,s=e.and;n<s.length;n++)o(c=s[n],t);else if(i(e))for(var l=0,u=e.or;l<u.length;l++){var c=u[l];o(c,t)}else t(e)}function s(e,t){return a(e)?{not:s(e.not,t)}:r(e)?{and:e.and.map(function(e){return s(e,t)})}:i(e)?{or:e.or.map(function(e){return s(e,t)})}:t(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.isLogicalOr=i,n.isLogicalAnd=r,n.isLogicalNot=a,n.forEachLeave=o,n.normalizeLogicalOperand=s},{}],103:[function(e,t,n){"use strict";function i(e){return e.type}Object.defineProperty(n,"__esModule",{value:!0});var r,a=e("./util");!function(e){e.AREA="area",e.BAR="bar",e.LINE="line",e.POINT="point",e.RECT="rect",e.RULE="rule",e.TEXT="text",e.TICK="tick",e.CIRCLE="circle",e.SQUARE="square"}(r=n.Mark||(n.Mark={})),n.AREA=r.AREA,n.BAR=r.BAR,n.LINE=r.LINE,n.POINT=r.POINT,n.TEXT=r.TEXT,n.TICK=r.TICK,n.RECT=r.RECT,n.RULE=r.RULE,n.CIRCLE=r.CIRCLE,n.SQUARE=r.SQUARE;var o={area:1,bar:1,line:1,point:1,text:1,tick:1,rect:1,rule:1,circle:1,square:1};n.isMark=function(e){return!!o[e]},n.PRIMITIVE_MARKS=a.flagKeys(o),n.isMarkDef=i;var s=a.toSet(n.PRIMITIVE_MARKS);n.isPrimitiveMark=function(e){return(i(e)?e.type:e)in s},n.STROKE_CONFIG=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity"],n.FILL_CONFIG=["fill","fillOpacity"],n.FILL_STROKE_CONFIG=[].concat(n.STROKE_CONFIG,n.FILL_CONFIG),n.VL_ONLY_MARK_CONFIG_PROPERTIES=["filled","color"],n.VL_ONLY_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX={bar:["binSpacing","continuousBandSize","discreteBandSize"],text:["shortTimeLabels"],tick:["bandSize","thickness"]},n.defaultMarkConfig={color:"#4c78a8"},n.defaultBarConfig={binSpacing:1,continuousBandSize:2},n.defaultTickConfig={thickness:1}},{"./util":114}],104:[function(e,t,n){"use strict";function i(e){return e in d}function r(e){return e in f}Object.defineProperty(n,"__esModule",{value:!0});var a=e("tslib"),o=e("./channel"),s=e("./log"),l=e("./util");!function(e){e.LINEAR="linear",e.BIN_LINEAR="bin-linear",e.LOG="log",e.POW="pow",e.SQRT="sqrt",e.TIME="time",e.UTC="utc",e.SEQUENTIAL="sequential",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.ORDINAL="ordinal",e.BIN_ORDINAL="bin-ordinal",e.POINT="point",e.BAND="band"}(n.ScaleType||(n.ScaleType={}));var u={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric","bin-linear":"bin-linear",time:"time",utc:"time",sequential:"sequential",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position"};n.SCALE_TYPES=l.keys(u),n.scaleCompatible=function(e,t){var n=u[e],i=u[t];return n===i||"ordinal-position"===n&&"time"===i||"ordinal-position"===i&&"time"===n};var c={linear:0,log:1,pow:1,sqrt:1,time:0,utc:0,point:10,band:11,"bin-linear":0,sequential:0,ordinal:0,"bin-ordinal":0};n.scaleTypePrecedence=function(e){return c[e]},n.CONTINUOUS_TO_CONTINUOUS_SCALES=["linear","bin-linear","log","pow","sqrt","time","utc"];var f=l.toSet(n.CONTINUOUS_TO_CONTINUOUS_SCALES);n.CONTINUOUS_DOMAIN_SCALES=n.CONTINUOUS_TO_CONTINUOUS_SCALES.concat(["sequential"]);var d=l.toSet(n.CONTINUOUS_DOMAIN_SCALES);n.DISCRETE_DOMAIN_SCALES=["ordinal","bin-ordinal","point","band"];var p=l.toSet(n.DISCRETE_DOMAIN_SCALES),m=l.toSet(["bin-linear","bin-ordinal"]);n.TIME_SCALE_TYPES=["time","utc"],n.hasDiscreteDomain=function(e){return e in p},n.isBinScale=function(e){return e in m},n.hasContinuousDomain=i,n.isContinuousToContinuous=r,n.defaultScaleConfig={textXRangeStep:90,rangeStep:21,pointPadding:.5,bandPaddingInner:.1,facetSpacing:16,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4},n.isExtendedScheme=function(e){return e&&!!e.name},n.isSelectionDomain=function(e){return e&&e.selection};var g={type:1,domain:1,range:1,rangeStep:1,scheme:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1};n.SCALE_PROPERTIES=l.flagKeys(g);var h=a.__rest(g,["type","domain","range","rangeStep","scheme"]);n.NON_TYPE_DOMAIN_RANGE_VEGA_SCALE_PROPERTIES=l.flagKeys(h),n.scaleTypeSupportProperty=function(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":return l.contains(["sequential","ordinal","bin-ordinal","quantile","quantize"],e);case"interpolate":return l.contains(["linear","bin-linear","pow","log","sqrt","utc","time"],e);case"round":return r(e)||"band"===e||"point"===e;case"rangeStep":case"padding":case"paddingOuter":return l.contains(["point","band"],e);case"paddingInner":return"band"===e;case"clamp":return r(e)||"sequential"===e;case"nice":return r(e)||"sequential"===e||"quantize"===e;case"exponent":return"pow"===e;case"base":return"log"===e;case"zero":return i(e)&&!l.contains(["log","time","utc","bin-linear","threshold","quantile"],e)}throw new Error("Invalid scale property "+t+".")},n.channelScalePropertyIncompatability=function(e,t){switch(t){case"range":if("x"===e||"y"===e)return s.message.CANNOT_USE_RANGE_WITH_POSITION;return;case"interpolate":case"scheme":if("color"!==e)return s.message.cannotUseScalePropertyWithNonColor(e);return;case"type":case"domain":case"base":case"exponent":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"rangeStep":case"reverse":case"round":case"clamp":case"zero":return}throw new Error('Invalid scale property "'+t+'".')},n.channelSupportScaleType=function(e,t){switch(e){case o.Channel.X:case o.Channel.Y:case o.Channel.SIZE:case o.Channel.OPACITY:return r(t)||l.contains(["band","point"],t);case o.Channel.COLOR:return"band"!==t;case o.Channel.SHAPE:return"ordinal"===t}return!1}},{"./channel":12,"./log":101,"./util":114,tslib:5}],105:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SELECTION_ID="_vgsid_",n.defaultConfig={single:{on:"click",fields:[n.SELECTION_ID],resolve:"global"},multi:{on:"click",fields:[n.SELECTION_ID],toggle:"event.shiftKey",resolve:"global"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global"}}},{}],106:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.isSortField=function(e){return!(!e||"count"!==e.op&&!e.field||!e.op)}},{}],107:[function(e,t,n){"use strict";function i(e){return void 0!==e.facet}function r(e){return!!e.mark}function a(e){return void 0!==e.layer}function o(e){return void 0!==e.repeat}function s(e){return l(e)||u(e)}function l(e){return void 0!==e.vconcat}function u(e){return void 0!==e.hconcat}function c(e,t){if(i(e))return f(e,t);if(a(e))return d(e,t);if(o(e))return p(e,t);if(l(e))return m(e,t);if(u(e))return g(e,t);if(r(e)){var n=w.channelHasField(e.encoding,O.ROW),s=w.channelHasField(e.encoding,O.COLUMN);return n||s?h(e,t):y(e,t)}throw new Error(k.message.INVALID_SPEC)}function f(e,t){var n=e.spec,i=x.__rest(e,["spec"]);return x.__assign({},i,{spec:c(n,t)})}function d(e,t){var n=e.layer,i=x.__rest(e,["layer"]);return x.__assign({},i,{layer:n.map(function(e){return a(e)?d(e,t):y(e,t)})})}function p(e,t){var n=e.spec,i=x.__rest(e,["spec"]);return x.__assign({},i,{spec:c(n,t)})}function m(e,t){var n=e.vconcat,i=x.__rest(e,["vconcat"]);return x.__assign({},i,{vconcat:n.map(function(e){return c(e,t)})})}function g(e,t){var n=e.hconcat,i=x.__rest(e,["hconcat"]);return x.__assign({},i,{hconcat:n.map(function(e){return c(e,t)})})}function h(e,t){var n=e.encoding,i=n.row,r=n.column,a=x.__rest(n,["row","column"]),o=e.mark,s=e.width,l=e.height,u=e.selection,c=(e.encoding,x.__rest(e,["mark","width","height","selection","encoding"]));return x.__assign({},c,{facet:x.__assign({},i?{row:i}:{},r?{column:r}:{}),spec:y(x.__assign({mark:o},s?{width:s}:{},l?{height:l}:{},{encoding:a},u?{selection:u}:{}),t)})}function v(e){return D.isPrimitiveMark(e.mark)}function y(e,t){if(v(e)){if(w.isRanged(e.encoding))return b(e);var n=t&&t.overlay,i=n&&e.mark===D.AREA&&A.contains(["linepoint","line"],n.area),r=n&&(n.line&&e.mark===D.LINE||"linepoint"===n.area&&e.mark===D.AREA);return r||i?_(e,r,i,t):e}return N.normalize(e,t)}function b(e){var t=w.channelHasField(e.encoding,O.X),n=w.channelHasField(e.encoding,O.Y),i=w.channelHasField(e.encoding,O.X2),r=w.channelHasField(e.encoding,O.Y2);if(i&&!t||r&&!n){var a=A.duplicate(e);return i&&!t&&(a.encoding.x=a.encoding.x2,delete a.encoding.x2),r&&!n&&(a.encoding.y=a.encoding.y2,delete a.encoding.y2),a}return e}function _(e,t,n,i){var r=e.mark,a=e.selection,o=e.encoding,s=x.__rest(e,["mark","selection","encoding"]),l=[{mark:r,encoding:o}],u=C.stack(r,o,i?i.stack:void 0),c=o;if(u){var f=u.fieldChannel,d=u.offset;c=x.__assign({},o,(p={},p[f]=x.__assign({},o[f],d?{stack:d}:{}),p))}return n&&l.push(x.__assign({mark:{type:"line",style:"lineOverlay"}},a?{selection:a}:{},{encoding:c})),t&&l.push(x.__assign({mark:{type:"point",filled:!0,style:"pointOverlay"}},a?{selection:a}:{},{encoding:c})),x.__assign({},s,{layer:l});var p}function S(e,t){return t.forEach(function(t){var n=["field","type","value","timeUnit","bin","aggregate"].reduce(function(e,n){return void 0!==t[n]&&(e[n]=t[n]),e},{}),i=A.hash(n);e[i]=e[i]||t}),e}function E(e,t){return void 0===t&&(t={}),a(e)?e.layer.forEach(function(e){r(e)?S(t,T.fieldDefs(e.encoding)):E(e,t)}):i(e)?(S(t,T.fieldDefs(e.facet)),E(e.spec,t)):o(e)?E(e.spec,t):s(e)?(l(e)?e.vconcat:e.hconcat).forEach(function(e){return E(e,t)}):S(t,T.fieldDefs(e.encoding)),t}Object.defineProperty(n,"__esModule",{value:!0});var x=e("tslib"),O=e("./channel"),N=e("./compositemark"),w=e("./encoding"),T=e("./encoding"),k=e("./log"),D=e("./mark"),C=e("./stack"),A=e("./util");n.isFacetSpec=i,n.isUnitSpec=r,n.isLayerSpec=a,n.isRepeatSpec=o,n.isConcatSpec=s,n.isVConcatSpec=l,n.isHConcatSpec=u,n.normalize=c,n.fieldDefs=function(e){return A.vals(E(e))},n.isStacked=function(e,t){return t=t||e.config,!!D.isPrimitiveMark(e.mark)&&null!==C.stack(e.mark,e.encoding,t?t.stack:void 0)}},{"./channel":12,"./compositemark":90,"./encoding":94,"./log":101,"./mark":103,"./stack":108,"./util":114,tslib:5}],108:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("./aggregate"),r=e("./channel"),a=e("./encoding"),o=e("./fielddef"),s=e("./log"),l=e("./mark"),u=e("./scale"),c=e("./util");n.STACKABLE_MARKS=[l.BAR,l.AREA,l.RULE,l.POINT,l.CIRCLE,l.SQUARE,l.LINE,l.TEXT,l.TICK],n.STACK_BY_DEFAULT_MARKS=[l.BAR,l.AREA],n.stack=function(e,t,f){var d=l.isMarkDef(e)?e.type:e;if(!c.contains(n.STACKABLE_MARKS,d))return null;if(!a.isAggregate(t))return null;var p=r.NONSPATIAL_CHANNELS.reduce(function(e,n){if(a.channelHasField(t,n)){var i=t[n];(c.isArray(i)?i:[i]).forEach(function(t){var i=o.getFieldDef(t);i.aggregate||e.push({channel:n,fieldDef:i})})}return e},[]);if(0===p.length)return null;var m=o.isFieldDef(t.x),g=o.isFieldDef(t.y),h=o.isFieldDef(t.x)&&!!t.x.aggregate;if(h!==(o.isFieldDef(t.y)&&!!t.y.aggregate)){var v=h?r.X:r.Y,y=t[v],b=y.aggregate,_=y.scale,S=null;return(S=void 0!==y.stack?y.stack:c.contains(n.STACK_BY_DEFAULT_MARKS,d)&&void 0===f?"zero":f)&&"none"!==S?_&&_.type&&_.type!==u.ScaleType.LINEAR?(s.warn(s.message.cannotStackNonLinearScale(_.type)),null):a.channelHasField(t,v===r.X?r.X2:r.Y2)?(s.warn(s.message.cannotStackRangedMark(v)),null):c.contains(i.SUM_OPS,b)?{groupbyChannel:h?g?r.Y:null:m?r.X:null,fieldChannel:v,impute:c.contains(["area","line"],d),stackBy:p,offset:S}:(s.warn(s.message.cannotStackNonSummativeAggregate(b)),null):null}return null}},{"./aggregate":9,"./channel":12,"./encoding":94,"./fielddef":96,"./log":101,"./mark":103,"./scale":104,"./util":114}],109:[function(e,t,n){"use strict";function i(e){return!!g[e]}function r(e,t){var n=v[e];return{setDateMethod:t?"setUTC"+n.substr(3):n,getDateMethod:"get"+(t?"UTC":"")+n.substr(3)}}function a(e,t){var n=e.indexOf(t);return n>-1&&(t!==o.SECONDS||0===n||"i"!==e.charAt(n-1))}Object.defineProperty(n,"__esModule",{value:!0});var o,s=e("tslib"),l=e("./datetime"),u=e("./log"),c=e("./util");!function(e){e.YEAR="year",e.MONTH="month",e.DAY="day",e.DATE="date",e.HOURS="hours",e.MINUTES="minutes",e.SECONDS="seconds",e.MILLISECONDS="milliseconds",e.YEARMONTH="yearmonth",e.YEARMONTHDATE="yearmonthdate",e.YEARMONTHDATEHOURS="yearmonthdatehours",e.YEARMONTHDATEHOURSMINUTES="yearmonthdatehoursminutes",e.YEARMONTHDATEHOURSMINUTESSECONDS="yearmonthdatehoursminutesseconds",e.MONTHDATE="monthdate",e.HOURSMINUTES="hoursminutes",e.HOURSMINUTESSECONDS="hoursminutesseconds",e.MINUTESSECONDS="minutesseconds",e.SECONDSMILLISECONDS="secondsmilliseconds",e.QUARTER="quarter",e.YEARQUARTER="yearquarter",e.QUARTERMONTH="quartermonth",e.YEARQUARTERMONTH="yearquartermonth",e.UTCYEAR="utcyear",e.UTCMONTH="utcmonth",e.UTCDAY="utcday",e.UTCDATE="utcdate",e.UTCHOURS="utchours",e.UTCMINUTES="utcminutes",e.UTCSECONDS="utcseconds",e.UTCMILLISECONDS="utcmilliseconds",e.UTCYEARMONTH="utcyearmonth",e.UTCYEARMONTHDATE="utcyearmonthdate",e.UTCYEARMONTHDATEHOURS="utcyearmonthdatehours",e.UTCYEARMONTHDATEHOURSMINUTES="utcyearmonthdatehoursminutes",e.UTCYEARMONTHDATEHOURSMINUTESSECONDS="utcyearmonthdatehoursminutesseconds",e.UTCMONTHDATE="utcmonthdate",e.UTCHOURSMINUTES="utchoursminutes",e.UTCHOURSMINUTESSECONDS="utchoursminutesseconds",e.UTCMINUTESSECONDS="utcminutesseconds",e.UTCSECONDSMILLISECONDS="utcsecondsmilliseconds",e.UTCQUARTER="utcquarter",e.UTCYEARQUARTER="utcyearquarter",e.UTCQUARTERMONTH="utcquartermonth",e.UTCYEARQUARTERMONTH="utcyearquartermonth"}(o=n.TimeUnit||(n.TimeUnit={}));var f={year:1,quarter:1,month:1,day:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1};n.TIMEUNIT_PARTS=c.flagKeys(f),n.isLocalSingleTimeUnit=function(e){return!!f[e]};var d={utcyear:1,utcquarter:1,utcmonth:1,utcday:1,utcdate:1,utchours:1,utcminutes:1,utcseconds:1,utcmilliseconds:1};n.isUtcSingleTimeUnit=function(e){return!!d[e]};var p={yearquarter:1,yearquartermonth:1,yearmonth:1,yearmonthdate:1,yearmonthdatehours:1,yearmonthdatehoursminutes:1,yearmonthdatehoursminutesseconds:1,quartermonth:1,monthdate:1,hoursminutes:1,hoursminutesseconds:1,minutesseconds:1,secondsmilliseconds:1},m={utcyearquarter:1,utcyearquartermonth:1,utcyearmonth:1,utcyearmonthdate:1,utcyearmonthdatehours:1,utcyearmonthdatehoursminutes:1,utcyearmonthdatehoursminutesseconds:1,utcquartermonth:1,utcmonthdate:1,utchoursminutes:1,utchoursminutesseconds:1,utcminutesseconds:1,utcsecondsmilliseconds:1},g=s.__assign({},d,m);n.isUTCTimeUnit=i,n.getLocalTimeUnit=function(e){return e.substr(3)};var h=s.__assign({},f,d,p,m);n.TIMEUNITS=c.flagKeys(h),n.isTimeUnit=function(e){return!!h[e]};var v={year:"setFullYear",month:"setMonth",date:"setDate",hours:"setHours",minutes:"setMinutes",seconds:"setSeconds",milliseconds:"setMilliseconds",quarter:null,day:null};n.convert=function(e,t){var s=i(e),l=s?new Date(Date.UTC(0,0,1,0,0,0,0)):new Date(0,0,1,0,0,0,0);return n.TIMEUNIT_PARTS.forEach(function(n){if(a(e,n))switch(n){case o.DAY:throw new Error("Cannot convert to TimeUnits containing 'day'");case o.QUARTER:var i=r("month",s),u=i.getDateMethod,c=i.setDateMethod;l[c](3*Math.floor(t[u]()/3));break;default:var f=r(n,s),d=f.getDateMethod,p=f.setDateMethod;l[p](t[d]())}}),l},n.containsTimeUnit=a,n.fieldExpr=function(e,t){function r(e){return e===o.QUARTER?"("+u+"quarter("+s+")-1)":""+u+e+"("+s+")"}var s="datum["+c.stringValue(t)+"]",u=i(e)?"utc":"",f=n.TIMEUNIT_PARTS.reduce(function(t,n){return a(e,n)&&(t[n]=r(n)),t},{});return l.dateTimeExpr(f)},n.smallestUnit=function(e){if(e)return a(e,o.SECONDS)?"second":a(e,o.MINUTES)?"minute":a(e,o.HOURS)?"hour":a(e,o.DAY)||a(e,o.DATE)?"day":a(e,o.MONTH)?"month":a(e,o.YEAR)?"year":void 0},n.formatExpression=function(e,t,n,i){if(e){var r=[],s="",l=a(e,o.YEAR);a(e,o.QUARTER)&&(s="'Q' + quarter("+t+")"),a(e,o.MONTH)&&r.push(!1!==n?"%b":"%B"),a(e,o.DAY)?r.push(n?"%a":"%A"):a(e,o.DATE)&&r.push("%d"+(l?",":"")),l&&r.push(n?"%y":"%Y");var u=[];a(e,o.HOURS)&&u.push("%H"),a(e,o.MINUTES)&&u.push("%M"),a(e,o.SECONDS)&&u.push("%S"),a(e,o.MILLISECONDS)&&u.push("%L");var c=[];return r.length>0&&c.push(r.join(" ")),u.length>0&&c.push(u.join(":")),c.length>0&&(s&&(s+=" + ' ' + "),s+=i?"utcFormat("+t+", '"+c.join(" ")+"')":"timeFormat("+t+", '"+c.join(" ")+"')"),s||void 0}},n.normalizeTimeUnit=function(e){return"day"!==e&&e.indexOf("day")>=0?(u.warn(u.message.dayReplacedWithDate(e)),e.replace("day","date")):e}},{"./datetime":93,"./log":101,"./util":114,tslib:5}],110:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib");n.extractTitleConfig=function(e){var t=e.anchor,n=e.offset,r=e.orient,a=e.color,o=i.__rest(e,["anchor","offset","orient","color"]);return{mark:i.__assign({},o,a?{fill:a}:{}),nonMark:i.__assign({},t?{anchor:t}:{},n?{offset:n}:{},r?{orient:r}:{})}}},{tslib:5}],111:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=["background","padding","autoResize"];n.extractTopLevelProperties=function(e){return i.reduce(function(t,n){return e&&void 0!==e[n]&&(t[n]=e[n]),t},{})}},{}],112:[function(e,t,n){"use strict";function i(e){return void 0!==e.filter}Object.defineProperty(n,"__esModule",{value:!0});var r=e("./filter"),a=e("./logical");n.isFilter=i,n.isLookup=function(e){return void 0!==e.lookup},n.isCalculate=function(e){return void 0!==e.calculate},n.isBin=function(e){return!!e.bin},n.isTimeUnit=function(e){return void 0!==e.timeUnit},n.isSummarize=function(e){return void 0!==e.summarize},n.normalizeTransform=function(e){return e.map(function(e){return i(e)?{filter:a.normalizeLogicalOperand(e.filter,r.normalizeFilter)}:e})}},{"./filter":97,"./logical":102}],113:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i;!function(e){e.QUANTITATIVE="quantitative",e.ORDINAL="ordinal",e.TEMPORAL="temporal",e.NOMINAL="nominal"}(i=n.Type||(n.Type={}));var r={quantitative:1,ordinal:1,temporal:1,nominal:1};n.isType=function(e){return!!r[e]},n.QUANTITATIVE=i.QUANTITATIVE,n.ORDINAL=i.ORDINAL,n.TEMPORAL=i.TEMPORAL,n.NOMINAL=i.NOMINAL,n.getFullName=function(e){if(e)switch(e=e.toLowerCase()){case"q":case n.QUANTITATIVE:return"quantitative";case"t":case n.TEMPORAL:return"temporal";case"o":case n.ORDINAL:return"ordinal";case"n":case n.NOMINAL:return"nominal"}}},{}],114:[function(e,t,n){"use strict";function i(e,t){return e.indexOf(t)>-1}function r(e,t){return e.filter(function(e){return!i(t,e)})}function a(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var i=0,r=t;i<r.length;i++)e=o(e,r[i]);return e}function o(e,t){if("object"!=typeof t||null===t)return e;for(var n in t)t.hasOwnProperty(n)&&void 0!==t[n]&&("object"!=typeof t[n]||f.isArray(t[n])||null===t[n]?e[n]=t[n]:"object"!=typeof e[n]||null===e[n]?e[n]=a(f.isArray(t[n].constructor)?[]:{},t[n]):a(e[n],t[n]));return e}function s(e){return JSON.parse(JSON.stringify(e))}function l(e){return!0===e||!1===e}function u(e,t){return d.isLogicalNot(e)?"!("+u(e.not,t)+")":d.isLogicalAnd(e)?"("+e.and.map(function(e){return u(e,t)}).join(") && (")+")":d.isLogicalOr(e)?"("+e.or.map(function(e){return u(e,t)}).join(") || (")+")":t(e)}Object.defineProperty(n,"__esModule",{value:!0});var c=e("json-stable-stringify"),f=e("vega-util"),d=e("./logical"),p=e("vega-util");n.isArray=p.isArray,n.isObject=p.isObject,n.isNumber=p.isNumber,n.isString=p.isString,n.truncate=p.truncate,n.toSet=p.toSet,n.stringValue=p.stringValue,n.pick=function(e,t){var n={};return t.forEach(function(t){e.hasOwnProperty(t)&&(n[t]=e[t])}),n},n.omit=function(e,t){var n=s(e);return t.forEach(function(e){delete n[e]}),n},n.hash=function(e){return f.isString(e)||f.isNumber(e)||l(e)?String(e):c(e)},n.contains=i,n.without=r,n.union=function(e,t){return e.concat(r(t,e))},n.some=function(e,t){for(var n=0,i=0;i<e.length;i++)if(t(e[i],i,n++))return!0;return!1},n.every=function(e,t){for(var n=0,i=0;i<e.length;i++)if(!t(e[i],i,n++))return!1;return!0},n.flatten=function(e){return[].concat.apply([],e)},n.mergeDeep=a,n.unique=function(e,t){for(var n,i=[],r={},a=0,o=e;a<o.length;a++){var s=o[a];(n=t(s))in r||(r[n]=1,i.push(s))}return i},n.differ=function(e,t){for(var n in e)if(e.hasOwnProperty(n)&&t[n]&&e[n]&&t[n]!==e[n])return!0;return!1},n.hasIntersection=function(e,t){for(var n in e)if(n in t)return!0;return!1},n.differArray=function(e,t){if(e.length!==t.length)return!0;e.sort(),t.sort();for(var n=0;n<e.length;n++)if(t[n]!==e[n])return!0;return!1},n.keys=Object.keys,n.vals=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t},n.flagKeys=function(e){return n.keys(e)},n.duplicate=s,n.isBoolean=l,n.varName=function(e){var t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t},n.logicalExpr=u,n.deleteNestedProperty=function(e,t){for(var i=!0;t.length>0&&i;){for(var r=e,a=0;a<t.length-1;a++)r=r[t[a]];delete r[t.pop()],0!==n.keys(r).length&&(i=!1)}}},{"./logical":102,"json-stable-stringify":1,"vega-util":7}],115:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("./mark"),r=e("./mark"),a=e("./util");n.DEFAULT_REQUIRED_CHANNEL_MAP={text:["text"],line:["x","y"],area:["x","y"]},n.DEFAULT_SUPPORTED_CHANNEL_TYPE={bar:a.toSet(["row","column","x","y","size","color","detail"]),line:a.toSet(["row","column","x","y","color","detail"]),area:a.toSet(["row","column","x","y","color","detail"]),tick:a.toSet(["row","column","x","y","color","detail"]),circle:a.toSet(["row","column","x","y","color","size","detail"]),square:a.toSet(["row","column","x","y","color","size","detail"]),point:a.toSet(["row","column","x","y","color","size","detail","shape"]),text:a.toSet(["row","column","size","color","text"])},n.getEncodingMappingError=function(e,t,a){void 0===t&&(t=n.DEFAULT_REQUIRED_CHANNEL_MAP),void 0===a&&(a=n.DEFAULT_SUPPORTED_CHANNEL_TYPE);var o=i.isMarkDef(e.mark)?e.mark.type:e.mark,s=e.encoding,l=t[o],u=a[o];for(var c in l)if(!(l[c]in s))return'Missing encoding channel "'+l[c]+'" for mark "'+o+'"';for(var f in s)if(!u[f])return'Encoding channel "'+f+'" is not supported by mark type "'+o+'"';return o!==r.BAR||s.x||s.y?null:"Missing both x and y for bar"}},{"./mark":103,"./util":114}],116:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("./util");n.isVgSignalRef=function(e){return!!e.signal},n.isVgRangeStep=function(e){return!!e.step},n.isDataRefUnionedDomain=function(e){return!i.isArray(e)&&"fields"in e&&!("data"in e)},n.isFieldRefUnionDomain=function(e){return!i.isArray(e)&&"fields"in e&&"data"in e},n.isDataRefDomain=function(e){return!i.isArray(e)&&"field"in e&&"data"in e},n.isSignalRefDomain=function(e){return!i.isArray(e)&&"signal"in e}},{"./util":114}]},{},[99])(99)});